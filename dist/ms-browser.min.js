function MSBrowserChannels(t){this.browser=null,this.display_itunes_rss=!1,this.current_channel_oid="0",this.$menu=null,this.$content=null,this.tree_manager=null,this.order="default",this.last_response=null,jsu.setObjectAttributes(this,t,["browser","display_itunes_rss","current_channel_oid"]),this.init_options=t||{}}function MSBrowserLatest(t){this.browser=null,this.$menu=null,this.$content=null,this.$place=null,this.last_response=null,this.more=!1,this.start_date="",this.date_label="",this.$section=null,this.can_add_channel=!1,this.can_add_video=!1,jsu.setObjectAttributes(this,t,["browser"]),this.init_options=t||{}}function MSBrowserSearch(t){var e,s;if(this.browser=null,this.$menu=null,this.$content=null,this.order="default",this.last_response=null,this.search_in_fields=[{name:"in_title",label:"titles",initial:!0,items:null},{name:"in_description",label:"descriptions",initial:!1,items:null},{name:"in_keywords",label:"keywords",initial:!0,items:null},{name:"in_speaker",label:"speakers",initial:!0,items:"vlp"},{name:"in_license",label:"licenses",initial:!1,items:"vlp"},{name:"in_company",label:"companies",initial:!1,items:"vlp"},{name:"in_location",label:"locations",initial:!1,items:"vlp"},{name:"in_categories",label:"categories",initial:!1,items:"vlp"},{name:"in_annotations",label:"comments, slides, ...",initial:!1,items:"vlp"},{name:"in_photos",label:"photos",initial:!1,items:"p"},{name:"in_extref",label:"external references",initial:!0,items:null}],t.default_search_in)for(e=0;e<this.search_in_fields.length;e++)s=this.search_in_fields[e].name.replace("in_",""),-1!==t.default_search_in.indexOf(s)?this.search_in_fields[e].initial=!0:this.search_in_fields[e].initial=!1;this.search_for_fields=[{name:"for_channels",label:"channels",initial:!0,items:"c"},{name:"for_videos",label:"videos",initial:!0,items:"v"},{name:"for_lives",label:"live streams",initial:!0,items:"l"},{name:"for_photos",label:"photos groups",initial:!0,items:"p"}],jsu.setObjectAttributes(this,t,["browser"]),this.init_options=t||{}}function MSBrowser(t){if(this.title="",this.place=null,this.selectable_content="cvlp",this.displayable_content="cvlp",this.filter_editable=null,this.filter_validated=null,this.filter_speaker=null,this.filter_categories=[],this.filter_no_categories=!1,this.parent_selection_oid=null,this.initial_oid=null,this.initial_state=null,this.on_pick=null,this.hide_header=!1,this.btn_class="",this.msapi=null,this.tree_manager=!0,this.display_types_icons=!1,this.display_itunes_rss=!0,this.use_overlay=!0,this.pick_mode=!0,this.iframe_mode=!1,this.lti_mode=!1,this.links_url_params="",this.links_target="",this.$widget=null,this.$menu=null,this.$main=null,this.overlay=null,this.catalog={},this.display_as_thumbnails=!1,this.displayed="channels",this.current_selection=null,this.site_settings_categories=[],this.url_login="/login/",this.url_channels="/channels/",this.url_latest="/latest/",this.url_search="/search/",this.url_post_link="/lti/post-link/",this.default_search_in=[],jsu.setObjectAttributes(this,t,["title","place","msapi","selectable_content","displayable_content","filter_editable","filter_validated","filter_speaker","parent_selection_oid","initial_oid","initial_state","on_pick","hide_header","btn_class","tree_manager","display_types_icons","display_itunes_rss","default_search_in"]),this.msapi||(this.msapi=new MSAPIClient(t)),this.init_options=t||{},this.use_overlay=!this.place,!this.use_overlay){var e=this;$(document).ready(function(){e.init()})}}MSBrowserChannels.prototype.get_menu_jq=function(){return'<div id="ms_browser_channels_menu" style="display: none;">',"</div>",this.$menu=$('<div id="ms_browser_channels_menu" style="display: none;"></div>'),this.$menu},MSBrowserChannels.prototype.get_content_jq=function(){var t="";return t+='<div id="ms_browser_channels" class="ms-browser-content" style="display: none;">',this.browser.tree_manager&&(t+='<div class="ms-browser-tree-place ms-channels-tree">',t+='<div><i class="fa fa-spinner fa-spin" aria-hidden="true"></i> '+jsu.translate("Loading...")+"</div>",t+="</div>"),t+='<div class="ms-browser-channels-place">',t+='<div class="messages"><div class="message info">'+jsu.translate("Select a channel to display its content.")+"</div></div>",t+="</div>",t+="</div>",this.$content=$(t),this.$place=$(".ms-browser-channels-place",this.$content),this.$content},MSBrowserChannels.prototype.refresh_title=function(){var t,e,s;"channels"==this.browser.get_active_tab()&&((t=this.last_response?this.last_response.info:void 0)&&"0"!=t.oid?(e='<span class="item-entry-preview"><img src="'+t.thumb+'" alt="'+jsu.escapeHTML(t.title)+'"/></span>',e+='<span class="channel-titles-place">',s=t.parent_oid&&"0"!=t.parent_oid?t.parent_title:jsu.translate("Root"),!this.browser.use_overlay&&s&&(e+='<a class="parent-channel-title" href="#'+(t.parent_slug?t.parent_slug:"")+'"'+(t.parent_language?'lang="'+t.parent_language+'"':"")+">"+jsu.escapeHTML(s)+"</a>"),e+='<span class="channel-title"'+(t.language?'lang="'+t.language+'"':"")+">"+jsu.escapeHTML(t.title)+"</span>",e+="</span>",this.browser.current_selection&&this.browser.current_selection.oid==t.oid&&(e='<span class="selected">'+e+"</span>"),this.browser.set_title(t.title,e)):this.browser.lti_mode?this.browser.set_title(jsu.translate("My channel")):this.browser.set_title(jsu.translate("Main channels")))},MSBrowserChannels.prototype.on_show=function(){var t,e;this.refresh_title(),this.initialized||(this.initialized=!0,this.default_logo_src=$("#mainlogo .header-logo").attr("src"),this.default_fav_src=$("#favicon_link").attr("src"),t=this,this.browser.tree_manager&&(e={$place:$(".ms-browser-tree-place",this.$content),msapi:this.browser.msapi,display_root:-1!=this.browser.displayable_content.indexOf("c"),display_personal:!0,current_channel_oid:this.current_channel_oid,on_data_retrieved:function(e){t.browser.update_catalog(e)}},this.browser.pick_mode&&(e.on_change=function(e){t.display_channel(e)}),this.tree_manager=new MSTreeManager(e)),this.init_options.initial_state&&this.init_options.initial_state.channel_slug?this.display_channel_by_slug(this.init_options.initial_state.channel_slug):"self"==this.browser.filter_speaker?this.display_personal_channel():this.display_channel(this.current_channel_oid))},MSBrowserChannels.prototype.set_order=function(t){this.order=t||"default",this.refresh_display(!0)},MSBrowserChannels.prototype.display_personal_channel=function(){var t=this;this.personal_channel_oid?t.display_channel(this.personal_channel_oid):this.browser.msapi.ajax_call("get_channels_personal",{},function(e){e.success?(t.personal_channel_oid=e.oid,t.display_channel(e.oid)):403==e.error_code?t._on_channel_error({error:jsu.translate("You are not allowed to have a personnal channel.")}):t._on_channel_error(e)})},MSBrowserChannels.prototype.display_channel_by_slug=function(t){var e=this;this.browser.get_info_for_slug(t,!1,!0,function(t){t.success?e.display_channel(t.info.oid):e._on_channel_error(t)})},MSBrowserChannels.prototype.display_channel=function(t){if(this.current_channel_oid=t,this.browser.box_hide_info(),this.initialized)if(this.browser.display_loading(),this.tree_manager&&this.tree_manager.set_active(t),"0"!=t){var e=this;this.browser.get_info_for_oid(t,!0,function(s){e._on_channel_info(s,t)})}else this._on_channel_info(null,t)},MSBrowserChannels.prototype.display_parent=function(){var t,e;this.current_channel_oid&&(t=this.current_channel_oid,e=this.browser.catalog[t]&&this.browser.catalog[t].parent_oid?this.browser.catalog[t].parent_oid:"0",this.display_channel(e))},MSBrowserChannels.prototype._on_channel_error=function(t){var e,s;this.last_response=null,e='<div class="messages">',this.browser.use_overlay||"403"!=t.error_code&&"401"!=t.error_code?e+='<div class="message error">'+t.error+"</div>":(s=this.browser.url_login+"?next="+window.location.pathname+(window.location.hash?window.location.hash.substring(1):""),e+='<div class="item-description">',e+='<div class="message error">'+t.error+"</div>",e+="<p>"+jsu.translate("Please login to access this channel")+'<br /> <a href="'+s+'">'+jsu.translate("Sign in")+"</a></p>",e+="</div>"),e+="</div>",this.$place.html(e)},MSBrowserChannels.prototype._on_channel_info=function(t,e){var s,i;if(this.current_channel_oid==e){if(t&&!t.success)return this._on_channel_error(t);s={},e&&"0"!=e&&(s.parent_oid=e),this.browser.parent_selection_oid&&(s.parent_selection_oid=this.browser.parent_selection_oid),this.browser.displayable_content&&(s.content=this.browser.displayable_content),null!==this.browser.filter_editable&&(s.editable=this.browser.filter_editable?"yes":"no"),null!==this.browser.filter_validated&&(s.validated=this.browser.filter_validated?"yes":"no"),this.browser.lti_mode||null===this.browser.filter_speaker||(s.speaker=this.browser.filter_speaker),this.browser.filter_no_categories?s.no_categories=!0:this.browser.filter_categories.length>0&&(s.categories=this.browser.filter_categories.join("\n")),s.order_by=this.order,i=this,this.browser.msapi.ajax_call("get_channels_content",s,function(s){t&&(t.info&&(s.info=t.info),t.parent_selectable&&(s.parent_selectable=t.parent_selectable),t.selectable&&(s.selectable=t.selectable)),i._on_channel_content(s,e)})}else this.browser.hide_loading()},MSBrowserChannels.prototype._on_channel_content=function(t,e){var s,i,a,n,o,r,l,c,d,h,_,p,u,b,m,f,w,y,g,v,j;if(this.browser.hide_loading(),this.current_channel_oid==e){if(!t.success)return this._on_channel_error(t);if(this.last_response=t,!this.browser.use_overlay&&this.browser.display_as_thumbnails&&this.browser.box_hide_info(),this.$menu.html(""),"0"!=e?(this.browser.lti_mode&&e==this.personal_channel_oid||(i={oid:t.info.parent_oid?t.info.parent_oid:"0",title:t.info.parent_title?t.info.parent_title:jsu.translate("Parent channel"),slug:t.info.parent_slug},t.info.parent_oid&&t.info.parent_slug&&this.browser.update_catalog(i),this.browser.use_overlay?(a=$('<button type="button" class="button '+this.browser.btn_class+' back-button"></button>')).click({obj:this,oid:i.oid},function(t){t.data.obj.display_channel(t.data.oid)}):a=$('<a class="button '+this.browser.btn_class+' back-button" href="'+this.browser.get_button_link(i,"view")+'"></a>'),!this.browser.use_overlay&&$(".navbar .back.button-text").length>0?(a.html('<i class="fa fa-chevron-circle-up fa-fw fa-2x" aria-hidden="true"></i>'),a.attr("title",jsu.translate("Parent channel")),a.attr("aria-label",jsu.translate("Parent channel")),a.addClass("back").addClass("button-text"),$(".navbar .back.button-text").replaceWith(a)):(a.html('<i class="fa fa-chevron-circle-up" aria-hidden="true"></i> <span class="hidden-below-800">'+jsu.translate("Parent channel")+"</span>"),this.$menu.append(a)),this.browser.pick_mode&&(n=this.browser.msapi.get_available_storage_display(t.info))&&(this.$menu.append(n+" "),window.uwlb||$(".tooltip-button",this.$menu).click(function(){$("span",this).toggle()}))),o=-1!=this.browser.selectable_content.indexOf("c")&&(!this.browser.parent_selection_oid||t.selectable),s=this.browser.get_entry_links(t.info,"current",o)):(t.oid="0",s=this.browser.get_entry_links(t,"current",!1),!this.browser.use_overlay&&$(".navbar .back.button-text").length>0&&$(".navbar .back.button-text").attr("href","..")),s&&this.$menu.append(s),this.$place.html(""),this.browser.use_overlay)this.$place.scrollTop(0);else{if("0"!=e&&(r=$('<div class="item-description"></div>'),l=!0,c=t.info.can_edit?this.browser.msapi.get_storage_display(t.info):"",(t.info.views||t.info.comments)&&(d='<div class="'+(t.info.short_description||t.info.display_rss_links||c?"right":"align-right")+' channel-description-stats">',t.info.views&&(d+='<span class="inline-block">'+t.info.views+" "+jsu.translate("views"),t.info.views_last_month&&(d+=", "+t.info.views_last_month+" "+jsu.translate("this month")),d+="</span>"),t.info.comments&&(d+=' <span class="inline-block">'+t.info.comments+" "+jsu.translate("annotations"),t.info.comments_last_month&&(d+=", "+t.info.comments_last_month+" "+jsu.translate("this month")),d+="</span>"),d+="</div>",r.append(d),l=!1),t.info.short_description&&(h=$('<div class="channel-description-text">'+t.info.short_description+"</div>"),t.info.short_description!=t.info.description&&(h.addClass("short-desc"),h.click({description:t.info.description},function(t){$(this).html(t.data.description).unbind("click").removeClass("short-desc")})),r.append(h),l=!1),t.info.items_count&&(_=[],t.info.channels_count&&_.push(t.info.channels_count+" "+jsu.translate("channel(s)")),t.info.videos_count&&_.push(t.info.videos_count+" "+jsu.translate("video(s)")),t.info.lives_count&&_.push(t.info.lives_count+" "+jsu.translate("live stream(s)")),t.info.pgroups_count&&_.push(t.info.pgroups_count+" "+jsu.translate("photos group(s)")),p='<div class="channel-items-count">'+jsu.translate("Channel content:"),p+=" <span>"+jsu.escapeHTML(_.join(", "))+"</span>",p+=' <button type="button" class="tooltip-button no-padding no-border no-background" aria-describedby="id_count_help" aria-label="'+jsu.translate("help")+'"><i class="fa fa-question-circle fa-fw" aria-hidden="true"></i><span role="tooltip" id="id_count_help" class="tooltip-hidden-content">'+jsu.translate("Sub channels items are included in counts.")+"</span></button>",p+="</div>",r.append(p),window.uwlb||$(".channel-items-count .tooltip-button",r).click(function(){$("span",this).toggle()}),l=!1),c&&(c='<div class="channel-storage-usage">'+jsu.translate("Storage usage:")+" "+c+"</div>",r.append(c),window.uwlb||$(".channel-storage-usage .tooltip-button",r).click(function(){$("span",this).toggle()}),l=!1),t.info.display_rss_links&&(u='<div class="channel-description-rss"> ',this.display_itunes_rss?(u+=' <span class="inline-block">'+jsu.translate("Subscribe to channel videos RSS:")+"</span>",u+=' <a class="nowrap" href="/channels/'+t.info.oid+'/rss.xml">',u+='<i class="fa fa-rss" aria-hidden="true"></i> '+jsu.translate("standard")+"</a>",u+=' <a class="nowrap" href="/channels/'+t.info.oid+'/itunes-video.xml">',u+='<i class="fa fa-apple" aria-hidden="true"></i> '+jsu.translate("iTunes")+"</a>",u+=' <a class="nowrap" href="/channels/'+t.info.oid+'/itunes-audio.xml">',u+='<i class="fa fa-apple" aria-hidden="true"></i> '+jsu.translate("iTunes (audio only)")+"</a>"):(u+=' <a class="nowrap" href="/channels/'+t.info.oid+'/rss.xml">',u+='<i class="fa fa-rss" aria-hidden="true"></i> '+jsu.translate("Subscribe to channel videos RSS")+"</a>"),u+="</div>",r.append(u),l=!1),l||this.$place.append(r)),$("head .csslistlink").remove(),t.info){for(m in b="",t.info.css_list)b+='<link class="csslistlink" rel="stylesheet" type="text/css" href="'+t.info.css_list[m]+'"/>';$("head").append(b)}t.info&&t.info.logo_url?$("#mainlogo .header-logo").attr("src",t.info.logo_url):$("#mainlogo .header-logo").attr("src",this.default_logo_src),t.info&&t.info.favicon_url?$("#favicon_link").attr("href",t.info.favicon_url):$("#favicon_link").attr("href",this.default_fav_src)}f=t.channels?t.channels.length:0,w=t.videos?t.videos.length:0,y=t.live_streams?t.live_streams.length:0,g=t.photos_groups?t.photos_groups.length:0,v=f>0||w>0||y>0||g>0,this.refresh_title(),v?this.browser.display_content(this.$place,t,e,"channels"):(j=-1!=this.browser.selectable_content.indexOf("c")?this.browser.displayable_content.length>1?"This channel contains no sub channels and no media.":"This channel contains no sub channels.":"This channel contains no media.",j=jsu.translate(j)+"<br/>",j+=jsu.translate("Some contents may still exist in this channel but if it is the case your account is not allowed to see them."),this.$place.append('<div class="messages"><div class="message info">'+j+"</div></div>"))}},MSBrowserChannels.prototype.refresh_display=function(t){t&&this.last_response&&(this.last_response=null),this.last_response?this._on_channel_content(this.last_response,this.current_channel_oid):this.browser.lti_mode?this.display_personal_channel():this.display_channel(this.current_channel_oid)},MSBrowserChannels.prototype.remove=function(t){if(this.current_channel_oid==t){var e=this.browser.catalog[t]&&this.browser.catalog[t].parent_oid?this.browser.catalog[t].parent_oid:"0";!this.browser.pick_mode&&this.browser.catalog[e]&&this.browser.catalog[e].slug?window.location.hash="#"+this.browser.catalog[e].slug:this.display_channel(e)}else this.browser.remove_oid_from_tab(this,t)},MSBrowser.prototype.build_widget=function(){var t,e,s,i,a,n;this.last_overlay_focus=document.activeElement,this.previous_focus=null,"self"==this.filter_speaker?(t=jsu.translate("My channel"),s=jsu.translate("My media"),e=jsu.translate("Search in my media")):(t=jsu.translate("Channels"),s=jsu.translate("Latest content"),e=jsu.translate("Search")),i='<div class="ms-browser ms-browser-container'+(this.use_overlay?" in-overlay":"")+(this.tree_manager?" has-tree":"")+(this.display_types_icons?" show-types-icons":"")+(this.hide_header?" no-header":"")+'">',i+='<div class="ms-browser-header">',i+='<div class="ms-browser-menu">',this.use_overlay?(i+='<button type="button" id="ms_browser_channels_tab" class="ms-browser-tab button '+this.btn_class+'" title="'+t+'" aria-label="'+t+'"><i class="fa fa-folder-open" aria-hidden="true"></i> <span class="hidden-below-800" aria-hidden="true">'+t+"</span></button>",i+='<button type="button" id="ms_browser_latest_tab" class="ms-browser-tab button '+this.btn_class+'" title="'+s+'" aria-label="'+s+'"><i class="fa fa-clock-o" aria-hidden="true"></i> <span class="hidden-below-800" aria-hidden="true">'+s+"</span></button>",i+='<button type="button" id="ms_browser_search_tab" class="ms-browser-tab button '+this.btn_class+'" title="'+e+'" aria-label="'+e+'"><i class="fa fa-search" aria-hidden="true"></i> <span class="hidden-below-800" aria-hidden="true">'+e+"</span></button>"):(i+='<a id="ms_browser_channels_tab" class="ms-browser-tab button '+this.btn_class+'" href="'+this.url_channels+'" title="'+t+'" aria-label="'+t+'"><i class="fa fa-folder-open" aria-hidden="true"></i> <span class="hidden-below-800" aria-hidden="true">'+t+"</span></a>",i+='<a id="ms_browser_latest_tab" class="ms-browser-tab button '+this.btn_class+'" href="'+this.url_latest+'" title="'+s+'" aria-label="'+s+'"><i class="fa fa-clock-o" aria-hidden="true"></i> <span class="hidden-below-800" aria-hidden="true">'+s+"</span></a>",i+='<a id="ms_browser_search_tab" class="ms-browser-tab button '+this.btn_class+'" href="'+this.url_search+'" title="'+e+'" aria-label="'+e+'"><i class="fa fa-search" aria-hidden="true"></i> <span class="hidden-below-800" aria-hidden="true">'+e+"</span></a>"),i+="</div>",i+='<h2 class="ms-browser-title"></h2>',i+="</div>",i+='<div class="ms-browser-bar">',i+="</div>",i+='<div class="ms-browser-main ms-items">',i+='<div class="ms-browser-clear"></div>',i+='<div class="ms-browser-loading"><div><i class="fa fa-spinner fa-spin" aria-hidden="true"></i> '+jsu.translate("Loading...")+"</div></div>",i+='<div class="ms-browser-message"><div></div></div>',i+="</div>",i+="</div>",this.$widget=$(i),!this.use_overlay&&$("nav .buttons-left").length>0?((n=$("nav .buttons-left")).addClass("ms-browser"),this.hide_header&&n.addClass("no-header"),n.append(this.get_top_menu_jq()),(a=$("#commands_place")).addClass("ms-browser"),this.hide_header&&a.addClass("no-header"),a.addClass("ms-browser-dropdown-right")):((n=$(".ms-browser-header",this.$widget)).addClass("ms-browser-dropdown-right"),n.prepend(this.get_top_menu_jq()),(a=$(".ms-browser-bar",this.$widget)).addClass("ms-browser-dropdown-right")),a.append(this.latest.get_menu_jq()),a.append(this.channels.get_menu_jq()),a.append(this.search.get_menu_jq()),this.$main=$(".ms-browser-main",this.$widget),this.$main.append(this.latest.get_content_jq()),this.$main.append(this.channels.get_content_jq()),this.$main.append(this.search.get_content_jq()),this.$main.append('<div class="ms-browser-clear"></div>'),this.$menu=$(".ms-browser-menu",this.$widget),this.place&&$(this.place).html(this.$widget),$("#ms_browser_channels_tab",this.$menu).click({obj:this},function(t){return t.data.obj.change_tab("channels"),!1}),$("#ms_browser_latest_tab",this.$menu).click({obj:this},function(t){return t.data.obj.change_tab("latest"),!1}),$("#ms_browser_search_tab",this.$menu).click({obj:this},function(t){return t.data.obj.change_tab("search"),!1})},MSBrowser.prototype.get_top_menu_jq=function(){var t,e,s,i,a=[{default:jsu.translate("Use default sorting")},{"creation_date-desc":jsu.translate("Creation date, descending")},{"creation_date-asc":jsu.translate("Creation date, ascending")},{"add_date-desc":jsu.translate("Add date, descending")},{"add_date-asc":jsu.translate("Add date, ascending")},{"title-desc":jsu.translate("Title, descending")},{"title-asc":jsu.translate("Title, ascending")},{"slug-desc":jsu.translate("Slug, descending")},{"slug-asc":jsu.translate("Slug, ascending")},{"views-desc":jsu.translate("Number of views, descending")},{"views-asc":jsu.translate("Number of views, ascending")}],n='<div class="ms-browser-top-buttons">';for(t in n+='<div class="ms-browser-dropdown" id="ms_browser_display_dropdown">',n+='<button aria-controls="ms_browser_display_dropdow_menu" aria-expanded="false" type="button" title="'+jsu.translate("Display")+'" class="button ms-browser-dropdown-button '+this.btn_class+'"><i class="fa fa-tv" aria-hidden="true"></i> <span class="hidden-below-1280">'+jsu.translate("Display")+' </span><i class="fa fa-angle-down" aria-hidden="true"></i></button>',n+='<div class="ms-browser-dropdown-menu" id="ms_browser_display_dropdow_menu">',n+="<div><h4>"+jsu.translate("Display mode:")+"</h4>",n+='<button type="button" class="button '+(this.display_as_thumbnails?"":"active")+'" id="ms_browser_display_as_list" title="'+jsu.translate("list")+(this.display_as_thumbnails?"":" ("+jsu.translate("selected setting")+")")+'">'+jsu.translate("list")+"</button>",n+='<button type="button" class="button '+(this.display_as_thumbnails?"active":"")+'" id="ms_browser_display_as_thumbnails" title="'+jsu.translate("thumbnails")+(this.display_as_thumbnails?" ("+jsu.translate("selected setting")+")":"")+'">'+jsu.translate("thumbnails")+"</button><br/>",n+='<input id="ms_browser_display_types_icons" type="checkbox" '+(this.display_types_icons?'checked="checked"':"")+">",n+=' <label for="ms_browser_display_types_icons">'+jsu.translate("display items type icons")+"</label></div>",n+='<div class="ms-browser-channel-order"><h4><label for="ms_browser_order_channel">'+jsu.translate("Sort by:")+"</label></h4>",n+=' <select id="ms_browser_order_channel">',a)for(e in a[t])n+='<option value="'+e+'">'+jsu.escapeHTML(a[t][e])+"</option>";n+="</select></div>",s='<option value="">'+jsu.translate("unspecified")+"</option>",s+='<option value="yes">'+jsu.translate("yes")+"</option>",s+='<option value="no">'+jsu.translate("no")+"</option>",n+='<div class="ms-browser-filters"><h4>'+jsu.translate("Filters:")+"</h4>",n+=' <form id="ms_browser_filters_form">',n+=' <label for="ms_browser_filter_editable">'+jsu.translate("Editable:")+"</label>",n+=' <select id="ms_browser_filter_editable">'+s+"</select>",(this.displayable_content.length>1||"c"!=this.displayable_content)&&(n+=" <br/>",n+=' <label for="ms_browser_filter_validated">'+jsu.translate("Published:")+"</label>",n+=' <select id="ms_browser_filter_validated">'+s+"</select>","self"!=this.filter_speaker&&(n+=" <br/>",n+=' <label for="ms_browser_filter_speaker">'+jsu.translate("Speaker:")+"</label>",n+=' <input type="text" id="ms_browser_filter_speaker" value="'+(this.filter_speaker?this.filter_speaker:"")+'"/>',n+=' <button type="submit" class="button">'+jsu.translate("Ok")+"</button>")),n+=" </form>",n+="</div>",n+="</div>",n+="</div>",n+="</div>",this.$top_menu=$(n),i=$("#ms_browser_display_dropdown",this.$top_menu),this.setup_dropdown(i),$("#ms_browser_display_as_list",i).click({obj:this,$dropdown:i},function(t){t.data.obj.set_display_as_list()}),$("#ms_browser_display_as_thumbnails",i).click({obj:this,$dropdown:i},function(t){t.data.obj.set_display_as_thumbnails()}),$("#ms_browser_display_types_icons",i).change({obj:this,$dropdown:i},function(t){t.data.obj.set_display_types_icons(this.checked)}),$("#ms_browser_order_channel",i).change({obj:this,$dropdown:i},function(t){t.data.obj.channels.set_order($(this).val()),t.data.obj.search.set_order($(this).val())}),$("#ms_browser_filters_form select",i).change({obj:this,$dropdown:i},function(t){$("#ms_browser_filters_form",t.data.$dropdown).submit()}),$("#ms_browser_filters_form",i).submit({obj:this,$dropdown:i},function(t){return t.data.obj.on_filters_submit($(this)),!1});try{this.focus_was_in_dropdown=!1,window.addEventListener("blur",function(){this.check_focus_dropdown()}.bind(this),!0),window.addEventListener("focus",function(){this.check_focus_dropdown()}.bind(this),!0)}catch(t){console.error("Failed to listen to focus changes: "+t)}return this.$top_menu},MSBrowser.prototype.set_title=function(t,e){if(e||(e=t),!this.use_overlay&&$("#global .main-title h1").length>0?($("#global .main-title h1").html(e),$("#global .main-title h1").attr("tabindex","-1"),$("#global .main-title h1").focus()):$(".ms-browser-title",this.$widget).html(e),!this.use_overlay&&document.title){if(!this.document_tilte_suffix){var s=document.title.indexOf(" - ");this.document_tilte_suffix=-1!=s?document.title.substring(s):" - MediaServer"}document.title=t+this.document_tilte_suffix}},MSBrowser.prototype.setup_dropdown=function(t){$(".ms-browser-dropdown-button",t).click({$dropdown:t},function(t){var e=$(".ms-browser-dropdown-button",t.data.$dropdown),s=$(".ms-browser-dropdown-menu",t.data.$dropdown);s.attr("tabindex","-1"),e.hasClass("active")?(e.removeClass("active"),e.attr("aria-expanded",!1),s.removeClass("active")):(e.addClass("active"),e.attr("aria-expanded",!0),s.addClass("active"))}),$(document).click({$dropdown:t},function(t){var e=$(".ms-browser-dropdown-button",t.data.$dropdown),s=$(".ms-browser-dropdown-menu",t.data.$dropdown);!e.hasClass("active")||s.is(t.target)||0!==s.has(t.target).length||e.is(t.target)||0!==e.has(t.target).length||(e.removeClass("active"),e.attr("aria-expanded",!1),s.removeClass("active"))})},MSBrowser.prototype.close_dropdown=function(t){var e=$(".ms-browser-dropdown-button",t),s=$(".ms-browser-dropdown-menu",t);e.hasClass("active")&&(e.removeClass("active"),e.attr("aria-expanded",!1),s.removeClass("active"))},MSBrowser.prototype.check_focus_dropdown=function(){var t,e;if(document.activeElement&&document.activeElement!=document.body){for(t=!1,e=document.activeElement;e;){if(e.className&&-1!=e.className.indexOf("ms-browser-dropdown-menu")){t=!0,this.focus_was_in_dropdown=!0;break}e=e.parentNode}!t&&this.focus_was_in_dropdown&&(this.focus_was_in_dropdown=!1,$(".ms-browser-dropdown-button.active").removeClass("active").attr("aria-expanded",!1),$(".ms-browser-dropdown-menu.active").removeClass("active"))}},MSBrowser.prototype.on_filters_submit=function(t){var e,s,i,a,n=[{type:"choice",id:"ms_browser_filter_editable",name:"filter_editable"},{type:"choice",id:"ms_browser_filter_validated",name:"filter_validated"}];for("self"!=this.filter_speaker&&n.push({type:"text",id:"ms_browser_filter_speaker",name:"filter_speaker"}),e=!1,s=0;s<n.length;s++)if((i=$("#"+n[s].id,t)).length>0){if(a=i.val(),"choice"==n[s].type)switch(a){case"yes":a=!0;break;case"no":a=!1;break;default:a=null}this[n[s].name]!==a&&(this[n[s].name]=a,e=!0)}e&&(this.channels.refresh_display(!0),this.latest.refresh_display(!0),this.search.refresh_display(!0))},MSBrowser.prototype.set_display_as_list=function(){var t=$("#ms_browser_display_as_thumbnails",this.$top_menu),e=$("#ms_browser_display_as_list",this.$top_menu);e.hasClass("active")||(this.display_as_thumbnails=!1,t.removeClass("active").attr("title",t.text()),e.addClass("active").attr("title",e.text()+" ("+jsu.translate("selected setting")+")"),this.use_overlay||$("#global").addClass("max-width-1200"),jsu.setCookie("catalog-display_mode","list"),this.channels.refresh_display(),this.latest.refresh_display(),this.search.refresh_display())},MSBrowser.prototype.set_display_as_thumbnails=function(){var t=$("#ms_browser_display_as_thumbnails",this.$top_menu),e=$("#ms_browser_display_as_list",this.$top_menu);t.hasClass("active")||(this.display_as_thumbnails=!0,e.removeClass("active").attr("title",e.text()),t.addClass("active").attr("title",t.text()+" ("+jsu.translate("selected setting")+")"),this.use_overlay||$("#global").removeClass("max-width-1200"),jsu.setCookie("catalog-display_mode","thumbnail"),this.channels.refresh_display(),this.latest.refresh_display(),this.search.refresh_display())},MSBrowser.prototype.set_display_types_icons=function(t){this.display_types_icons=t,t?this.$widget.addClass("show-types-icons"):this.$widget.removeClass("show-types-icons"),jsu.setCookie("catalog-display_types_icons",t?"yes":"no")},MSBrowser.prototype.get_active_tab=function(){var t=$(".ms-browser-tab.active",this.$menu),e=t.length>0?t.attr("id").replace(/_tab/g,"").replace(/ms_browser_/g,""):null;return e||this.pick_mode||($(".ms-browser").hasClass("channels")?e="channels":$(".ms-browser").hasClass("latest")?e="latest":$(".ms-browser").hasClass("search")&&(e="search")),e},MSBrowser.prototype.change_tab=function(t,e){var s,i=this.get_active_tab();i!=t&&(i&&this[i]&&($(".ms-browser").removeClass(i),$("#ms_browser_"+i+"_tab",this.$menu).removeClass("active").attr("title",$("#ms_browser_"+i+"_tab",this.$menu).text()),this[i].$menu.css("display","none"),this[i].$content.css("display","none")),$(".ms-browser").addClass(t),$("#ms_browser_"+t+"_tab",this.$menu).addClass("active").attr("title",$("#ms_browser_"+t+"_tab",this.$menu).text()+" ("+jsu.translate("selected tab")+")"),this[t]&&(this[t].$menu.css("display",""),this[t].$content.css("display",""),this[t].on_show()),"latest"!=t?$(".ms-browser-channel-order",this.$top_menu).css("display",""):$(".ms-browser-channel-order",this.$top_menu).css("display","none"),this.use_overlay||e||(s="search"==t?this.url_search:"latest"==t?this.url_latest:this.url_channels+window.location.hash,window.history.pushState({ms_tab:t},t,s)))},MSBrowser.prototype.display_loading=function(){if(isNaN(this.loading_count)?this.loading_count=1:this.loading_count++,!this.loading_timeout){var t=this;this.loading_timeout=setTimeout(function(){$(".ms-browser-loading",t.$widget).css("display","block"),t.loading_timeout=null},500)}},MSBrowser.prototype.hide_loading=function(){this.loading_count&&this.loading_count--,isNaN(this.loading_count)||this.loading_count>0||(this.loading_timeout&&(clearTimeout(this.loading_timeout),this.loading_timeout=null),$(".ms-browser-loading",this.$widget).css("display",""))},MSBrowser.prototype.display_content=function(t,e,s,i){var a,n,o,r=this.pick_mode?"h3":"h2",l='<ul class="ms-browser-section"></ul>';if(e.channels&&e.channels.length>0){for(n=-1!=this.selectable_content.indexOf("c"),s&&"0"!=s?t.append("<"+r+">"+jsu.translate("Sub channels")+"</"+r+">"):"search"==i&&t.append("<"+r+">"+jsu.translate("Channels")+"</"+r+">"),o=$(l),a=0;a<e.channels.length;a++)void 0===e.channels[a].parent_oid&&s&&(e.channels[a].parent_oid=s),o.append(this.get_content_entry("channel",e.channels[a],n,i));t.append(o)}if(e.live_streams&&e.live_streams.length>0){for(n=-1!=this.selectable_content.indexOf("l"),t.append("<"+r+">"+jsu.translate("Live streams")+"</"+r+">"),o=$(l),a=0;a<e.live_streams.length;a++)o.append(this.get_content_entry("live",e.live_streams[a],n,i));t.append(o)}if(e.videos&&e.videos.length>0){for(n=-1!=this.selectable_content.indexOf("v"),t.append("<"+r+">"+jsu.translate("Videos")+"</"+r+">"),o=$(l),a=0;a<e.videos.length;a++)o.append(this.get_content_entry("video",e.videos[a],n,i));t.append(o)}if(e.photos_groups&&e.photos_groups.length>0){for(n=-1!=this.selectable_content.indexOf("p"),t.append("<"+r+">"+jsu.translate("Photos groups")+"</"+r+">"),o=$(l),a=0;a<e.photos_groups.length;a++)o.append(this.get_content_entry("photos",e.photos_groups[a],n,i));t.append(o)}},MSBrowser.prototype.get_content_entry=function(t,e,s,i){var a,n,o,r,l,c,d;return this.update_catalog(e),a=e.oid,n=s&&(!this.parent_selection_oid||e.selectable),o=this.pick_mode&&(n||"channel"==t),r=null,(r=$('<li class="item-entry item-type-'+t+" item-entry-"+a+'"></li>')).attr("id","item_entry_"+a+"_"+i),r.addClass(this.display_as_thumbnails?"thumbnail":"list"),this.current_selection&&this.current_selection.oid==a&&(r.addClass("selected"),r.attr("title",e.title+" "+jsu.translate("selected"))),n&&r.addClass("selectable"),o&&r.addClass("clickable"),e.extra_class&&r.addClass(e.extra_class),l=this._get_entry_block_html(e,t,o,i),this.display_as_thumbnails&&!this.pick_mode&&(l+='<div class="item-entry-buttons">',l+='<button type="button" class="item-entry-info" title="'+jsu.translate("Open information panel")+'"><i class="fa fa-info" aria-hidden="true"></i></button>',e.can_edit&&(l+='<a title="'+jsu.translate("Edit")+'" href="'+this.get_button_link(e,"edit")+'"'+this.links_target+'><i class="fa fa-pencil" aria-hidden="true"></i></a>'),l+='<div class="overlay-info ms-items" id="item_entry_'+a+"_"+i+'_info" style="display: none;" role="dialog" tabindex="-1" aria-labelledby="item_entry_'+e.oid+"_"+i+'_info_title" aria-modal="true"></div>',l+="</div>"),c=$(l),this._set_on_click_entry_block(c,a,t,e,n),r.append(c),this.display_as_thumbnails?this._set_thumbnail_info_box_html(t,n,a,r,e,i):(d=this.get_entry_links(e,t,n))&&r.append(d),$(".item-entry-link",r).focus(function(){$(".item-entry").removeClass("focus"),$(this).parent().addClass("focus")}),r},MSBrowser.prototype._get_entry_block_html=function(t,e,s,i){var a,n,o,r,l,c,d,h,_,p,u="span",b="",m=' tabindex="0" role="button"';if(this.use_overlay||!t.slug||this.pick_mode&&"channel"!=e||(u="a",m="",b=' href="'+this.get_button_link(t,"view")+'"',"channel"!=e&&(b+=this.links_target)),a="<"+u+b+m+' class="item-entry-link"'+(s&&"channel"!=e?' title="'+jsu.translate("Click to select this media")+'"':"")+">",n='<span class="item-entry-preview">',n+='<span class="item-entry-preview-aligner"></span>',t.thumb&&(n+='<img src="'+t.thumb+'" alt=""'+(t.language?' lang="'+t.language+'"':"")+"/>"),this.pick_mode||"channel"==e||(n+='<b class="item-entry-preview-play"><i class="fa fa-play fa-4x" aria-hidden="true"></i></b>'),a+=n+="</span>",o='<span class="item-entry-content">',r='<span class="item-entry-top-bar">',"channel"==e?r+='<span class="item-entry-layout layout-channel" title="'+jsu.translate("This item is a channel")+'"></span>':"photos"==e?r+='<span class="item-entry-layout layout-pgroup" title="'+jsu.translate("This item is a photos group")+'"></span>':(r+='<span class="item-entry-layout ',t.layout?r+="layout-"+t.layout:r+="layout-video",r+='" title="',l=jsu.translate("live"==e?"This item is a live stream":"This item is a video"),t.layout&&("composition"==t.layout?l+=" ("+jsu.translate("dynamic Rich Media")+")":"webinar"==t.layout?l+=" ("+jsu.translate("classic Rich Media")+")":l+=" ("+t.layout.replace(/_/," ")+")"),r+=l,r+='"><span class="sr-only">'+l+"</span></span>"),t.can_edit&&("channel"==e?t.unlisted&&(r+='<span class="item-entry-unlisted" title="'+jsu.translate("This channel is unlisted")+'"><span class="sr-only">'+jsu.translate("This channel is unlisted")+"</span></span>"):(t.validated?t.unlisted?r+='<span class="item-entry-unlisted" title="'+jsu.translate("This media is published and unlisted")+'"><span class="sr-only">'+jsu.translate("This media is published and unlisted")+"</span></span>":r+='<span class="item-entry-published" title="'+jsu.translate("This media is published")+'"><span class="sr-only">'+jsu.translate("This media is published")+"</span></span>":r+='<span class="item-entry-notpublished" title="'+jsu.translate("This media is not published")+'"><span class="sr-only">'+jsu.translate("This media is not published")+"</span></span>","video"!=e||t.ready||(r+='<span class="item-entry-notready" title="'+jsu.translate("This video is not ready")+'"><span class="sr-only">'+jsu.translate("This video is not ready")+"</span></span>"))),t.duration&&(r+='<span class="item-entry-duration">'+t.duration+"</span>"),this.display_as_thumbnails||(r+='<span class="item-entry-title"'+(t.language?' lang="'+t.language+'"':"")+">"+jsu.escapeHTML(t.title)+"</span>"),o+=r+="</span>",c='<span class="item-entry-bottom-bar">',this.display_as_thumbnails?c+='<span class="item-entry-title"'+(t.language?' lang="'+t.language+'"':"")+">"+jsu.escapeHTML(t.title)+"</span>":(t.creation&&(c+='<span class="item-entry-date">'+jsu.translate("Created on")+" "+jsu.getDateDisplay(t.creation)+"</span>"),t.short_description&&(c+='<span class="item-entry-description">'+jsu.escapeHTML($("<span>"+t.short_description+"</span>").text())+"</span>"),t.views&&(c+='<span class="item-entry-views">'+t.views+" "+jsu.translate("views"),t.views_last_month&&(c+=", "+t.views_last_month+" "+jsu.translate("this month")),c+="</span>"),t.can_edit&&null!==t.storage_used&&void 0!==t.storage_used&&(d=this.msapi.get_storage_minimal_display(t))&&(c+='<span class="item-entry-storage">'+jsu.translate("Storage usage:")+" "+d+"</span>"),"latest"==i&&(c+='<span class="item-entry-type">'+jsu.translate("Type:")+" "+jsu.translate(e)+"</span>",t.add_date&&(c+='<span class="item-entry-date">'+jsu.translate("Added on")+" "+jsu.getDateDisplay(t.add_date)+"</span>"),t.parent_title&&(c+='<span class="item-entry-parent">'+jsu.translate("Parent channel:")+" "+jsu.escapeHTML(t.parent_title)+"</span>"))),o+=c+="</span>",a+=o+="</span>",a+="</"+u+">",!this.display_as_thumbnails&&!this.pick_mode&&"search"==i&&(t.annotations||t.photos)){if(a+='<span class="item-entry-extra">',t.annotations){for(a+="<span>"+jsu.translate("Matching annotations:")+"</span><ul>",h=0;h<t.annotations.length;h++)_=t.annotations[h],a+='<li><a href="'+this.get_button_link(t,"view")+"#start="+_.time+'&autoplay"'+this.links_target+">",_.title&&(a+=jsu.escapeHTML(_.title)),a+=" ("+_.time_display+") ",a+="</a></li>";a+="</ul>"}if(t.photos){for(a+="<span>"+jsu.translate("Matching photos:")+"</span><ul>",h=0;h<t.photos.length;h++)p=t.photos[h],a+='<li><a href="'+this.get_button_link(t,"view")+"#"+p.index+'"'+this.links_target+">",p.title&&(a+=jsu.escapeHTML(p.title)),a+=" (#"+p.index+") ",a+="</a></li>";a+="</ul>"}a+="</span>"}return a},MSBrowser.prototype._set_on_click_entry_block=function(t,e,s,i,a){this.pick_mode?("channel"==s||"parent"==s?t.click({obj:this,oid:e},function(t){t.data.obj.channels.display_channel(t.data.oid),t.data.obj.change_tab("channels"),jsu.focusFirstDescendant($("#ms_browser_channels .ms-browser-channels-place")[0])}):a&&t.click({obj:this,oid:e},function(t){t.data.obj.pick(t.data.oid)}),t.keydown(function(t){"32"!=t.which&&"13"!=t.which||(t.preventDefault(),t.stopPropagation(),$(this).trigger("click"))})):i.can_delete&&$(".item-entry-pick-delete-media",t).click({obj:this,oid:e},function(t){t.data.obj.pick(t.data.oid,"delete")})},MSBrowser.prototype.get_entry_links=function(t,e,s){var i,a,n,o,r,l,c="";return this.pick_mode?s&&(a=(i=this.current_selection&&this.current_selection.oid==t.oid)?"fa-check-circle":"fa-check",n="channel"==e||"current"==e?i?jsu.translate("This channel is selected"):jsu.translate("Select this channel"):i?jsu.translate("This media is selected"):jsu.translate("Select this media"),c+='<button type="button" class="'+this.btn_class+' button main item-entry-pick"><i class="fa '+a+'" aria-hidden="true"></i> <span class="hidden-below-800">'+jsu.translate(n)+"</span></button>"):"current"==e?(t.can_see_stats&&(c+='<button type="button" title="'+jsu.translate("Statistics")+'" class="'+this.btn_class+' button default item-entry-pick-stats-media"><i class="fa fa-bar-chart" aria-hidden="true"></i> <span class="hidden-below-800">'+jsu.translate("Statistics")+"</span></button>"),t.can_edit&&(c+='<a title="'+jsu.translate("Edit")+'" class="'+this.btn_class+' button default item-entry-pick item-entry-pick-edit-media" href="'+this.get_button_link(t,"edit")+'"'+this.links_target+'><i class="fa fa-pencil" aria-hidden="true"></i> <span class="hidden-below-800">'+jsu.translate("Edit")+"</span></a>",t.can_delete&&(c+='<button type="button" title="'+jsu.translate("Delete")+'" class="'+this.btn_class+' button danger item-entry-pick-delete-media"><i class="fa fa-trash" aria-hidden="true"></i> <span class="hidden-below-800">'+jsu.translate("Delete")+"</span></button>")),t.can_add_channel&&(o='<i class="fa fa-folder" aria-hidden="true"></i> <i class="fa fa-plus color-green" aria-hidden="true"></i>',c+='<a title="'+jsu.translate("Add a sub channel")+'" class="'+this.btn_class+' button item-entry-pick item-entry-pick-add-channel" href="'+this.get_button_link(t,"add_channel")+'"'+this.links_target+">"+o+' <span class="hidden-below-800">'+jsu.translate("Add a sub channel")+"</span></a>"),"0"!=t.oid&&t.can_add_video&&(r='<i class="fa fa-film" aria-hidden="true"></i> <i class="fa fa-plus color-green" aria-hidden="true"></i>',c+='<a title="'+jsu.translate("Add a video")+'" class="'+this.btn_class+' button item-entry-pick item-entry-pick-add-video" href="'+this.get_button_link(t,"add_video")+'"'+this.links_target+">"+r+' <span class="hidden-below-800">'+jsu.translate("Add a video")+"</span></a>")):("channel"!=e&&this.lti_mode&&(c+='<button type="button" class="'+this.btn_class+' button default item-entry-copy" data-link="'+this.get_button_link(t,"lti",!0)+'"><i class="fa fa-chain" aria-hidden="true"></i> <span class="hidden-below-440">'+jsu.translate("Copy LTI link")+"</span></button>"),("channel"!=e&&this.lti_mode||t.can_edit||t.can_delete)&&(c+='<a class="'+this.btn_class+' button default item-entry-pick-view-media" href="'+this.get_button_link(t,"view")+'"'+this.links_target+'><i class="fa fa-eye" aria-hidden="true"></i> <span class="hidden-below-440">'+jsu.translate("See")+"</span></a>"),t.can_edit&&(c+='<a class="'+this.btn_class+' button item-entry-pick-edit-media default" href="'+this.get_button_link(t,"edit")+'"'+this.links_target+'><i class="fa fa-pencil" aria-hidden="true"></i> <span class="hidden-below-440">'+jsu.translate("Edit")+"</span></a>"),t.can_delete&&(c+='<button type="button" class="'+this.btn_class+' button item-entry-pick-delete-media danger"><i class="fa fa-trash" aria-hidden="true"></i> <span class="hidden-below-440">'+jsu.translate("Delete")+"</span></button>")),c?(c='<span class="item-entry-links"><span class="item-entry-links-container">'+c+"</span></span>",l=$(c),"channel"!=e&&"parent"!=e||$(".item-entry-display",l).click({obj:this,item:t},function(t){t.data.obj.pick_mode&&t.data.obj.channels.display_channel(t.data.item.oid)}),s&&$(".item-entry-pick",l).click({obj:this,item:t},function(t){t.data.obj.pick(t.data.item.oid)}),!this.pick_mode&&"current"==e&&t.can_see_stats&&$(".item-entry-pick-stats-media",l).click({obj:this,item:t},function(t){t.data.obj.open_statistics(t.data.item.oid)}),!this.pick_mode&&t.can_delete&&$(".item-entry-pick-delete-media",l).click({obj:this,item:t},function(t){t.data.obj.pick(t.data.item.oid,"delete")}),$(".item-entry-copy",l).length>0&&$(".item-entry-copy",l).click(function(){var t,e,s=$(this),i=s.attr("data-link"),a=$('<input type="text" style="position: absolute; left: -10000px; top: 0;"/>').val(i);$("body").append(a),a.select();try{e=(t=document.execCommand("copy"))?"copied":"cannot copy"}catch(s){t=!1,e="failed to copy",console.log("Failed to copy to clipboard: "+s)}e='<i class="fa '+(t?"fa-check":"fa-warning")+'" aria-hidden="true"></i> '+jsu.escapeHTML(jsu.translate(e)),s.append('<span class="copy-msg">'+e+"</span>"),s.addClass("copied"),setTimeout(function(){s.removeClass("copied"),$(".copy-msg",s).remove()},1e3),a.remove()}),l):null},MSBrowser.prototype.get_button_link=function(t,e,s){var i="",a="",n="";if(t&&t.oid&&(n=t.oid[0]),e||n&&""!==n&&"0"!==n||t&&"0"!=t.oid)if("view"==e)t.slug||"0"==t.oid||this.get_info_for_oid(t.oid,!1,function(e){t=e.info}),"0"==n?(i="/channels/",a="#"):"c"==n?(i="/channels/",a="#"+t.slug):("l"==n?i="/lives/"+t.slug+"/":"v"==n?i="/videos/"+t.slug+"/":"p"==n&&(i="/photos/"+t.slug+"/"),i&&this.iframe_mode&&(i+="iframe/"));else if("lti"==e)i="/lti/"+t.oid+"/";else if("edit"==e)i=this.iframe_mode?"/edit/iframe/"+t.oid+"/":"/edit/"+t.oid+"/";else if("add_channel"==e)i="/add-content/channel/?in="+(t&&"0"!=t.oid?t.oid:"root");else{if("add_video"!=e)return console.error("Unrecognized action specified in MSBrowser.prototype.get_button_link call:",t,e,s),"";i="/add-content/",a="#add_media_by_upload",t&&"0"!=t.oid&&(i+="?in="+t.oid)}else i="/channels/",a="#";return s&&(i=window.location.protocol+"//"+window.location.host+i),this.links_url_params&&"lti"!=e&&(i+=(i.indexOf("?")<0?"?":"&")+this.links_url_params),i+a},MSBrowser.prototype._get_thumbnail_info_box_html=function(t,e,s,i){var a,n,o,r,l,c,d='<div><div tabindex="0"></div>';if(d+='<div class="trap-focus">',d+='<div class="overlay-info-title" id="item_entry_'+t.oid+"_"+i+'_info_title" >',d+='<button type="button" class="overlay-info-close button default '+this.btn_class+'" title="'+jsu.translate("Hide this window")+'" aria-label="'+jsu.translate("Hide this window")+'"><i class="fa fa-close" aria-hidden="true"></i></button>',d+='<h1><a href="'+this.get_button_link(t,"view")+'"'+this.links_target+">"+jsu.escapeHTML(t.title)+"</a></h1>",d+="</div>",d+='<div class="overlay-info-content">',!this.pick_mode&&"search"==i&&(t.annotations||t.photos)){if(t.annotations){for(d+="<div><b>"+jsu.translate("Matching annotations:")+"</b></div>",d+="<ul>",a=0;a<t.annotations.length;a++)n=t.annotations[a],d+='<li><a href="'+this.get_button_link(t,"view")+"#start="+n.time+'&autoplay"'+this.links_target+">",n.title&&(d+=jsu.escapeHTML(n.title)),d+=" ("+n.time_display+") ",d+="</a></li>";d+="</ul>"}if(t.photos){for(d+="<div><b>"+jsu.translate("Matching photos:")+"</b></div>",d+="<ul>",a=0;a<t.photos.length;a++)o=t.photos[a],d+='<li><a href="'+this.get_button_link(t,"view")+"#"+o.index+'"'+this.links_target+">",o.title&&(d+=jsu.escapeHTML(o.title)),d+=" (#"+o.index+") ",d+="</a></li>";d+="</ul>"}d+="<hr/>"}return d+='<table class="overlay-info-table">',d+='<caption class="sr-only">'+jsu.translate("Media information")+"</caption>",t.creation&&"video"==e&&(d+="<tr>",d+='<th scope="row" class="overlay-info-label">'+jsu.translate("Recording date")+" :</th>",d+="<td>"+jsu.getDateDisplay(t.creation)+"</td>",d+="</tr>"),t.add_date&&(d+="<tr>",d+='<th scope="row" class="overlay-info-label">'+jsu.translate("Publishing date")+" :</th>",d+="<td>"+jsu.getDateDisplay(t.add_date)+"</td>",d+="</tr>"),t.duration&&(d+="<tr>",d+='<th scope="row" class="overlay-info-label">'+jsu.translate("Duration")+" :</th>",d+="<td>"+t.duration+"</td>",d+="</tr>"),t.views_last_month&&(d+='<tr><th scope="row" class="overlay-info-label">'+jsu.translate("Views last month")+" :</th><td>"+t.views_last_month+"</td></tr>"),t.views&&(d+='<tr><th scope="row" class="overlay-info-label">'+jsu.translate("Views")+" :</th><td>"+t.views+"</td></tr>"),t.comments_last_month&&(d+='<tr><th scope="row" class="overlay-info-label">'+jsu.translate("Annotations last month")+" :</th><td>"+t.comments_last_month+"</td></tr>"),t.comments&&(d+='<tr><th scope="row" class="overlay-info-label">'+jsu.translate("Annotations")+" :</th><td>"+t.comments+"</td></tr>"),t.can_edit&&null!==t.storage_used&&void 0!==t.storage_used&&(r=this.msapi.get_storage_minimal_display(t))&&(d+='<tr><th scope="row" class="overlay-info-label">'+jsu.translate("Storage usage")+" :</th><td>"+r+"</td></tr>"),d+="</table>",t.short_description&&(d+="<hr/>",d+='<div class="float-container"><p>'+jsu.escapeHTML($("<span>"+t.short_description+"</span>").text())+"</p></div>"),d+="</div>",d+="</div>",d+='<div tabindex="0"></div></div>',l=$(d),(c=this.get_entry_links(t,e,s))&&$(".overlay-info-content",l).append(c),$(".overlay-info-close",l).click({obj:this},function(t){t.data.obj.box_hide_info()}),$(document).keydown({obj:this},function(e){$("#item_entry_"+t.oid+"_"+i+"_info").length&&27==e.keyCode&&(e.stopImmediatePropagation(),e.data.obj.box_hide_info())}),l},MSBrowser.prototype._set_thumbnail_info_box_html=function(t,e,s,i,a,n){$(".item-entry-info",i).click({obj:this,$entry:i},function(o){var r,l="#"+i.attr("id")+"_info";o.data.obj.previous_focus=this,""===$(l,o.data.$entry).html()?"search"==n?(r=o.data.obj._get_thumbnail_info_box_html(a,t,e,n),$(l,o.data.$entry).append(r),o.data.obj.box_open_info(i)):o.data.obj.get_info_for_oid(s,!0,function(s){var a,r=s.info;o.data.obj.update_catalog(s.info),a=o.data.obj._get_thumbnail_info_box_html(r,t,e,n),$(l,o.data.$entry).append(a),o.data.obj.box_open_info(i)}):o.data.obj.box_open_info(i)})},MSBrowser.prototype.trap_focus=function(t,e){jsu.ignoreUntilFocusChanges||(t.contains(e.target)?this.last_overlay_focus=e.target:(jsu.focusFirstDescendant(t),this.last_overlay_focus==document.activeElement&&jsu.focusLastDescendant(t),this.last_overlay_focus=document.activeElement))},MSBrowser.prototype.box_open_info=function(t){var e,s,i,a,n,o,r;this.box_hide_info(),e="#"+t.attr("id")+"_info",(s=$(e)).hasClass("moved")||s.addClass("moved").detach().appendTo("body"),s.is(":visible")||(i=$(".item-entry-preview",t),a=parseInt(i.offset().top,10)-1,n=parseInt(i.offset().left,10)+i.width(),o="auto",$(window).width()/2-n<0&&(n="auto",o=$(window).width()-parseInt(i.offset().left,10)),s.css("left",n+"px"),s.css("right",o+"px"),s.css("top",a+"px"),$(".item-entry-info",t).addClass("info-displayed"),s.fadeIn("fast"),this.last_overlay_focus=document.activeElement,s.focusin(this.trap_focus.bind(this,$(".trap-focus",s)[0])),jsu.focusFirstDescendant($(".trap-focus",s)[0]),this.box_click_handler&&$(document).unbind("click",this.box_click_handler),r=this,this.box_click_handler=function(t){$(t.target).closest(e).length||$(t.target).closest(".item-entry-info").length||!$(e).is(":visible")||r.box_hide_info()},$(document).click(this.box_click_handler))},MSBrowser.prototype.box_hide_info=function(){$(".overlay-info:visible").length&&($(".overlay-info:visible").off("focusin"),this.last_overlay_focus=document.activeElement,$(".overlay-info:visible").fadeOut("fast"),$(".item-entry-info.info-displayed").removeClass("info-displayed"),this.previous_focus&&this.previous_focus.focus())},MSBrowser.prototype.display_categories=function(){var t,e,s,i=this;if(this.site_settings_categories.length>0){for(t=' <button type="button" id="open_hidden_categories" class="button">'+jsu.translate("Categories")+' <i class="fa fa-angle-down" aria-hidden="true"></i></button>',t+=' <div id="hidden_categories" class="hidden-visibility">',t+=' <label for="filter_no_categories"><input id="filter_no_categories" type="checkbox"/><span>'+jsu.translate("Unspecified")+"</span></label><br />",e=0;e<this.site_settings_categories.length;e++)t+=' <label for="'+(s=jsu.escapeAttribute(this.site_settings_categories[e][0]))+'"><input class="checkbox" id="'+s+'" type="checkbox" value="'+s+'"/><span>'+jsu.escapeHTML(this.site_settings_categories[e][1])+"</span></label>";t+=" </div>",$(".ms-browser-filters",this.$top_menu).append(t),$("#open_hidden_categories",this.$top_menu).click(function(){$("#hidden_categories").hasClass("hidden-visibility")?($(".fa",this).removeClass("fa-angle-down").addClass("fa-angle-up"),$("#hidden_categories").removeClass("hidden-visibility")):($("#hidden_categories").addClass("hidden-visibility"),$(".fa",this).removeClass("fa-angle-up").addClass("fa-angle-down"))}),$("#hidden_categories .checkbox",this.$top_menu).click(function(){var t=this.checked;i.filter_no_categories=!1,$("#filter_no_categories",i.$top_menu).prop("checked",!1),t?i.filter_categories.push(this.value):i.filter_categories.splice(i.filter_categories.indexOf(this.value),1),i.channels.refresh_display(!0),i.latest.refresh_display(!0),i.search.refresh_display(!0)}),$("#filter_no_categories",this.$top_menu).click(function(){this.checked?(i.filter_categories=[],$("#hidden_categories .checkbox",i.$top_menu).prop("checked",!1),i.filter_no_categories=!0,i.channels.refresh_display(!0),i.latest.refresh_display(!0),i.search.refresh_display(!0)):(i.filter_no_categories=!1,i.channels.refresh_display(!0),i.latest.refresh_display(!0),i.search.refresh_display(!0))})}},MSBrowser.prototype.remove_oid_from_tab=function(t,e){var s,i,a,n;if($(".item-entry-"+e,t.$content).remove(),t.last_response)for(s=["items","channels","live_streams","videos","photos_groups"],i=0;i<s.length;i++){if(a=-1,t.last_response[s[i]])for(n=0;n<t.last_response[s[i]].length;n++)if(t.last_response[s[i]][n].oid==e){a=n;break}if(-1!=a){t.last_response[s[i]].splice(a,1);break}}},MSBrowser.prototype.open_statistics=function(t){this.overlay_stats||(this.overlay_stats=new OverlayDisplayManager),this.overlay_stats.show({title:jsu.translate("See statistics on this channel"),iframe:"/statistics/iframe/"+t+"/?period=last_year"})},MSBrowserLatest.prototype.get_displayable_content=function(){var t=this.browser.displayable_content;return t.length>1&&this.browser.lti_mode&&-1!=t.indexOf("c")&&(t=t.replace(/c/g,"")),t},MSBrowserLatest.prototype.get_menu_jq=function(){var t=this.get_displayable_content(),e="";return e+='<div id="ms_browser_latest_menu" style="display: none;">',t.length>1&&(e+='<div class="ms-browser-dropdown" id="ms_browser_latest_types_dropdown">',e+='<button type="button" aria-controls="ms_browser_latest_types_dropdown_menu" aria-expanded="false" class="button ms-browser-dropdown-button '+this.browser.btn_class+'">'+jsu.translate("Content types")+' <i class="fa fa-angle-down" aria-hidden="true"></i></button>',e+='<div class="ms-browser-dropdown-menu ms-browser-latest-types" id="ms_browser_latest_types_dropdown_menu">',e+="<h4>"+jsu.translate("Content types to display:")+"</h4>",-1!=t.indexOf("c")&&(e+='<p><input id="latest_display_channel" type="checkbox">',e+=' <label for="latest_display_channel">'+jsu.translate("channels")+"</label></p>"),-1!=t.indexOf("v")&&(e+='<p><input id="latest_display_video" type="checkbox">',e+=' <label for="latest_display_video">'+jsu.translate("videos")+"</label></p>"),-1!=t.indexOf("l")&&(e+='<p><input id="latest_display_live" type="checkbox">',e+=' <label for="latest_display_live">'+jsu.translate("live streams")+"</label></p>"),-1!=t.indexOf("p")&&(e+='<p><input id="latest_display_photos" type="checkbox">',e+=' <label for="latest_display_photos">'+jsu.translate("photos")+"</label></p>"),e+="</div>",e+="</div>"),e+="</div>",this.$menu=$(e),t.length>1&&(this.browser.setup_dropdown($("#ms_browser_latest_types_dropdown",this.$menu)),$(".ms-browser-latest-types input",this.$menu).change({obj:this},function(t){var e,s;t.data.obj.refresh_display(!0),e=this.id.split("_")[2][0],(s=jsu.getCookie("catalog-lastest_types"))||(s="vlp"),this.checked?-1==s.indexOf(e)&&(s+=e):s=s.replace(new RegExp(e),""),jsu.setCookie("catalog-lastest_types",s)})),this.$menu},MSBrowserLatest.prototype.get_content_jq=function(){var t=jsu.translate("Display {count} more items"),e="";return e+='<div id="ms_browser_latest" class="ms-browser-content" style="display: none;">',e+='<div class="messages">',e+='<div class="message info">'+jsu.translate("This list presents all media and channels ordered by add date.")+"</div>",e+="</div>",e+='<div class="ms-browser-latest-place"></div>',e+='<div class="ms-browser-latest-btns">',e+='<button type="button" class="button ms-browser-latest-more-10">'+t.replace(/\{count\}/,"10")+"</button>",e+='<button type="button" class="button ms-browser-latest-more-30">'+t.replace(/\{count\}/,"30")+"</button>",e+="</div>",e+="</div>",this.$content=$(e),this.$place=$(".ms-browser-latest-place",this.$content),$(".ms-browser-latest-more-10",this.$content).click({obj:this},function(t){t.data.obj.display_more(10)}),$(".ms-browser-latest-more-30",this.$content).click({obj:this},function(t){t.data.obj.display_more(30)}),this.$content},MSBrowserLatest.prototype.on_show=function(){var t;this.browser.set_title("latest",jsu.translate("Latest content added")),this.initialized||(this.initialized=!0,this.get_displayable_content().length>1&&((t=jsu.getCookie("catalog-lastest_types"))||(t="vlp"),$(".ms-browser-latest-types #latest_display_channel",this.$menu).prop("checked",-1!=t.indexOf("c")),$(".ms-browser-latest-types #latest_display_video",this.$menu).prop("checked",-1!=t.indexOf("v")),$(".ms-browser-latest-types #latest_display_live",this.$menu).prop("checked",-1!=t.indexOf("l")),$(".ms-browser-latest-types #latest_display_photos",this.$menu).prop("checked",-1!=t.indexOf("p"))),this.load_latest())},MSBrowserLatest.prototype.load_latest=function(t,e){var s,i,a,n,o;if(!this.latest_loading){if(this.latest_loading=!0,i={},(s=this.get_displayable_content()).length>1?(i.content="",-1!=s.indexOf("c")&&$("#latest_display_channel",this.$menu).is(":checked")&&(i.content+="c"),-1!=s.indexOf("v")&&$("#latest_display_video",this.$menu).is(":checked")&&(i.content+="v"),-1!=s.indexOf("l")&&$("#latest_display_live",this.$menu).is(":checked")&&(i.content+="l"),-1!=s.indexOf("p")&&$("#latest_display_photos",this.$menu).is(":checked")&&(i.content+="p")):s&&(i.content=s),null!==this.browser.filter_editable&&(i.editable=this.browser.filter_editable?"yes":"no"),null!==this.browser.filter_validated&&(i.validated=this.browser.filter_validated?"yes":"no"),null!==this.browser.filter_speaker&&(i.speaker=this.browser.filter_speaker),this.browser.filter_no_categories?i.no_categories=!0:this.browser.filter_categories.length>0&&(i.categories=this.browser.filter_categories.join("\n")),a=0,this.start_date&&(i.start=this.start_date,a=parseInt(this.start_date.replace(new RegExp("[-_]","g"),""),10),isNaN(a)&&(a=0)),e){if(n=parseInt(e.replace(new RegExp("[-_]","g"),""),10),a>0&&!isNaN(n)&&n>=a)return this.latest_loading=!1,void console.log("cancelled");i.end=e}t&&(i.count=t),o=this,this.browser.display_loading(),this.browser.msapi.ajax_call("get_latest_content",i,function(t){t.items&&t.items.length>0&&(o.last_response?o.last_response.items=o.last_response.items.concat(t.items):o.last_response=t),o._on_ajax_response(t),o.latest_loading=!1})}},MSBrowserLatest.prototype._on_ajax_error=function(t){var e,s='<div class="messages">';this.browser.use_overlay||"403"!=t.error_code&&"401"!=t.error_code?s+='<div class="message error">'+t.error+"</div>":(e=this.browser.url_login+"?next="+window.location.pathname+(window.location.hash?window.location.hash.substring(1):""),s+='<div class="item-description">',s+='<div class="message error">'+t.error+"</div>",s+="<p>"+jsu.translate("Please login to access this page")+'<br /> <a href="'+e+'">'+jsu.translate("Sign in")+"</a></p>",s+="</div>"),s+="</div>",this.$place.html(s)},MSBrowserLatest.prototype._on_ajax_response=function(t){var e,s,i,a,n,o;if(this.browser.hide_loading(),!t.success)return this._on_ajax_error(t);for(t.can_add_channel&&(this.can_add_channel=!0),t.can_add_video&&(this.can_add_video=!0),this.start_date=t.max_date,this.more=!0===t.more,e=0;e<t.items.length;e++)(s=t.items[e]).date_label&&s.date_label!=this.date_label?(this.date_label=s.date_label,i=this.browser.pick_mode?"h3":"h2",this.$place.append("<"+i+">"+s.date_label+"</"+i+">"),this.$section=$('<ul class="ms-browser-section"></ul>'),this.$place.append(this.$section)):this.$section||(this.$section=$('<ul class="ms-browser-section"></ul>'),this.$place.append(this.$section),console.log("A browser section is missing in latest tab. This should not happen.",s.date_label,this.date_label)),a="channel","v"==s.type&&(a="video"),"l"==s.type&&(a="live"),"p"==s.type&&(a="photos"),n=-1!=this.browser.selectable_content.indexOf(s.type),this.$section.append(this.browser.get_content_entry(a,s,n,"latest"));null===this.$section&&(o=$('<div class="messages"><div class="message info">'+jsu.translate("No contents.")+"</div></div>"),this.$place.append(o)),this.more?$(".ms-browser-latest-btns",this.$content).css("display","block"):$(".ms-browser-latest-btns",this.$content).css("display","none")},MSBrowserLatest.prototype.display_more=function(t){this.more&&this.load_latest(t)},MSBrowserLatest.prototype.refresh_display=function(t){t&&(this.last_response=null),this.last_response?(this.date_label="",this.$section=null,this.$place.html(""),this._on_ajax_response(this.last_response)):(this.more=!1,this.start_date="",this.date_label="",this.$section=null,this.$place.html(""),this.load_latest())},MSBrowserLatest.prototype.remove=function(t){this.browser.remove_oid_from_tab(this,t)},MSBrowserSearch.prototype.get_displayable_content=function(){var t=this.browser.displayable_content;return t.length>1&&this.browser.lti_mode&&-1!=t.indexOf("c")&&(t=t.replace(/c/g,"")),t},MSBrowserSearch.prototype.should_be_displayed=function(t,e){if(!e)return!0;for(var s=0;s<t.length;s++)if(-1!=e.indexOf(t[s]))return!0;return!1},MSBrowserSearch.prototype.get_menu_jq=function(){var t,e,s=this.get_displayable_content(),i="";for(i+='<div id="ms_browser_search_menu" style="display: none;">',i+='<form class="ms-browser-search-form" method="get" action="." onsubmit="javascript: return false;">',i+='<label for="ms_browser_search_text"><span class="hidden-below-800">'+jsu.translate("Search:")+"</span></label>",i+=' <input id="ms_browser_search_text" type="text" value="">',i+=' <button type="submit" class="button" id="ms_browser_search_start">'+jsu.translate("Go")+"</button>",i+="</form>",i+='<div class="ms-browser-dropdown" id="ms_browser_search_in_dropdown">',i+='<button type="button" aria-controls="ms_browser_search_in_dropdown_menu" aria-expanded="false" class="button ms-browser-dropdown-button '+this.browser.btn_class+'">'+jsu.translate("Search in")+' <i class="fa fa-angle-down" aria-hidden="true"></i></button>',i+='<div class="ms-browser-dropdown-menu ms-browser-search-in" id="ms_browser_search_in_dropdown_menu">',i+=' <div><button type="button" class="button" id="ms_browser_search_in_all">'+jsu.translate("all")+"</button>",i+=' <button type="button" class="button" id="ms_browser_search_in_none">'+jsu.translate("none")+"</button></div>",t=0;t<this.search_in_fields.length;t++)e=this.search_in_fields[t],this.should_be_displayed(s,e.items)&&(i+=' <div><input id="ms_browser_search_'+e.name+'" type="checkbox" '+(e.initial?'checked="checked"':"")+">",i+=' <label for="ms_browser_search_'+e.name+'">'+jsu.escapeHTML(jsu.translate(e.label))+"</label></div>");if(i+="</div>",i+="</div>",s.length>1){for(i+='<div class="ms-browser-dropdown" id="ms_browser_search_for_dropdown">',i+='<button type="button" aria-controls="ms_browser_search_for_dropdown_menu" aria-expanded="false" class="button ms-browser-dropdown-button '+this.browser.btn_class+'">'+jsu.translate("Search for")+' <i class="fa fa-angle-down" aria-hidden="true"></i></button>',i+='<div class="ms-browser-dropdown-menu ms-browser-search-for" id="ms_browser_search_for_dropdown_menu">',i+=' <div><button type="button" class="button" id="ms_browser_search_for_all">'+jsu.translate("all")+"</button>",i+=' <button type="button" class="button" id="ms_browser_search_for_none">'+jsu.translate("none")+"</button></div>",t=0;t<this.search_for_fields.length;t++)e=this.search_for_fields[t],this.should_be_displayed(s,e.items)&&(i+=' <div><input id="ms_browser_search_'+e.name+'" type="checkbox" '+(e.initial?'checked="checked"':"")+">",i+=' <label for="ms_browser_search_'+e.name+'">'+jsu.escapeHTML(jsu.translate(e.label))+"</label></div>");i+="</div>",i+="</div>"}return i+="</div>",this.$menu=$(i),this.browser.setup_dropdown($("#ms_browser_search_in_dropdown",this.$menu)),this.browser.setup_dropdown($("#ms_browser_search_for_dropdown",this.$menu)),$("form",this.$menu).submit({obj:this},function(t){t.data.obj.on_search_submit()}),$("#ms_browser_search_in_all",this.$menu).click({obj:this},function(t){$(".ms-browser-search-in input[type=checkbox]",t.data.obj.$main).prop("checked",!0),t.data.obj.on_search_submit()}),$("#ms_browser_search_in_none",this.$menu).click({obj:this},function(t){$(".ms-browser-search-in input[type=checkbox]",t.data.obj.$main).prop("checked",!1),t.data.obj.on_search_submit()}),$("#ms_browser_search_for_all",this.$menu).click({obj:this},function(t){$(".ms-browser-search-for input[type=checkbox]",t.data.obj.$main).prop("checked",!0),t.data.obj.on_search_submit()}),$("#ms_browser_search_for_none",this.$menu).click({obj:this},function(t){$(".ms-browser-search-for input[type=checkbox]",t.data.obj.$main).prop("checked",!1),t.data.obj.on_search_submit()}),$("input[type=checkbox]",this.$menu).change({obj:this},function(t){t.data.obj.on_search_submit()}),this.$menu},MSBrowserSearch.prototype.get_content_jq=function(){var t="";return t+='<div id="ms_browser_search" class="ms-browser-content" style="display: none;">',t+='<div class="messages"><div class="message info">'+jsu.translate("Use the input above to search for something.")+"</div></div>",t+="</div>",this.$content=$(t),this.$content},MSBrowserSearch.prototype.on_show=function(){this.browser.set_title(this.current_title?this.current_title:jsu.translate("Search")),this.initialized||(this.initialized=!0,this.on_url_change(),this.browser.use_overlay||"search"!=this.browser.get_active_tab()||$("#top_search_form form").submit({obj:this},function(t){return $("#ms_browser_search_text").val($("#top_search_input").val()),t.data.obj.on_search_submit(),!1}))},MSBrowserSearch.prototype.set_order=function(t){this.order=t||"default",this.refresh_display(!0)},MSBrowserSearch.prototype.on_url_change=function(){var t,e,s,i,a;if(this.initialized){for(t=this.browser.parse_url(),e=this.get_displayable_content(),s=0;s<this.search_in_fields.length;s++)i=this.search_in_fields[s],this.should_be_displayed(e,i.items)&&(a=t.has_in_vals?!!t[i.name]:i.initial,$("#ms_browser_search_"+i.name,this.$menu).prop("checked",a));for(s=0;s<this.search_for_fields.length;s++)i=this.search_for_fields[s],this.should_be_displayed(e,i.items)&&(a=t.has_for_vals?!!t[i.name]:i.initial,$("#ms_browser_search_"+i.name,this.$menu).prop("checked",a));t.text&&($("#ms_browser_search_text",this.$menu).val(t.text),this.on_search_submit(!0))}},MSBrowserSearch.prototype.on_search_submit=function(t){var e,s,i,a,n,o,r,l,c,d,h=$("#ms_browser_search_text",this.$menu).val();if(h){for(this.browser.display_loading(),e=this.get_displayable_content(),s="text="+h,i="",a=0;a<this.search_in_fields.length;a++)n=this.search_in_fields[a],this.should_be_displayed(e,n.items)&&$("#ms_browser_search_"+n.name,this.$menu).is(":checked")&&(i+=n.name.substring(2),s+="&"+n.name);for(i=i?i.substring(1):"metadata",o="",a=0;a<this.search_for_fields.length;a++)n=this.search_for_fields[a],this.should_be_displayed(e,n.items)&&$("#ms_browser_search_"+n.name,this.$menu).is(":checked")&&(o+=n.name.substring(4,5),s+="&"+n.name);o||(o=e),r={search:h,content:o,order_by:this.order,fields:i},null!==this.browser.filter_editable&&(r.editable=this.browser.filter_editable?"yes":"no"),null!==this.browser.filter_validated&&(r.validated=this.browser.filter_validated?"yes":"no"),null!==this.browser.filter_speaker&&(r.speaker=this.browser.filter_speaker),this.browser.filter_no_categories?r.no_categories=!0:this.browser.filter_categories.length>0&&(r.categories=this.browser.filter_categories.join("\n")),l=jsu.escapeHTML(jsu.translate("Search results for:")+" "+h),this.current_title=l,this.browser.set_title(l),this.browser.pick_mode||t||((c=this.browser.url_search).indexOf("?")<0?c+="?"+s:c+="&"+s,this.last_url&&this.last_url==c||(this.last_url=c,window.history.pushState({ms_tab:"search",search:h},l,c))),d=this,this.browser.msapi.ajax_call("search",r,function(t){d._on_ajax_response(t),window.ga_pageview&&window.ga_pageview("ajax search","/ajax_search?search="+r.search+"&fields="+r.fields)})}},MSBrowserSearch.prototype._on_ajax_error=function(t){var e,s;this.last_response=null,e='<div class="messages">',this.browser.use_overlay||"403"!=t.error_code&&"401"!=t.error_code?e+='<div class="message error">'+jsu.escapeHTML(t.error)+"</div>":(s=this.browser.url_login+"?next="+window.location.pathname+(window.location.hash?window.location.hash.substring(1):""),e+='<div class="item-description">',e+='<div class="message error">'+jsu.escapeHTML(t.error)+"</div>",e+="<p>"+jsu.translate("Please login to access this page")+'<br /> <a href="'+s+'">'+jsu.translate("Sign in")+"</a></p>",e+="</div>"),e+="</div>",this.$content.html(e)},MSBrowserSearch.prototype._on_ajax_response=function(t){var e,s,i,a,n,o,r;if(this.browser.hide_loading(),!t.success)return this._on_ajax_error(t);this.last_response=t,e=t.channels?t.channels.length:0,s=t.videos?t.videos.length:0,i=t.live_streams?t.live_streams.length:0,a=t.photos_groups?t.photos_groups.length:0,n=e>0||s>0||i>0||a>0,this.$content.html(""),n?(o=[],e>0&&o.push(e+" "+jsu.translate("channel(s)")),s>0&&o.push(s+" "+jsu.translate("video(s)")),i>0&&o.push(i+" "+jsu.translate("live stream(s)")),a>0&&o.push(a+" "+jsu.translate("photos group(s)")),r='<div class="ms-browser-search-matching"><b>'+jsu.translate("Matching items:")+"</b> "+jsu.escapeHTML(o.join(", "))+"</div>",this.$content.append(r),this.browser.display_content(this.$content,t,null,"search")):this.$content.html('<div class="messages"><div class="message info">'+jsu.translate("No results.")+"</div></div>")},MSBrowserSearch.prototype.refresh_display=function(t){t&&this.last_response&&(this.last_response=null),this.last_response?this._on_ajax_response(this.last_response):this.on_search_submit(!0)},MSBrowserSearch.prototype.remove=function(t){this.browser.remove_oid_from_tab(this,t)},MSBrowser.prototype.init=function(){var t,e,s,i;this.initialized||(this.initialized=!0,"thumbnail"==jsu.getCookie("catalog-display_mode")&&(this.display_as_thumbnails=!0,this.use_overlay||$("#container").removeClass("max-width-1200")),"yes"==jsu.getCookie("catalog-display_types_icons")&&(this.display_types_icons=!0),t=this.parse_url(),this.use_overlay||(this.pick_mode=!1,e=[],t.iframe&&(this.iframe_mode=!0,this.url_login="/login/iframe/",e.push("iframe")),t.speaker&&(this.filter_speaker=t.speaker,e.push("speaker="+window.encodeURIComponent(this.filter_speaker))),t.mine&&(this.filter_speaker="self",e.push("mine"),this.tree_manager=!1),t.lti&&(this.lti_mode=!0,e.push("lti")),t.newtab&&(this.links_target=' target="_blank"',e.push("newtab")),t.pick&&(this.pick_mode=!0,t.pick.toString().match(/^[cvlp]+$/)?(this.selectable_content=t.pick,this.displayable_content=t.pick,this.displayable_content.indexOf("c")<0&&(this.displayable_content="c"+this.displayable_content)):(this.selectable_content="vlp",this.displayable_content="cvlp"),e.push("pick="+this.selectable_content),!this.initial_oid&&t.initial&&(this.initial_oid=t.initial.toString(),e.push("initial="+window.encodeURIComponent(this.initial_oid)))),t.return&&(window.parent&&0===t.return.toString().indexOf("postMessageAPI")||0===t.return.toString().indexOf("https://")&&t.return.toString().length>8)&&(this.pick_mode||(this.pick_mode=!0,this.selectable_content="vlp",this.displayable_content="cvlp",e.push("pick="+this.selectable_content)),e.push("return="+t.return),s=window.parent&&0===t.return.toString().indexOf("postMessageAPI")?t.return:this.url_post_link+"?return="+t.return,this.on_pick=function(t,e){var i,a;e||(0===s.indexOf("postMessageAPI")?(i=window.opener?window.opener.parent:window.parent,a=s.substring("postMessageAPI".length).replace(/^:+|:+$/g,""),i.postMessage({item:t,initial_pick:!!e,target:a},"*"),window.opener&&window.close()):window.location=s+"&oid="+t.oid)}),e.length>0&&(this.links_url_params=e.join("&"),this.url_login+="?"+this.links_url_params,this.url_channels+="?"+this.links_url_params,this.url_latest+="?"+this.links_url_params,this.url_search+="?"+this.links_url_params)),this.init_options.browser=this,this.current_selection&&this.current_selection.oid&&(0!==this.current_selection.oid.indexOf("c")&&isNaN(parseInt(this.current_selection.oid,10))?this.init_options.current_channel_oid=this.current_selection.parent_oid:this.init_options.current_channel_oid=this.current_selection.oid),this.channels=new MSBrowserChannels(this.init_options),this.latest=new MSBrowserLatest(this.init_options),this.search=new MSBrowserSearch(this.init_options),this.build_widget(),this.initial_state&&this.initial_state.tab?this.change_tab(this.initial_state.tab,!0):this.change_tab("channels",!0),this.initial_oid&&this.pick(this.initial_oid,null,!0),i=this,this.use_overlay?this.overlay=new OverlayDisplayManager:$(window).bind("hashchange",function(){i.on_url_change()}),this.load_categories(),$(window).resize(function(){i.on_resize()}),this.on_resize())},MSBrowser.prototype.open=function(){this.use_overlay&&(this.init(),this.overlay.show({mode:"html",title:this.title,html:this.$widget}))},MSBrowser.prototype.update_catalog=function(t,e){if(t&&t.oid)if(this.catalog[t.oid]){for(var s in t)this.catalog[t.oid][s]=t[s];e&&(this.catalog[t.oid].is_full=!0)}else e&&(t.is_full=!0),this.catalog[t.oid]=t},MSBrowser.prototype.get_info_for_oid=function(t,e,s){var i=t&&("v"==t[0]||"l"==t[0]||"p"==t[0]);return this.get_info({oid:t},i,e,s)},MSBrowser.prototype.get_info_for_slug=function(t,e,s,i){return this.get_info({slug:t},e,s,i)},MSBrowser.prototype.get_info=function(t,e,s,i){var a,n,o,r,l;if((t.oid||t.slug)&&i){for(o in a=t.oid?"oid":"slug",n=null,this.catalog)if((!e&&"c"==o[0]||e&&"c"!=o[0])&&this.catalog[o][a]==t[a]){s?this.catalog[o].is_full&&(n=this.catalog[o]):n=this.catalog[o];break}if(n)return i({success:!0,info:n});this.display_loading(),s&&(t.full="yes"),r=e?"get_medias":"get_channels",l=this,this.msapi.ajax_call(r,t,function(t){t.success&&l.update_catalog(t.info,s),l.hide_loading(),i(t)})}},MSBrowser.prototype.pick=function(t,e,s){if(null!=t)if(this.catalog[t]&&this.catalog[t].is_full)this._pick(t,{success:!0,info:this.catalog[t]},e,s);else{var i=this;this.get_info_for_oid(t,!0,function(a){i._pick(t,a,e,s)})}else this.current_selection&&this.current_selection.oid&&$(".item-entry-"+this.current_selection.oid,this.$main).removeClass("selected")},MSBrowser.prototype._pick=function(t,e,s,i){e.success?this.pick_mode?(this.current_selection&&this.current_selection.oid&&$(".item-entry-"+this.current_selection.oid,this.$main).removeClass("selected"),this.current_selection=this.catalog[t],$(".item-entry-"+this.current_selection.oid,this.$main).addClass("selected"),this.overlay&&!i&&this.overlay.hide(),this.on_pick&&this.on_pick(this.catalog[t],i),!this.use_overlay&&e.info.parent_slug&&(window.location.hash="#"+e.info.parent_slug),!this.channels||i&&this.initial_state&&this.initial_state.channel_slug||(0!==t.indexOf("c")&&isNaN(parseInt(t,10))?this.channels.display_channel(e.info.parent_oid):this.channels.display_channel(t))):"delete"==s&&window.delete_form_manager&&window.delete_form_manager.show(t,this.catalog[t].title):console.log("Unable to get info about initial selection:"+e.error)},MSBrowser.prototype.remove=function(t){t&&this.catalog[t]&&(this.channels.remove(t),this.latest.remove(t),this.search.remove(t))},MSBrowser.prototype.get_last_pick=function(){return this.current_selection},MSBrowser.prototype.get_selected_oid=function(){return this.initialized?this.current_selection?this.current_selection.oid:null:this.initial_oid},MSBrowser.prototype.parse_url=function(){var t,e,s,i,a={},n=window.location.search?window.location.search.substring(1):null;if(n)for(t=n.split("&"),e=0;e<t.length;e++)-1!=t[e].indexOf("=")?(s=t[e].substring(0,t[e].indexOf("=")),i="on"==(i=t[e].substring(s.length+1))||"off"!=i&&window.decodeURIComponent(i.replace(/\+/g,"%20"))):(s=t[e],i=!0),"in_"==s.substring(0,3)?a.has_in_vals=!0:"for_"==s.substring(0,4)&&(a.has_for_vals=!0),a[s]=i;return a},MSBrowser.prototype.on_url_change=function(){var t,e=window.location.pathname+window.location.search;0===e.indexOf("/channels/")?((t=window.location.hash)&&"#"==t[0]&&(t=t.substring(1)),t?this.channels.display_channel_by_slug(t):"self"==this.filter_speaker?this.channels.display_personal_channel():this.channels.display_channel("0"),this.change_tab("channels",!0)):0===e.indexOf("/latest/")?this.change_tab("latest",!0):0===e.indexOf("/search/")&&(this.search.on_url_change(),this.change_tab("search",!0))},MSBrowser.prototype.on_resize=function(){var t,e;this.use_overlay&&(t=$(window).width()-70,this.$widget.width(t),e=$(window).height()-100,this.$widget.height(e))},MSBrowser.prototype.load_categories=function(){var t=this;this.msapi.ajax_call("list_categories",{},function(e){e.data&&(t.site_settings_categories=e.data,t.display_categories())})};