function MSBrowserChannels(e){this.browser=null,this.displayItunesRss=!1,this.currentChannelOid="0",this.$menu=null,this.$content=null,this.treeManager=null,this.order="default",this.lastResponse=null,jsu.setObjectAttributes(this,e,["browser","displayItunesRss","currentChannelOid"]),this.initOptions=e||{}}function MSBrowserLatest(e){this.browser=null,this.$menu=null,this.$content=null,this.$place=null,this.lastResponse=null,this.more=!1,this.startDate="",this.dateLabel="",this.$section=null,jsu.setObjectAttributes(this,e,["browser"]),this.initOptions=e||{}}function MSBrowserSearch(e){if(this.browser=null,this.$menu=null,this.$content=null,this.order="default",this.lastResponse=null,this.loadingSearch=!1,this.searchInFields=[{name:"in_title",label:jsu.translateHTML("titles"),initial:!0,items:null},{name:"in_description",label:jsu.translateHTML("descriptions"),initial:!1,items:null},{name:"in_keywords",label:jsu.translateHTML("keywords"),initial:!0,items:null},{name:"in_speaker",label:jsu.translateHTML("speakers"),initial:!0,items:"vlp"},{name:"in_license",label:jsu.translateHTML("licenses"),initial:!1,items:"vlp"},{name:"in_company",label:jsu.translateHTML("companies"),initial:!1,items:"vlp"},{name:"in_location",label:jsu.translateHTML("locations"),initial:!1,items:"vlp"},{name:"in_categories",label:jsu.translateHTML("categories"),initial:!1,items:"vlp"},{name:"in_annotations",label:jsu.translateHTML("comments, slides, ..."),initial:!1,items:"vlp"},{name:"in_photos",label:jsu.translateHTML("photos"),initial:!1,items:"p"},{name:"in_extref",label:jsu.translateHTML("external references"),initial:!0,items:null},{name:"in_extdata",label:jsu.translateHTML("external data"),initial:!1,items:null}],e.defaultSearchIn)for(let t=0;t<this.searchInFields.length;t++){const s=this.searchInFields[t].name.replace("in_","");-1!==e.defaultSearchIn.indexOf(s)?this.searchInFields[t].initial=!0:this.searchInFields[t].initial=!1}this.searchForFields=[{name:"for_channels",label:jsu.translateHTML("channels"),initial:!0,items:"c"},{name:"for_videos",label:jsu.translateHTML("videos"),initial:!0,items:"v"},{name:"for_lives",label:jsu.translateHTML("live streams"),initial:!0,items:"l"},{name:"for_photos",label:jsu.translateHTML("photos groups"),initial:!0,items:"p"}],jsu.setObjectAttributes(this,e,["browser"]),this.initOptions=e||{}}function MSBrowser(e){if(this.title="",this.place=null,this.selectableContent="cvlp",this.displayableContent="cvlp",this.filterEditable=null,this.filterValidated=null,this.filterSpeaker=null,this.filterCategories=[],this.filterNoCategories=!1,this.parentSelectionOid=null,this.initialOid=null,this.initialState=null,this.onPick=null,this.hideHeader=!1,this.btnClass="",this.msapi=null,this.treeManager=!0,this.displayTypesIcons=!1,this.displayItunesRss=!0,this.useOverlay=!0,this.pickMode=!0,this.iframeMode=!1,this.ltiMode=!1,this.linksUrlParams="",this.linksTarget="",this.$widget=null,this.$menu=null,this.$main=null,this.overlay=null,this.catalog={},this.displayAsThumbnails=!1,this.displayed="channels",this.currentSelection=null,this.siteSettingsCategories=[],this.catalogFieldsToDisplay=["duration","description","creation_date","views","annotations","storage","rss_links","channel_content","add_date","type","parent"],this.urlLogin="/login/",this.urlChannels="/channels/",this.urlLatest="/latest/",this.urlSearch="/search/",this.urlPostLink="/lti/post-link/",this.defaultSearchIn=[],this.moreChannels=[],this.moreLiveStreams=[],this.moreVideos=[],this.morePhotosGroups=[],this.displayCount=jsu.getCookie("catalog-displayCount")||30,jsu.setObjectAttributes(this,e,["title","place","msapi","selectableContent","displayableContent","filterEditable","filterValidated","filterSpeaker","parentSelectionOid","initialOid","initialState","onPick","hideHeader","btnClass","treeManager","displayTypesIcons","displayItunesRss","defaultSearchIn","catalogFieldsToDisplay"]),this.msapi||(this.msapi=new MSAPIClient(e)),this.initOptions=e||{},this.useOverlay=!this.place,!this.useOverlay){const e=this;$(document).ready(function(){e.init()})}}MSBrowserChannels.prototype.getMenuJq=function(){return this.$menu=$('<div id="ms_browser_channels_menu" style="display: none;"></div>'),this.$menu},MSBrowserChannels.prototype.getContentJq=function(){let e='<div id="ms_browser_channels" class="ms-browser-content" style="display: none;">';return this.browser.treeManager&&(e+='<div class="ms-browser-tree-place ms-channels-tree"><div><i class="fa fa-spinner fa-spin" aria-hidden="true"></i> '+jsu.translateHTML("Loading...")+"</div></div>"),e+='<div class="ms-browser-channels-body"><div class="ms-browser-channels-place"><div class="messages"><div class="message info">'+jsu.translateHTML("Select a channel to display its content.")+"</div></div></div>"+this.browser.getMoreButton()+"</div></div>",this.$content=$(e),this.$place=$(".ms-browser-channels-place",this.$content),this.$content},MSBrowserChannels.prototype.buildBreadcrumb=function(e){let t="<ol>";if(t+='<li><a href="/">'+jsu.translateHTML("Home")+"</a></li>",t+='<li><a href="#" class="tree">'+jsu.translateHTML("Channels")+"</a></li>",e){for(const s of e.path)t+='<li><a class="tree" href="#'+jsu.escapeAttribute(s.slug?s.slug:"")+'"'+(s.language?'lang="'+jsu.escapeAttribute(s.language)+'"':"")+">"+jsu.escapeHTML(s.title)+"</a></li>";t+='<li><a aria-current="page" class="tree" href="#'+jsu.escapeAttribute(e.slug?e.slug:"")+'"'+(e.language?'lang="'+jsu.escapeAttribute(e.language)+'"':"")+">"+jsu.escapeHTML(e.title)+"</a></li>"}return t+="</ol>"},MSBrowserChannels.prototype.refreshTitleAndBreadcrumb=function(){if("channels"!=this.browser.getActiveTab())return;const e=this.lastResponse?this.lastResponse.info:void 0;if(e&&"0"!=e.oid){let t='<span class="item-entry-preview"><img src="'+jsu.escapeAttribute(e.thumb)+'" alt="'+jsu.escapeHTML(e.title)+'"/></span>';if(t+='<span class="channel-titles-place">',t+='<span class="channel-title"'+(e.language?'lang="'+jsu.escapeAttribute(e.language)+'"':"")+">"+jsu.escapeHTML(e.title)+"</span>",!(this.browser.useOverlay||this.browser.hideHeader&&this.browser.initialState&&this.browser.initialState.channelSlug&&this.browser.initialState.channelSlug==e.slug)){const t=document.getElementById("breadcrumb");t&&(t.innerHTML=this.buildBreadcrumb(e))}t+="</span>",this.browser.currentSelection&&this.browser.currentSelection.oid==e.oid&&(t='<span class="selected">'+t+"</span>"),this.browser.setTitle(e.title,t)}else if(this.browser.ltiMode)this.browser.setTitle(jsu.translateHTML("My channel"));else{this.browser.setTitle(jsu.translateHTML("Main channels"));const t=document.getElementById("breadcrumb");t&&(t.innerHTML=this.buildBreadcrumb(e))}},MSBrowserChannels.prototype.onShow=function(){if(this.refreshTitleAndBreadcrumb(),this.initialized)return;this.initialized=!0,this.defaultLogoSrc=$("#mainlogo .header-logo").attr("src"),this.defaultFavSrc=$("#favicon_link").attr("src");const e=this;if(this.browser.treeManager){const t={$place:$(".ms-browser-tree-place",this.$content),msapi:this.browser.msapi,displayRoot:-1!=this.browser.displayableContent.indexOf("c"),displayPersonal:!0,currentChannelOid:this.currentChannelOid,onDataRetrieved:function(t){e.browser.updateCatalog(t)}};this.browser.useOverlay&&(t.onChange=function(t){e.displayChannel(t)}),this.treeManager=new MSTreeManager(t)}this.initOptions.initialState&&this.initOptions.initialState.channelSlug?this.displayChannelBySlug(this.initOptions.initialState.channelSlug):"self"==this.browser.filterSpeaker?this.displayPersonalChannel():this.displayChannel(this.currentChannelOid)},MSBrowserChannels.prototype.setOrder=function(e){this.order=e||"default",this.refreshDisplay(!0)},MSBrowserChannels.prototype.displayPersonalChannel=function(){const e=this;this.personalChannelOid?e.displayChannel(this.personalChannelOid):this.browser.msapi.ajaxCall("getChannelsPersonal",{},function(t){t.success?(e.personalChannelOid=t.oid,e.displayChannel(t.oid)):403==t.errorCode?e._onChannelError({error:jsu.translate("You are not allowed to have a personal channel.")}):e._onChannelError(t)})},MSBrowserChannels.prototype.displayChannelBySlug=function(e){const t=this;this.browser.getInfoForSlug(e,!1,!0,function(e){e.success?t.displayChannel(e.info.oid):t._onChannelError(e)})},MSBrowserChannels.prototype.displayChannel=function(e){if(this.currentChannelOid=e,this.browser.boxHideInfo(),this.initialized)if(this.browser.displayLoading(),this.treeManager&&this.treeManager.setActive(e),"0"!=e){const t=this;this.browser.getInfoForOid(e,!0,function(s){t._onChannelInfo(s,e)})}else this._onChannelInfo(null,e)},MSBrowserChannels.prototype.displayParent=function(){if(!this.currentChannelOid)return;const e=this.currentChannelOid,t=this.browser.catalog[e]&&this.browser.catalog[e].parent_oid?this.browser.catalog[e].parent_oid:"0";this.displayChannel(t)},MSBrowserChannels.prototype._onChannelError=function(e){this.lastResponse=null;let t='<div class="messages">';if(this.browser.useOverlay||"403"!=e.errorCode&&"401"!=e.errorCode)t+='<div class="message error">'+jsu.escapeHTML(e.error)+"</div>";else{const s=this.browser.urlLogin+"?next="+window.location.pathname+(window.location.hash?window.location.hash.substring(1):"");t+='<div class="item-description"><div class="message error">'+jsu.escapeHTML(e.error)+'</div><div style="margin: 0.3em;">'+jsu.translateHTML("Please login to access this channel")+'</div><div><a class="button default" href="'+s+'">'+jsu.translateHTML("Sign in")+"</a></div></div>"}t+="</div>",this.$place.html(t),this.browser.hideMoreBtns("channels")},MSBrowserChannels.prototype._onChannelInfo=function(e,t){if(this.currentChannelOid!=t)return void this.browser.hideLoading();if(e&&!e.success)return this._onChannelError(e);const s={};t&&"0"!=t&&(s.parent_oid=t),this.browser.parentSelectionOid&&(s.parent_selection_oid=this.browser.parentSelectionOid),this.browser.displayableContent&&(s.content=this.browser.displayableContent),null!==this.browser.filterEditable&&(s.editable=this.browser.filterEditable?"yes":"no"),null!==this.browser.filterValidated&&(s.validated=this.browser.filterValidated?"yes":"no"),this.browser.ltiMode||null===this.browser.filterSpeaker||(s.speaker=this.browser.filterSpeaker),this.browser.filterNoCategories?s.no_categories=!0:this.browser.filterCategories.length>0&&(s.categories=this.browser.filterCategories.join("\n")),s.order_by=this.order;const i=this;this.browser.msapi.ajaxCall("getChannelsContent",s,function(s){e&&(e.info&&(s.info=e.info),e.parent_selectable&&(s.parent_selectable=e.parent_selectable),e.selectable&&(s.selectable=e.selectable)),i._onChannelContent(s,t)})},MSBrowserChannels.prototype._onChannelContent=function(e,t){if(this.browser.hideLoading(),this.browser.moreChannels=[],this.browser.moreLiveStreams=[],this.browser.moreVideos=[],this.browser.morePhotosGroups=[],this.browser.hideMoreBtns("channels"),this.currentChannelOid!=t)return;if(!e.success)return this._onChannelError(e);let s;if(this.lastResponse=e,!this.browser.useOverlay&&this.browser.displayAsThumbnails&&this.browser.boxHideInfo(),this.$menu.html(""),"0"!=t){if(!this.browser.ltiMode||t!=this.personalChannelOid){const t={oid:e.info.parent_oid?e.info.parent_oid:"0",title:e.info.parent_title?e.info.parent_title:jsu.translate("Parent channel"),slug:e.info.parent_slug};let s;if(e.info.parent_oid&&e.info.parent_slug&&this.browser.updateCatalog(t),this.browser.useOverlay?(s=$('<button type="button" class="button '+this.browser.btnClass+' back-button"></button>')).click({obj:this,oid:t.oid},function(e){e.data.obj.displayChannel(e.data.oid)}):s=$('<a class="button '+this.browser.btnClass+' back-button" href="'+this.browser.getButtonLink(t,"view")+'"></a>'),!this.browser.useOverlay&&$(".navbar .back.button-text").length>0?(s.html('<i class="fa fa-chevron-circle-up fa-fw fa-2x" aria-hidden="true"></i>'),s.attr("title",jsu.translate("Parent channel")),s.attr("aria-label",jsu.translate("Parent channel")),s.addClass("back").addClass("button-text"),$(".navbar .back.button-text").replaceWith(s)):(s.html('<i class="fa fa-chevron-circle-up" aria-hidden="true"></i> <span class="hidden-below-800">'+jsu.translateHTML("Parent channel")+"</span>"),this.$menu.append(s)),this.browser.pickMode){const t=this.browser.msapi.getAvailableStorageDisplay(e.info);t&&(this.$menu.append(t+" "),window.uwlb||$(".tooltip-button",this.$menu).click(function(){$("span",this).toggle()}))}}const i=-1!=this.browser.selectableContent.indexOf("c")&&(!this.browser.parentSelectionOid||e.selectable);s=this.browser.getEntryLinks(e.info,"current",i)}else e.oid="0",s=this.browser.getEntryLinks(e,"current",!1),!this.browser.useOverlay&&$(".navbar .back.button-text").length>0&&$(".navbar .back.button-text").attr("href","..");if(s&&this.$menu.append(s),this.$place.html(""),this.browser.useOverlay)this.$place.scrollTop(0);else{if("0"!=t){const t=$('<div class="item-description"></div>');let s=!0,i=e.info.can_edit?this.browser.msapi.getStorageDisplay(e.info):"";if(e.info.views||e.info.comments){let a='<div class="'+(e.info.short_description||this.browser.couldDisplay("rss_links")||i?"right":"align-right")+' channel-description-stats">';this.browser.couldDisplay("views")&&e.info.views&&(a+='<span class="inline-block">'+e.info.views+" "+jsu.translate("views"),e.info.views_last_month&&(a+=", "+e.info.views_last_month+" "+jsu.translate("this month")),a+="</span>"),this.browser.couldDisplay("annotations")&&e.info.comments&&(a+=' <span class="inline-block">'+e.info.comments+" "+jsu.translate("annotations"),e.info.comments_last_month&&(a+=", "+e.info.comments_last_month+" "+jsu.translate("this month")),a+="</span>"),a+="</div>",t.append(a),s=!1}if(this.browser.couldDisplay("description")&&e.info.short_description){const i=$('<div class="channel-description-text">'+e.info.short_description+"</div>");e.info.short_description!=e.info.description&&(i.addClass("short-desc"),i.click({description:e.info.description},function(e){$(this).html(e.data.description).unbind("click").removeClass("short-desc")})),t.append(i),s=!1}if(this.browser.couldDisplay("channel_content")&&e.info.items_count){const i=[];e.info.channels_count&&i.push(e.info.channels_count+" "+jsu.translate("channel(s)")),e.info.videos_count&&i.push(e.info.videos_count+" "+jsu.translate("video(s)")),e.info.lives_count&&i.push(e.info.lives_count+" "+jsu.translate("live stream(s)")),e.info.pgroups_count&&i.push(e.info.pgroups_count+" "+jsu.translate("photos group(s)"));let a='<div class="channel-items-count">'+jsu.translate("Channel content:");a+=" <span>"+jsu.escapeHTML(i.join(", "))+"</span>",a+=' <button type="button" class="tooltip-button no-padding no-border no-background" aria-describedby="id_count_help" aria-label="'+jsu.translateAttribute("help")+'"><i class="fa fa-question-circle fa-fw" aria-hidden="true"></i><span role="tooltip" id="id_count_help" class="tooltip-hidden-content">'+jsu.translateHTML("Sub channels items are included in counts.")+"</span></button>",a+="</div>",t.append(a),window.uwlb||$(".channel-items-count .tooltip-button",t).click(function(){$("span",this).toggle()}),s=!1}if(this.browser.couldDisplay("storage")&&i&&(i='<div class="channel-storage-usage">'+jsu.translate("Storage usage:")+" "+i+"</div>",t.append(i),window.uwlb||$(".channel-storage-usage .tooltip-button",t).click(function(){$("span",this).toggle()}),s=!1),this.browser.couldDisplay("rss_links")){let i='<div class="channel-description-rss"> ';this.displayItunesRss?(i+=' <span class="inline-block">'+jsu.translate("Subscribe to channel videos RSS:")+"</span>",i+=' <a class="nowrap" href="/channels/'+e.info.oid+'/rss.xml">',i+='<i class="fa fa-rss" aria-hidden="true"></i> '+jsu.translate("standard")+"</a>",i+=' <a class="nowrap" href="/channels/'+e.info.oid+'/itunes-video.xml">',i+='<i class="fa fa-apple" aria-hidden="true"></i> '+jsu.translate("iTunes")+"</a>",i+=' <a class="nowrap" href="/channels/'+e.info.oid+'/itunes-audio.xml">',i+='<i class="fa fa-apple" aria-hidden="true"></i> '+jsu.translate("iTunes (audio only)")+"</a>"):(i+=' <a class="nowrap" href="/channels/'+e.info.oid+'/rss.xml">',i+='<i class="fa fa-rss" aria-hidden="true"></i> '+jsu.translate("Subscribe to channel videos RSS")+"</a>"),i+="</div>",t.append(i),s=!1}s||this.$place.append(t)}if($("head .csslistlink").remove(),e.info){let t,s="";for(t in e.info.css_list)s+='<link class="csslistlink" rel="stylesheet" type="text/css" href="'+e.info.css_list[t]+'"/>';$("head").append(s)}e.info&&e.info.logo_url?$("#mainlogo .header-logo").attr("src",e.info.logo_url):$("#mainlogo .header-logo").attr("src",this.defaultLogoSrc),e.info&&e.info.favicon_url?$("#faviconLink").attr("href",e.info.favicon_url):$("#faviconLink").attr("href",this.defaultFavSrc)}const i=e.channels?e.channels.length:0,a=e.videos?e.videos.length:0,n=e.live_streams?e.live_streams.length:0,o=e.photos_groups?e.photos_groups.length:0,r=i>0||a>0||n>0||o>0;if(this.refreshTitleAndBreadcrumb(),r)this.browser.displayContent(this.$place,e,t,"channels");else{let e;e=-1==this.browser.selectableContent.indexOf("c")?jsu.translate("This channel contains no media."):this.browser.displayableContent.length>1?jsu.translate("This channel contains no sub channels and no media."):jsu.translate("This channel contains no sub channels."),e+="<br/>"+jsu.translate("Some contents may still exist in this channel but if it is the case your account is not allowed to see them."),this.$place.append('<div class="messages"><div class="message info">'+e+"</div></div>")}},MSBrowserChannels.prototype.refreshDisplay=function(e){e&&this.lastResponse&&(this.lastResponse=null),this.lastResponse?this._onChannelContent(this.lastResponse,this.currentChannelOid):this.browser.ltiMode?this.displayPersonalChannel():this.displayChannel(this.currentChannelOid)},MSBrowserChannels.prototype.remove=function(e){if(this.currentChannelOid==e){const t=this.browser.catalog[e]&&this.browser.catalog[e].parent_oid?this.browser.catalog[e].parent_oid:"0";!this.browser.pickMode&&this.browser.catalog[t]&&this.browser.catalog[t].slug?window.location.hash="#"+this.browser.catalog[t].slug:this.displayChannel(t)}else this.browser.removeOidFromTab(this,e)},MSBrowser.prototype.buildWidget=function(){let e,t,s;this.lastOverlayFocus=document.activeElement,this.previousFocus=null,"self"==this.filterSpeaker?(e=jsu.translate("My channel"),s=jsu.translate("My media"),t=jsu.translate("Search in my media")):(e=jsu.translate("Channels"),s=jsu.translate("Latest content"),t=jsu.translate("Search"));let i,a,n='<div class="ms-browser ms-browser-container'+(this.useOverlay?" in-overlay":"")+(this.treeManager?" has-tree":"")+(this.displayTypesIcons?" show-types-icons":"")+(this.hideHeader?" no-header":"")+'"><div class="ms-browser-header"><div class="ms-browser-menu">';this.useOverlay?n+='<button type="button" id="ms_browser_channels_tab" class="ms-browser-tab button '+this.btnClass+'" title="'+jsu.escapeAttribute(e)+'" aria-label="'+jsu.escapeAttribute(e)+'"><i class="fa fa-folder-open" aria-hidden="true"></i> <span class="hidden-below-800" aria-hidden="true">'+jsu.escapeHTML(e)+'</span></button><button type="button" id="ms_browser_latest_tab" class="ms-browser-tab button '+this.btnClass+'" title="'+jsu.escapeAttribute(s)+'" aria-label="'+jsu.escapeAttribute(s)+'"><i class="fa fa-clock-o" aria-hidden="true"></i> <span class="hidden-below-800" aria-hidden="true">'+jsu.escapeHTML(s)+'</span></button><button type="button" id="ms_browser_search_tab" class="ms-browser-tab button '+this.btnClass+'" title="'+jsu.escapeAttribute(t)+'" aria-label="'+jsu.escapeAttribute(t)+'"><i class="fa fa-search" aria-hidden="true"></i> <span class="hidden-below-800" aria-hidden="true">'+jsu.escapeHTML(t)+"</span></button>":n+='<a id="ms_browser_channels_tab" class="ms-browser-tab button '+this.btnClass+'" href="'+this.urlChannels+'" title="'+jsu.escapeAttribute(e)+'" aria-label="'+jsu.escapeAttribute(e)+'"><i class="fa fa-folder-open" aria-hidden="true"></i> <span class="hidden-below-800" aria-hidden="true">'+jsu.escapeHTML(e)+'</span></a><a id="ms_browser_latest_tab" class="ms-browser-tab button '+this.btnClass+'" href="'+this.urlLatest+'" title="'+jsu.escapeAttribute(s)+'" aria-label="'+jsu.escapeAttribute(s)+'"><i class="fa fa-clock-o" aria-hidden="true"></i> <span class="hidden-below-800" aria-hidden="true">'+jsu.escapeHTML(s)+'</span></a><a id="ms_browser_search_tab" class="ms-browser-tab button '+this.btnClass+'" href="'+this.urlSearch+'" title="'+jsu.escapeAttribute(t)+'" aria-label="'+jsu.escapeAttribute(t)+'"><i class="fa fa-search" aria-hidden="true"></i> <span class="hidden-below-800" aria-hidden="true">'+jsu.escapeHTML(t)+"</span></a>",n+='</div><h2 class="ms-browser-title"></h2></div><div class="ms-browser-bar"></div><div class="ms-browser-main ms-items"><div class="ms-browser-clear"></div><div class="ms-browser-loading"><div><i class="fa fa-spinner fa-spin" aria-hidden="true"></i> '+jsu.translateHTML("Loading...")+'</div></div><div class="ms-browser-message"><div></div></div></div></div>',this.$widget=$(n),!this.useOverlay&&$("nav .buttons-left").length>0?((a=$("nav .buttons-left")).addClass("ms-browser"),this.hideHeader&&a.addClass("no-header"),a.append(this.getTopMenuJq()),(i=$("#commands_place")).addClass("ms-browser"),this.hideHeader&&i.addClass("no-header"),i.addClass("ms-browser-dropdown-right")):((a=$(".ms-browser-header",this.$widget)).addClass("ms-browser-dropdown-right"),a.prepend(this.getTopMenuJq()),(i=$(".ms-browser-bar",this.$widget)).addClass("ms-browser-dropdown-right")),i.append(this.latest.getMenuJq()),i.append(this.channels.getMenuJq()),i.append(this.search.getMenuJq()),this.$main=$(".ms-browser-main",this.$widget),this.$main.append(this.latest.getContentJq()),this.$main.append(this.channels.getContentJq()),this.$main.append(this.search.getContentJq()),this.$main.append('<div class="ms-browser-clear"></div>'),this.$menu=$(".ms-browser-menu",this.$widget),this.place&&$(this.place).html(this.$widget),$("#ms_browser_channels_tab",this.$menu).click({obj:this},function(e){return e.data.obj.changeTab("channels"),!1}),$("#ms_browser_latest_tab",this.$menu).click({obj:this},function(e){return e.data.obj.changeTab("latest"),!1}),$("#ms_browser_search_tab",this.$menu).click({obj:this},function(e){return e.data.obj.changeTab("search"),!1}),$(".ms-browser-more-btn button",this.$widget).click({obj:this},function(e){e.data.obj.displayMore(e.data.obj.displayCount)})},MSBrowser.prototype.getTopMenuJq=function(){const e=[{default:jsu.translate("Use default sorting")},{"creation_date-desc":jsu.translate("Creation date, descending")},{"creation_date-asc":jsu.translate("Creation date, ascending")},{"add_date-desc":jsu.translate("Add date, descending")},{"add_date-asc":jsu.translate("Add date, ascending")},{"title-desc":jsu.translate("Title, descending")},{"title-asc":jsu.translate("Title, ascending")},{"slug-desc":jsu.translate("Slug, descending")},{"slug-asc":jsu.translate("Slug, ascending")},{"views-desc":jsu.translate("Number of views, descending")},{"views-asc":jsu.translate("Number of views, ascending")}];let t,s='<div class="ms-browser-top-buttons"><div class="ms-browser-dropdown" id="ms_browser_display_dropdown"><button aria-controls="ms_browser_display_dropdow_menu" aria-expanded="false" type="button" title="'+jsu.translateAttribute("Display")+'" class="button ms-browser-dropdown-button '+this.btnClass+'"><i class="fa fa-tv" aria-hidden="true"></i> <span class="hidden-below-1280">'+jsu.translateHTML("Display")+' </span><i class="fa fa-angle-down" aria-hidden="true"></i></button><div class="ms-browser-dropdown-menu" id="ms_browser_display_dropdow_menu"><div><h4>'+jsu.translateHTML("Display mode:")+'</h4><button type="button" class="button '+(this.displayAsThumbnails?"":"active")+'" id="ms_browser_display_as_list" title="'+jsu.translateAttribute("list")+(this.displayAsThumbnails?"":" ("+jsu.translateAttribute("selected setting")+")")+'">'+jsu.translateHTML("list")+'</button><button type="button" class="button '+(this.displayAsThumbnails?"active":"")+'" id="ms_browser_display_as_thumbnails" title="'+jsu.translateAttribute("thumbnails")+(this.displayAsThumbnails?" ("+jsu.translateAttribute("selected setting")+")":"")+'">'+jsu.translateHTML("thumbnails")+'</button><br/><label for="ms_browser_number_item">'+jsu.translateHTML("Number of items:")+'</label><select id="ms_browser_number_item">';for(const e of[10,30,100])s+='<option value="'+e+'"'+(e==this.displayCount?' selected="selected"':"")+">"+e+"</option>";for(t in s+='</select><br/><input id="ms_browser_display_types_icons" type="checkbox" '+(this.displayTypesIcons?'checked="checked"':"")+'> <label for="ms_browser_display_types_icons">'+jsu.translateHTML("display items type icons")+'</label></div><div class="ms-browser-channel-order"><h4><label for="ms_browser_order_channel">'+jsu.translate("Sort by:")+'</label></h4> <select id="ms_browser_order_channel">',e)for(const i in e[t])s+='<option value="'+i+'">'+jsu.escapeHTML(e[t][i])+"</option>";s+="</select></div>";const i='<option value="">'+jsu.translateHTML("unspecified")+'</option><option value="yes">'+jsu.translateHTML("yes")+'</option><option value="no">'+jsu.translateHTML("no")+"</option>";s+='<div class="ms-browser-filters"><h4>'+jsu.translateHTML("Filters:")+'</h4> <form id="ms_browser_filters_form"> <label for="ms_browser_filter_editable">'+jsu.translateHTML("Editable:")+'</label> <select id="ms_browser_filter_editable">'+i+"</select>",(this.displayableContent.length>1||"c"!=this.displayableContent)&&(s+=' <br/> <label for="ms_browser_filter_validated">'+jsu.translateHTML("Published:")+'</label> <select id="ms_browser_filter_validated">'+i+"</select>","self"!=this.filterSpeaker&&(s+=' <br/> <label for="ms_browser_filter_speaker">'+jsu.translateHTML("Speaker:")+'</label> <input type="text" id="ms_browser_filter_speaker" value="'+(this.filterSpeaker?this.filterSpeaker:"")+'"/> <button type="submit" class="button">'+jsu.translateHTML("Ok")+"</button>")),s+=" </form></div></div></div>",s+="</div>",this.$topMenu=$(s);const a=$("#ms_browser_display_dropdown",this.$topMenu);this.setupDropdown(a),$("#ms_browser_display_as_list",a).click({obj:this,$dropdown:a},function(e){e.data.obj.setDisplayAsList()}),$("#ms_browser_display_as_thumbnails",a).click({obj:this,$dropdown:a},function(e){e.data.obj.setDisplayAsThumbnails()}),$("#ms_browser_display_types_icons",a).change({obj:this,$dropdown:a},function(e){e.data.obj.setDisplayTypesIcons(this.checked)}),$("#ms_browser_order_channel",a).change({obj:this,$dropdown:a},function(e){e.data.obj.channels.setOrder($(this).val()),e.data.obj.search.setOrder($(this).val())}),$("#ms_browser_filters_form select",a).change({obj:this,$dropdown:a},function(e){$("#ms_browser_filters_form",e.data.$dropdown).submit()}),$("#ms_browser_filters_form",a).submit({obj:this,$dropdown:a},function(e){return e.data.obj.onFiltersSubmit($(this)),!1}),$("#ms_browser_number_item",a).change({obj:this},function(e){const t=parseInt(this.value,10);t>e.data.obj.displayCount&&e.data.obj.displayMore(t-e.data.obj.displayCount),e.data.obj.displayCount=t,$(".ms-browser-more-btn button").text(e.data.obj.moreLabel.replace(/\{count\}/,e.data.obj.displayCount)),jsu.setCookie("catalog-displayCount",t)});try{this.focusWasInDropdown=!1,window.addEventListener("blur",function(){this.checkFocusDropdown()}.bind(this),!0),window.addEventListener("focus",function(){this.checkFocusDropdown()}.bind(this),!0)}catch(e){console.error("Failed to listen to focus changes: "+e)}return this.$topMenu},MSBrowser.prototype.getMoreButton=function(){return this.moreLabel||(this.moreLabel=jsu.translate("Display {count} more items")),'<div class="ms-browser-more-btn"><button type="button" class="button">'+this.moreLabel.replace(/\{count\}/,this.displayCount)+"</button></div>"},MSBrowser.prototype.setTitle=function(e,t){if(t||(t=e),!this.useOverlay&&$("#global .main-title h1").length>0?($("#global .main-title h1").html(t),$("#global .main-title h1").attr("tabindex","-1"),$("#global .main-title h1").focus()):$(".ms-browser-title",this.$widget).html(t),!this.useOverlay&&document.title){if(!this.documentTilteSuffix){const e=document.title.indexOf(" - ");this.documentTilteSuffix=-1!=e?document.title.substring(e):" - Nudgis"}document.title=e+this.documentTilteSuffix}},MSBrowser.prototype.setupDropdown=function(e){$(".ms-browser-dropdown-button",e).click({$dropdown:e},function(e){const t=$(".ms-browser-dropdown-button",e.data.$dropdown),s=$(".ms-browser-dropdown-menu",e.data.$dropdown);s.attr("tabindex","-1"),t.hasClass("active")?(t.removeClass("active"),t.attr("aria-expanded",!1),s.removeClass("active")):(t.addClass("active"),t.attr("aria-expanded",!0),s.addClass("active"))}),$(document).click({$dropdown:e},function(e){const t=$(".ms-browser-dropdown-button",e.data.$dropdown),s=$(".ms-browser-dropdown-menu",e.data.$dropdown);!t.hasClass("active")||s.is(e.target)||0!==s.has(e.target).length||t.is(e.target)||0!==t.has(e.target).length||(t.removeClass("active"),t.attr("aria-expanded",!1),s.removeClass("active"))})},MSBrowser.prototype.closeDropdown=function(e){const t=$(".ms-browser-dropdown-button",e),s=$(".ms-browser-dropdown-menu",e);t.hasClass("active")&&(t.removeClass("active"),t.attr("aria-expanded",!1),s.removeClass("active"))},MSBrowser.prototype.checkFocusDropdown=function(){if(!document.activeElement||document.activeElement==document.body)return;let e=!1,t=document.activeElement;for(;t;){if(t.className&&-1!=t.className.indexOf("ms-browser-dropdown-menu")){e=!0,this.focusWasInDropdown=!0;break}t=t.parentNode}!e&&this.focusWasInDropdown&&(this.focusWasInDropdown=!1,$(".ms-browser-dropdown-button.active").removeClass("active").attr("aria-expanded",!1),$(".ms-browser-dropdown-menu.active").removeClass("active"))},MSBrowser.prototype.onFiltersSubmit=function(e){const t=[{type:"choice",id:"ms_browser_filter_editable",name:"filterEditable"},{type:"choice",id:"ms_browser_filter_validated",name:"filterValidated"}];"self"!=this.filterSpeaker&&t.push({type:"text",id:"ms_browser_filter_speaker",name:"filterSpeaker"});let s=!1;for(let i=0;i<t.length;i++){const a=$("#"+t[i].id,e);if(a.length>0){let e=a.val();if("choice"==t[i].type)switch(e){case"yes":e=!0;break;case"no":e=!1;break;default:e=null}else e||(e=null);this[t[i].name]!==e&&(this[t[i].name]=e,s=!0)}}if(s)if(this.useOverlay)this.channels.refreshDisplay(!0),this.latest.refreshDisplay(!0),this.search.refreshDisplay(!0);else{switch(this.getActiveTab()){case"channels":this.channels.refreshDisplay(!0);break;case"latest":this.latest.refreshDisplay(!0);break;case"search":this.search.refreshDisplay(!0)}}},MSBrowser.prototype.setDisplayAsList=function(){const e=$("#ms_browser_display_as_thumbnails",this.$topMenu),t=$("#ms_browser_display_as_list",this.$topMenu);t.hasClass("active")||(this.displayAsThumbnails=!1,e.removeClass("active").attr("title",e.text()),t.addClass("active").attr("title",t.text()+" ("+jsu.translate("selected setting")+")"),this.useOverlay||$("#global").addClass("max-width-1200"),jsu.setCookie("catalog-displayMode","list"),this.channels.refreshDisplay(),this.latest.refreshDisplay(),this.search.refreshDisplay())},MSBrowser.prototype.setDisplayAsThumbnails=function(){const e=$("#ms_browser_display_as_thumbnails",this.$topMenu),t=$("#ms_browser_display_as_list",this.$topMenu);e.hasClass("active")||(this.displayAsThumbnails=!0,t.removeClass("active").attr("title",t.text()),e.addClass("active").attr("title",e.text()+" ("+jsu.translate("selected setting")+")"),this.useOverlay||$("#global").removeClass("max-width-1200"),jsu.setCookie("catalog-displayMode","thumbnail"),this.channels.refreshDisplay(),this.latest.refreshDisplay(),this.search.refreshDisplay())},MSBrowser.prototype.setDisplayTypesIcons=function(e){this.displayTypesIcons=e,e?this.$widget.addClass("show-types-icons"):this.$widget.removeClass("show-types-icons"),jsu.setCookie("catalog-displayTypesIcons",e?"yes":"no")},MSBrowser.prototype.getActiveTab=function(){const e=$(".ms-browser-tab.active",this.$menu);let t=e.length>0?e.attr("id").replace(/_tab/g,"").replace(/ms_browser_/g,""):null;return t||this.pickMode||($(".ms-browser").hasClass("channels")?t="channels":$(".ms-browser").hasClass("latest")?t="latest":$(".ms-browser").hasClass("search")&&(t="search")),t},MSBrowser.prototype.changeTab=function(e,t){const s=this.getActiveTab();if(s!=e&&(s&&this[s]&&($(".ms-browser").removeClass(s),$("#ms_browser_"+s+"_tab",this.$menu).removeClass("active").attr("title",$("#ms_browser_"+s+"_tab",this.$menu).text()),this[s].$menu.css("display","none"),this[s].$content.css("display","none")),$(".ms-browser").addClass(e),$("#ms_browser_"+e+"_tab",this.$menu).addClass("active").attr("title",$("#ms_browser_"+e+"_tab",this.$menu).text()+" ("+jsu.translate("selected tab")+")"),this[e]&&(this[e].$menu.css("display",""),this[e].$content.css("display",""),this[e].onShow()),"latest"!=e?$(".ms-browser-channel-order",this.$topMenu).css("display",""):$(".ms-browser-channel-order",this.$topMenu).css("display","none"),!this.useOverlay&&!t)){let t;t="search"==e?this.urlSearch:"latest"==e?this.urlLatest:this.urlChannels+window.location.hash,window.history.pushState({ms_tab:e},e,t)}},MSBrowser.prototype.displayLoading=function(){if(isNaN(this.loadingCount)?this.loadingCount=1:this.loadingCount++,this.loadingTimeout)return;const e=this;this.loadingTimeout=setTimeout(function(){$(".ms-browser-loading",e.$widget).css("display","block"),e.loadingTimeout=null},500)},MSBrowser.prototype.hideLoading=function(){this.loadingCount&&this.loadingCount--,isNaN(this.loadingCount)||this.loadingCount>0||(this.loadingTimeout&&(clearTimeout(this.loadingTimeout),this.loadingTimeout=null),$(".ms-browser-loading",this.$widget).css("display",""))},MSBrowser.prototype.displayContent=function(e,t,s,i,a){if(a||(a=this.displayCount),t.channels&&t.channels.length>0){let n=[];a>0?(n=t.channels.slice(0,a),this.moreChannels=t.channels.slice(a),a-=n.length):this.moreChannels=t.channels,n.length>0&&this.displayItems(e,n,"channel",i,s)}if(t.live_streams&&t.live_streams.length>0){let s=[];a>0?(s=t.live_streams.slice(0,a),this.moreLiveStreams=t.live_streams.slice(a),a-=s.length):this.moreLiveStreams=t.live_streams,s.length>0&&this.displayItems(e,s,"live",i)}if(t.videos&&t.videos.length>0){let s=[];a>0?(s=t.videos.slice(0,a),this.moreVideos=t.videos.slice(a),a-=s.length):this.moreVideos=t.videos,s.length>0&&this.displayItems(e,s,"video",i)}if(t.photos_groups&&t.photos_groups.length>0){let s=[];a>0?(s=t.photos_groups.slice(0,a),this.morePhotosGroups=t.photos_groups.slice(a),a-=s.length):this.morePhotosGroups=t.photos_groups,s.length>0&&this.displayItems(e,s,"photos",i)}this.moreChannels.length+this.moreLiveStreams.length+this.moreVideos.length+this.morePhotosGroups.length>0?this.showMoreBtns(i):this.hideMoreBtns(i)},MSBrowser.prototype.displayItems=function(e,t,s,i,a){const n=this.pickMode?"h3":"h2",o=-1!=this.selectableContent.indexOf(s[0]);let r="";switch(s){case"channel":r=jsu.translate("Channels"),a&&"0"!=a&&(r=jsu.translate("Sub channels"));break;case"live":r=jsu.translate("Live streams");break;case"video":r=jsu.translate("Videos");break;case"photos":r=jsu.translate("Photos groups")}$("#header_type_"+s,e).length||e.append("<"+n+' id="header_type_'+s+'">'+r+"</"+n+">");let l=$("#section_type_"+s,e);l.length||(l=$('<ul id="section_type_'+s+'" class="ms-browser-section"></ul>'));for(let e=0;e<t.length;e++)"channels"==s&&void 0===t[e].parent_oid&&a&&(t[e].parent_oid=a),l.append(this.getContentEntry(s,t[e],o,i));e.append(l)},MSBrowser.prototype.showMoreBtns=function(e){$("#ms_browser_"+e+" .ms-browser-more-btn",this.place).css("display","block")},MSBrowser.prototype.hideMoreBtns=function(e){$("#ms_browser_"+e+" .ms-browser-more-btn",this.place).css("display","none")},MSBrowser.prototype.displayMore=function(e){const t=this.getActiveTab(),s={channels:this.moreChannels,live_streams:this.moreLiveStreams,videos:this.moreVideos,photos_groups:this.morePhotosGroups};"latest"===t?this.latest.displayMore(e):"channels"===t?this.displayContent(this.channels.$place,s,null,"channels",e):"search"===t&&this.displayContent(this.search.$place,s,null,"search",e)},MSBrowser.prototype.getContentEntry=function(e,t,s,i){this.updateCatalog(t);const a=t.oid,n=s&&(!this.parentSelectionOid||t.selectable),o=this.pickMode&&(n||"channel"==e);let r=null;(r=$('<li class="item-entry item-type-'+e+" item-entry-"+a+'"></li>')).attr("id","item_entry_"+a+"_"+i),r.addClass(this.displayAsThumbnails?"thumbnail":"list"),this.currentSelection&&this.currentSelection.oid==a&&(r.addClass("selected"),r.attr("title",t.title+" "+jsu.translate("selected"))),n&&r.addClass("selectable"),o&&r.addClass("clickable"),t.extra_class&&r.addClass(t.extra_class);let l=this._getEntryBlockHtml(t,e,o,i);this.displayAsThumbnails&&!this.pickMode&&(l+='<div class="item-entry-buttons">',l+='<button type="button" class="item-entry-info" title="'+jsu.translateAttribute("Open information panel")+'"><i class="fa fa-info" aria-hidden="true"></i></button>',t.can_edit&&(l+='<a title="'+jsu.translateAttribute("Edit")+'" href="'+this.getButtonLink(t,"edit")+'"'+this.linksTarget+'><i class="fa fa-pencil" aria-hidden="true"></i></a>'),l+='<div class="overlay-info ms-items" id="item_entry_'+a+"_"+i+'_info" style="display: none;" role="dialog" tabindex="-1" aria-labelledby="item_entry_'+t.oid+"_"+i+'_info_title" aria-modal="true"></div>',l+="</div>");const h=$(l);if(this._setOnClickEntryBlock(h,a,e,t,n),r.append(h),this.displayAsThumbnails)this._setThumbnailInfoBoxHtml(e,n,a,r,t,i);else{const s=this.getEntryLinks(t,e,n);s&&r.append(s)}return $(".item-entry-link",r).focus(function(){$(".item-entry").removeClass("focus"),$(this).parent().addClass("focus")}),r},MSBrowser.prototype.couldDisplay=function(e){return-1!==this.catalogFieldsToDisplay.indexOf(e)},MSBrowser.prototype._cleanSpeakers=function(e){const t=[];for(let s of e.split(","))(s=s.trim())&&t.push(s);return t.join(", ")},MSBrowser.prototype._getEntryBlockHtml=function(e,t,s,i){let a="span",n="",o=' tabindex="0" role="button"';this.useOverlay||!e.slug||this.pickMode&&"channel"!=t||(a="a",o="",n=' href="'+this.getButtonLink(e,"view")+'"',"channel"!=t&&(n+=this.linksTarget));let r="<"+a+n+o+' class="item-entry-link"'+(s&&"channel"!=t?' title="'+jsu.translateAttribute("Click to select this media")+'"':"")+">",l='<span class="item-entry-preview">';l+='<span class="item-entry-preview-aligner"></span>',e.thumb&&(l+='<img src="'+jsu.escapeAttribute(e.thumb)+'" alt=""'+(e.language?' lang="'+jsu.escapeAttribute(e.language)+'"':"")+"/>"),this.pickMode||"channel"==t||(l+='<b class="item-entry-preview-play"><i class="fa fa-play fa-4x" aria-hidden="true"></i></b>'),r+=l+="</span>";let h='<span class="item-entry-content">',c='<span class="item-entry-top-bar">';if("channel"==t)c+='<span class="item-entry-layout layout-channel" title="'+jsu.translateAttribute("This item is a channel")+'"></span>';else if("photos"==t)c+='<span class="item-entry-layout layout-pgroup" title="'+jsu.translateAttribute("This item is a photos group")+'"></span>';else{c+='<span class="item-entry-layout ',e.layout?c+="layout-"+jsu.escapeAttribute(e.layout):c+="layout-video",c+='" title="';let s="live"==t?jsu.translateHTML("This item is a live stream"):jsu.translateHTML("This item is a video");e.layout&&("composition"==e.layout?s+=" ("+jsu.translateHTML("dynamic Rich Media")+")":"webinar"==e.layout?s+=" ("+jsu.translateHTML("classic Rich Media")+")":s+=" ("+jsu.escapeHTML(e.layout.replace(/_/," "))+")"),c+=s,c+='"><span class="sr-only">'+s+"</span></span>"}if(e.can_edit&&("channel"==t?e.unlisted&&(c+='<span class="item-entry-unlisted" title="'+jsu.translateAttribute("This channel is unlisted")+'"><span class="sr-only">'+jsu.translateHTML("This channel is unlisted")+"</span></span>"):(e.validated?e.unlisted?c+='<span class="item-entry-unlisted" title="'+jsu.translateAttribute("This media is published and unlisted")+'"><span class="sr-only">'+jsu.translateHTML("This media is published and unlisted")+"</span></span>":c+='<span class="item-entry-published" title="'+jsu.translateAttribute("This media is published")+'"><span class="sr-only">'+jsu.translateHTML("This media is published")+"</span></span>":c+='<span class="item-entry-notpublished" title="'+jsu.translateAttribute("This media is not published")+'"><span class="sr-only">'+jsu.translateHTML("This media is not published")+"</span></span>","video"!=t||e.ready||(c+='<span class="item-entry-notready" title="'+jsu.translateAttribute("This video is not ready")+'"><span class="sr-only">'+jsu.translateHTML("This video is not ready")+"</span></span>"),"live"==t&&"ongoing"==e.status&&(c+='<span class="item-entry-live-running" title="'+jsu.translateAttribute("This live is running")+'"><span class="sr-only">'+jsu.translateHTML("This live is running")+"</span></span>"))),this.couldDisplay("duration")&&e.duration&&(c+='<span class="item-entry-duration">'+jsu.escapeHTML(e.duration)+"</span>"),this.couldDisplay("language")&&e.language){c+='<span class="item-entry-language">'+this.getLangHTML(e)+"</span>"}this.displayAsThumbnails||(c+='<span class="item-entry-title"'+(e.language?' lang="'+jsu.escapeAttribute(e.language)+'"':"")+">"+jsu.escapeHTML(e.title)+"</span>"),h+=c+="</span>";let d='<span class="item-entry-bottom-bar">';if(this.displayAsThumbnails)d+='<span class="item-entry-title"'+(e.language?' lang="'+jsu.escapeAttribute(e.language)+'"':"")+">"+jsu.escapeHTML(e.title)+"</span>";else{if(this.couldDisplay("creation_date")&&e.creation&&(d+='<span class="item-entry-date">'+jsu.translateHTML("Created on")+" "+jsu.getDateDisplay(e.creation)+"</span>"),this.couldDisplay("description")&&e.short_description&&(d+='<span class="item-entry-description">'+jsu.escapeHTML($("<span>"+e.short_description+"</span>").text())+"</span>"),this.couldDisplay("license")&&e.license&&(d+='<span class="item-entry-license">'+jsu.translateHTML("License:")+" "+jsu.escapeHTML(e.license)+"</span>"),this.couldDisplay("speaker")&&e.speaker&&(d+='<span class="item-entry-speaker">'+jsu.translateHTML("Speaker:")+" "+jsu.escapeHTML(this._cleanSpeakers(e.speaker))+"</span>"),this.couldDisplay("company")&&e.company&&(d+='<span class="item-entry-company">'+jsu.translateHTML("Company:")+" "+jsu.escapeHTML(e.company)+"</span>"),this.couldDisplay("views")&&e.views&&(d+='<span class="item-entry-views">'+e.views+" "+jsu.translate("views"),e.views_last_month&&(d+=", "+e.views_last_month+" "+jsu.translate("this month")),d+="</span>"),this.couldDisplay("storage")&&e.can_edit&&null!==e.storage_used&&void 0!==e.storage_used){const t=this.msapi.getStorageMinimalDisplay(e);t&&(d+='<span class="item-entry-storage">'+jsu.translate("Storage usage:")+" "+t+"</span>")}"latest"==i&&(this.couldDisplay("type")&&(d+='<span class="item-entry-type">'+jsu.translateHTML("Type:")+" "+jsu.translateHTML(t)+"</span>"),this.couldDisplay("add_date")&&e.add_date&&(d+='<span class="item-entry-date">'+jsu.translateHTML("Added on")+" "+jsu.getDateDisplay(e.add_date)+"</span>"),this.couldDisplay("parent")&&e.parent_title&&(d+='<span class="item-entry-parent">'+jsu.translateHTML("Parent channel:")+" "+jsu.escapeHTML(e.parent_title)+"</span>"))}if(h+=d+="</span>",r+=h+="</span>",r+="</"+a+">",!this.displayAsThumbnails&&!this.pickMode&&"search"==i&&(e.annotations||e.photos)){let t;if(r+='<span class="item-entry-extra">',e.annotations){for(r+="<span>"+jsu.translateHTML("Matching annotations:")+"</span><ul>",t=0;t<e.annotations.length;t++){const s=e.annotations[t];r+='<li><a href="'+this.getButtonLink(e,"view")+"#start="+s.time+'&autoplay"'+this.linksTarget+">",s.title&&(r+=jsu.escapeHTML(s.title)),r+=" ("+jsu.escapeHTML(s.time_display)+") ",r+="</a></li>"}r+="</ul>"}if(e.photos){for(r+="<span>"+jsu.translateHTML("Matching photos:")+"</span><ul>",t=0;t<e.photos.length;t++){const s=e.photos[t];r+='<li><a href="'+this.getButtonLink(e,"view")+"#"+s.index+'"'+this.linksTarget+">",s.title&&(r+=jsu.escapeHTML(s.title)),r+=" (#"+s.index+") ",r+="</a></li>"}r+="</ul>"}r+="</span>"}return r},MSBrowser.prototype.getLangHTML=function(e){if(e.language)return e.icon_lang?'<i aria-hidden="true" class="icon-lang '+e.icon_lang+'"></i>':'<i class="text-lang" aria-hidden="true">['+e.language+"]</i>"},MSBrowser.prototype._setOnClickEntryBlock=function(e,t,s,i,a){let n=!1;"channel"==s||"parent"==s?this.useOverlay&&(e.click({obj:this,oid:t},function(e){e.data.obj.channels.displayChannel(e.data.oid),e.data.obj.changeTab("channels"),jsu.focusFirstDescendant($("#ms_browser_channels .ms-browser-channels-place")[0])}),n=!0):this.pickMode&&a&&(e.click({obj:this,oid:t},function(e){e.data.obj.pick(e.data.oid)}),n=!0),n&&e.keydown({obj:this,oid:t},function(e){"13"==e.which&&(e.preventDefault(),e.stopPropagation(),$(this).click())}),!this.pickMode&&i.can_delete&&$(".item-entry-pick-delete-media",e).click({obj:this,oid:t},function(e){e.data.obj.pick(e.data.oid,"delete")})},MSBrowser.prototype.getEntryLinks=function(e,t,s){let i="";if(this.pickMode){if(s){const s=this.currentSelection&&this.currentSelection.oid==e.oid,a=s?"fa-check-circle":"fa-check";let n;n="channel"==t||"current"==t?s?jsu.translate("This channel is selected"):jsu.translate("Select this channel"):s?jsu.translate("This media is selected"):jsu.translate("Select this media"),i+='<button type="button" class="'+this.btnClass+' button main item-entry-pick"><i class="fa '+a+'" aria-hidden="true"></i> <span class="hidden-below-800">'+jsu.escapeHTML(n)+"</span></button>"}}else if("current"==t){if(e.can_see_stats&&(i+='<button type="button" title="'+jsu.translateAttribute("Statistics")+'" class="'+this.btnClass+' button default item-entry-pick-stats-media"><i class="fa fa-bar-chart" aria-hidden="true"></i> <span class="hidden-below-1280">'+jsu.translateHTML("Statistics")+"</span></button>"),e.can_edit&&(i+='<a title="'+jsu.translateAttribute("Edit")+'" class="'+this.btnClass+' button default item-entry-pick item-entry-pick-edit-media" href="'+this.getButtonLink(e,"edit")+'"'+this.linksTarget+'><i class="fa fa-pencil" aria-hidden="true"></i> <span class="hidden-below-800">'+jsu.translateHTML("Edit")+"</span></a>"),e.can_delete&&(i+='<button type="button" title="'+jsu.translateAttribute("Delete")+'" class="'+this.btnClass+' button danger item-entry-pick-delete-media"><i class="fa fa-trash" aria-hidden="true"></i> <span class="hidden-below-800">'+jsu.translateHTML("Delete")+"</span></button>"),e.can_add_channel){const t='<i class="fa fa-folder" aria-hidden="true"></i> <i class="fa fa-plus color-green" aria-hidden="true"></i>';i+='<a title="'+jsu.translateAttribute("Add a sub channel")+'" class="'+this.btnClass+' button item-entry-pick item-entry-pick-add-channel" href="'+this.getButtonLink(e,"addChannel")+'"'+this.linksTarget+">"+t+' <span class="hidden-below-800">'+jsu.translateHTML("Add a sub channel")+"</span></a>"}if("0"!=e.oid&&e.can_add_video){const t='<i class="fa fa-film" aria-hidden="true"></i> <i class="fa fa-plus color-green" aria-hidden="true"></i>';i+='<a title="'+jsu.translateAttribute("Add a video")+'" class="'+this.btnClass+' button item-entry-pick item-entry-pick-add-video" href="'+this.getButtonLink(e,"addVideo")+'"'+this.linksTarget+">"+t+' <span class="hidden-below-800">'+jsu.translateHTML("Add a video")+"</span></a>"}}else"channel"!=t&&this.ltiMode&&(i+='<button type="button" class="'+this.btnClass+' button default item-entry-copy" data-link="'+this.getButtonLink(e,"lti",!0)+'"><i class="fa fa-chain" aria-hidden="true"></i> <span class="hidden-below-440">'+jsu.translateHTML("Copy LTI link")+"</span></button>"),("channel"!=t&&this.ltiMode||e.can_edit||e.can_delete)&&(i+='<a class="'+this.btnClass+' button default item-entry-pick-view-media" href="'+this.getButtonLink(e,"view")+'"'+this.linksTarget+'><i class="fa fa-eye" aria-hidden="true"></i> <span class="hidden-below-440">'+jsu.translateHTML("See")+"</span></a>"),e.can_edit&&(i+='<a class="'+this.btnClass+' button item-entry-pick-edit-media default" href="'+this.getButtonLink(e,"edit")+'"'+this.linksTarget+'><i class="fa fa-pencil" aria-hidden="true"></i> <span class="hidden-below-440">'+jsu.translateHTML("Edit")+"</span></a>"),e.can_delete&&(i+='<button type="button" class="'+this.btnClass+' button item-entry-pick-delete-media danger"><i class="fa fa-trash" aria-hidden="true"></i> <span class="hidden-below-440">'+jsu.translateHTML("Delete")+"</span></button>");if(!i)return null;i='<span class="item-entry-links"><span class="item-entry-links-container">'+i+"</span></span>";const a=$(i);return"channel"!=t&&"parent"!=t||$(".item-entry-display",a).click({obj:this,item:e},function(e){e.data.obj.pickMode&&e.data.obj.channels.displayChannel(e.data.item.oid)}),s&&$(".item-entry-pick",a).click({obj:this,item:e},function(e){e.data.obj.pick(e.data.item.oid)}),!this.pickMode&&"current"==t&&e.can_see_stats&&$(".item-entry-pick-stats-media",a).click({obj:this,item:e},function(e){e.data.obj.openStatistics(e.data.item.oid)}),!this.pickMode&&e.can_delete&&$(".item-entry-pick-delete-media",a).click({obj:this,item:e},function(e){e.data.obj.pick(e.data.item.oid,"delete")}),$(".item-entry-copy",a).length>0&&$(".item-entry-copy",a).click(function(){const e=$(this),t=e.attr("data-link"),s=$('<input type="text" style="position: absolute; left: -10000px; top: 0;"/>').val(t);let i,a;$("body").append(s),s.select();try{a=(i=document.execCommand("copy"))?jsu.translate("copied"):jsu.translate("cannot copy")}catch(e){i=!1,a=jsu.translate("failed to copy"),console.error("Failed to copy to clipboard: "+e)}a='<i class="fa '+(i?"fa-check":"fa-warning")+'" aria-hidden="true"></i> '+jsu.escapeHTML(a),e.append('<span class="copy-msg">'+a+"</span>"),e.addClass("copied"),setTimeout(function(){e.removeClass("copied"),$(".copy-msg",e).remove()},1e3),s.remove()}),a},MSBrowser.prototype.getButtonLink=function(e,t,s){let i="",a="",n="";if(e&&e.oid&&(n=e.oid[0]),t||n&&""!==n&&"0"!==n||e&&"0"!=e.oid)if("view"==t)e.slug||"0"==e.oid||this.getInfoForOid(e.oid,!1,function(t){e=t.info}),"0"==n?(i="/channels/",a="#"):"c"==n?(i="/channels/",a="#"+e.slug):("l"==n?i="/lives/"+e.slug+"/":"v"==n?i="/videos/"+e.slug+"/":"p"==n&&(i="/photos/"+e.slug+"/"),i&&this.iframeMode&&(i+="iframe/"));else if("lti"==t)i="/lti/"+e.oid+"/";else if("edit"==t)i=this.iframeMode?"/edit/iframe/"+e.oid+"/":"/edit/"+e.oid+"/";else if("addChannel"==t)i="/add-content/channel/?in="+(e&&"0"!=e.oid?e.oid:"root");else{if("addVideo"!=t)return console.error("Unrecognized action specified in MSBrowser.prototype.getButtonLink call:",e,t,s),"";i="/add-content/",a="#add_media_by_upload",e&&"0"!=e.oid&&(i+="?in="+e.oid)}else i="/channels/",a="#";return s&&(i=window.location.protocol+"//"+window.location.host+i),this.linksUrlParams&&"lti"!=t&&(i+=(i.indexOf("?")<0?"?":"&")+this.linksUrlParams),i+a},MSBrowser.prototype._getThumbnailInfoBoxHtml=function(e,t,s,i){let a='<div><div tabindex="0"></div>';if(a+='<div class="trap-focus">',a+='<div class="overlay-info-title" id="item_entry_'+e.oid+"_"+i+'_info_title" >',a+='<button type="button" class="overlay-info-close button default '+this.btnClass+'" title="'+jsu.translateAttribute("Hide this window")+'" aria-label="'+jsu.translateAttribute("Hide this window")+'"><i class="fa fa-close" aria-hidden="true"></i></button>',a+='<h1><a href="'+this.getButtonLink(e,"view")+'"'+this.linksTarget+">"+jsu.escapeHTML(e.title)+"</a></h1>",a+="</div>",a+='<div class="overlay-info-content">',!this.pickMode&&"search"==i&&(e.annotations||e.photos)){if(e.annotations){a+="<div><b>"+jsu.translateHTML("Matching annotations:")+"</b></div>",a+="<ul>";for(let t=0;t<e.annotations.length;t++){const s=e.annotations[t];a+='<li><a href="'+this.getButtonLink(e,"view")+"#start="+s.time+'&autoplay"'+this.linksTarget+">",s.title&&(a+=jsu.escapeHTML(s.title)),a+=" ("+jsu.escapeHTML(s.time_display)+") ",a+="</a></li>"}a+="</ul>"}if(e.photos){a+="<div><b>"+jsu.translate("Matching photos:")+"</b></div>",a+="<ul>";for(let t=0;t<e.photos.length;t++){const s=e.photos[t];a+='<li><a href="'+this.getButtonLink(e,"view")+"#"+s.index+'"'+this.linksTarget+">",s.title&&(a+=jsu.escapeHTML(s.title)),a+=" (#"+s.index+") ",a+="</a></li>"}a+="</ul>"}a+="<hr/>"}if(a+='<table class="overlay-info-table">',a+='<caption class="sr-only">'+jsu.translateHTML("Media information")+"</caption>",this.couldDisplay("creation_date")&&e.creation&&"video"==t&&(a+="<tr>",a+='<th scope="row" class="overlay-info-label">'+jsu.translateHTML("Recording date")+" :</th>",a+="<td>"+jsu.getDateDisplay(e.creation)+"</td>",a+="</tr>"),this.couldDisplay("add_date")&&e.add_date&&(a+="<tr>",a+='<th scope="row" class="overlay-info-label">'+jsu.translateHTML("Publishing date")+" :</th>",a+="<td>"+jsu.getDateDisplay(e.add_date)+"</td>",a+="</tr>"),this.couldDisplay("duration")&&e.duration&&(a+="<tr>",a+='<th scope="row" class="overlay-info-label">'+jsu.translateHTML("Duration")+" :</th>",a+="<td>"+jsu.escapeHTML(e.duration)+"</td>",a+="</tr>"),this.couldDisplay("views")&&e.views_last_month&&(a+='<tr><th scope="row" class="overlay-info-label">'+jsu.translateHTML("Views last month")+" :</th><td>"+e.views_last_month+"</td></tr>"),this.couldDisplay("views")&&e.views&&(a+='<tr><th scope="row" class="overlay-info-label">'+jsu.translateHTML("Views")+" :</th><td>"+e.views+"</td></tr>"),this.couldDisplay("annotations")&&e.comments_last_month&&(a+='<tr><th scope="row" class="overlay-info-label">'+jsu.translateHTML("Annotations last month")+" :</th><td>"+e.comments_last_month+"</td></tr>"),this.couldDisplay("annotations")&&e.comments&&(a+='<tr><th scope="row" class="overlay-info-label">'+jsu.translateHTML("Annotations")+" :</th><td>"+e.comments+"</td></tr>"),this.couldDisplay("storage")&&e.can_edit&&null!==e.storage_used&&void 0!==e.storage_used){const t=this.msapi.getStorageMinimalDisplay(e);t&&(a+='<tr><th scope="row" class="overlay-info-label">'+jsu.translateHTML("Storage usage")+" :</th><td>"+t+"</td></tr>")}this.couldDisplay("license")&&e.license&&(a+='<tr><th scope="row" class="overlay-info-label">'+jsu.translateHTML("License")+" :</th><td>"+jsu.escapeHTML(e.license)+"</td></tr>"),this.couldDisplay("speaker")&&e.speaker&&(a+='<tr><th scope="row" class="overlay-info-label">'+jsu.translateHTML("Speaker")+" :</th><td>"+jsu.escapeHTML(e.speaker)+"</td></tr>"),this.couldDisplay("company")&&e.company&&(a+='<tr><th scope="row" class="overlay-info-label">'+jsu.translateHTML("Company")+" :</th><td>"+jsu.escapeHTML(e.company)+"</td></tr>"),a+="</table>",this.couldDisplay("description")&&e.short_description&&(a+="<hr/>",a+="<p>"+jsu.escapeHTML($("<span>"+e.short_description+"</span>").text())+"</p>"),a+="</div>",a+="</div>",a+='<div tabindex="0"></div></div>';const n=$(a),o=this.getEntryLinks(e,t,s);return o&&$(".overlay-info-content",n).append(o),$(".overlay-info-close",n).click({obj:this},function(e){e.data.obj.boxHideInfo()}),$(document).keydown({obj:this},function(t){$("#item_entry_"+e.oid+"_"+i+"_info").length&&27==t.keyCode&&(t.stopImmediatePropagation(),t.data.obj.boxHideInfo())}),n},MSBrowser.prototype._setThumbnailInfoBoxHtml=function(e,t,s,i,a,n){$(".item-entry-info",i).click({obj:this,$entry:i},function(o){const r="#"+i.attr("id")+"_info";if(o.data.obj.previousFocus=this,""===$(r,o.data.$entry).html())if("search"==n){const s=o.data.obj._getThumbnailInfoBoxHtml(a,e,t,n);$(r,o.data.$entry).append(s),o.data.obj.boxOpenInfo(i)}else o.data.obj.getInfoForOid(s,!0,function(s){const a=s.info;o.data.obj.updateCatalog(s.info);const l=o.data.obj._getThumbnailInfoBoxHtml(a,e,t,n);$(r,o.data.$entry).append(l),o.data.obj.boxOpenInfo(i)});else o.data.obj.boxOpenInfo(i)})},MSBrowser.prototype.trapFocus=function(e,t){jsu.ignoreUntilFocusChanges||(e.contains(t.target)?this.lastOverlayFocus=t.target:(jsu.focusFirstDescendant(e),this.lastOverlayFocus==document.activeElement&&jsu.focusLastDescendant(e),this.lastOverlayFocus=document.activeElement))},MSBrowser.prototype.boxOpenInfo=function(e){this.boxHideInfo();const t="#"+e.attr("id")+"_info",s=$(t);if(s.hasClass("moved")||s.addClass("moved").detach().appendTo("body"),!s.is(":visible")){const i=$(".item-entry-preview",e),a=parseInt(i.offset().top,10)-1;let n=parseInt(i.offset().left,10)+i.width(),o="auto";$(window).width()/2-n<0&&(n="auto",o=$(window).width()-parseInt(i.offset().left,10)),s.css("left",n+"px"),s.css("right",o+"px"),s.css("top",a+"px"),$(".item-entry-info",e).addClass("info-displayed"),s.fadeIn("fast"),this.lastOverlayFocus=document.activeElement,s.focusin(this.trapFocus.bind(this,$(".trap-focus",s)[0])),jsu.focusFirstDescendant($(".trap-focus",s)[0]),this.boxClickHandler&&$(document).unbind("click",this.boxClickHandler);const r=this;this.boxClickHandler=function(e){$(e.target).closest(t).length||$(e.target).closest(".item-entry-info").length||!$(t).is(":visible")||r.boxHideInfo()},$(document).click(this.boxClickHandler)}},MSBrowser.prototype.boxHideInfo=function(){$(".overlay-info:visible").length&&($(".overlay-info:visible").off("focusin"),this.lastOverlayFocus=document.activeElement,$(".overlay-info:visible").fadeOut("fast"),$(".item-entry-info.info-displayed").removeClass("info-displayed"),this.previousFocus&&this.previousFocus.focus())},MSBrowser.prototype.displayCategories=function(){const e=this;if(this.siteSettingsCategories.length>0){let t=' <button type="button" id="open_hidden_categories" class="button">'+jsu.translate("Categories")+' <i class="fa fa-angle-down" aria-hidden="true"></i></button>';t+=' <div id="hidden_categories" class="hidden-visibility">',t+=' <label for="filter_no_categories"><input id="filter_no_categories" type="checkbox"/><span>'+jsu.translateHTML("Unspecified")+"</span></label><br />";for(let e=0;e<this.siteSettingsCategories.length;e++){const s=jsu.escapeAttribute(this.siteSettingsCategories[e][0]),i=jsu.escapeHTML(this.siteSettingsCategories[e][1]),a=this.filterCategories.indexOf(s)<0?"":' checked="checked"';t+=' <label for="'+s+'"><input class="checkbox" id="'+jsu.escapeAttribute(s)+'" type="checkbox" value="'+jsu.escapeAttribute(s)+'"'+a+"/><span>"+jsu.escapeHTML(i)+"</span></label>"}t+=" </div>",$(".ms-browser-filters",this.$topMenu).append(t),$("#open_hidden_categories",this.$topMenu).click(function(){$("#hidden_categories").hasClass("hidden-visibility")?($(".fa",this).removeClass("fa-angle-down").addClass("fa-angle-up"),$("#hidden_categories").removeClass("hidden-visibility")):($("#hidden_categories").addClass("hidden-visibility"),$(".fa",this).removeClass("fa-angle-up").addClass("fa-angle-down"))}),$("#hidden_categories .checkbox",this.$topMenu).click(function(){const t=this.checked;e.filterNoCategories=!1,$("#filter_no_categories",e.$topMenu).prop("checked",!1),t?e.filterCategories.push(this.value):e.filterCategories.splice(e.filterCategories.indexOf(this.value),1),e.channels.refreshDisplay(!0),e.latest.refreshDisplay(!0),e.search.refreshDisplay(!0)}),$("#filter_no_categories",this.$topMenu).click(function(){this.checked?(e.filterCategories=[],$("#hidden_categories .checkbox",e.$topMenu).prop("checked",!1),e.filterNoCategories=!0,e.channels.refreshDisplay(!0),e.latest.refreshDisplay(!0),e.search.refreshDisplay(!0)):(e.filterNoCategories=!1,e.channels.refreshDisplay(!0),e.latest.refreshDisplay(!0),e.search.refreshDisplay(!0))})}},MSBrowser.prototype.removeOidFromTab=function(e,t){if($(".item-entry-"+t,e.$content).remove(),e.lastResponse){const s=["items","channels","live_streams","videos","photos_groups"];for(let i=0;i<s.length;i++){let a=-1;if(e.lastResponse[s[i]])for(let n=0;n<e.lastResponse[s[i]].length;n++)if(e.lastResponse[s[i]][n].oid==t){a=n;break}if(-1!=a){e.lastResponse[s[i]].splice(a,1);break}}}},MSBrowser.prototype.openStatistics=function(e){this.overlayStats||(this.overlayStats=new OverlayDisplayManager),this.overlayStats.show({title:jsu.translate("See statistics on this channel"),iframe:"/statistics/iframe/"+e+"/?period=last_year"})},MSBrowserLatest.prototype.getDisplayableContent=function(){let e=this.browser.displayableContent;return e.length>1&&this.browser.ltiMode&&-1!=e.indexOf("c")&&(e=e.replace(/c/g,"")),e},MSBrowserLatest.prototype.getMenuJq=function(){const e=this.getDisplayableContent();let t="";return t+='<div id="ms_browser_latest_menu" style="display: none;">',e.length>1&&(t+='<div class="ms-browser-dropdown" id="ms_browser_latest_types_dropdown">',t+='<button type="button" aria-controls="ms_browser_latest_types_dropdown_menu" aria-expanded="false" class="button ms-browser-dropdown-button '+this.browser.btnClass+'">'+jsu.translateHTML("Content types")+' <i class="fa fa-angle-down" aria-hidden="true"></i></button>',t+='<div class="ms-browser-dropdown-menu ms-browser-latest-types" id="ms_browser_latest_types_dropdown_menu">',t+="<h4>"+jsu.translateHTML("Content types to display:")+"</h4>",-1!=e.indexOf("c")&&(t+='<p><input id="latest_display_channel" type="checkbox">',t+=' <label for="latest_display_channel">'+jsu.translateHTML("channels")+"</label></p>"),-1!=e.indexOf("v")&&(t+='<p><input id="latest_display_video" type="checkbox">',t+=' <label for="latest_display_video">'+jsu.translateHTML("videos")+"</label></p>"),-1!=e.indexOf("l")&&(t+='<p><input id="latest_display_live" type="checkbox">',t+=' <label for="latest_display_live">'+jsu.translateHTML("live streams")+"</label></p>"),-1!=e.indexOf("p")&&(t+='<p><input id="latest_display_photos" type="checkbox">',t+=' <label for="latest_display_photos">'+jsu.translateHTML("photos")+"</label></p>"),t+="</div>",t+="</div>"),t+="</div>",this.$menu=$(t),e.length>1&&(this.browser.setupDropdown($("#ms_browser_latest_types_dropdown",this.$menu)),$(".ms-browser-latest-types input",this.$menu).change({obj:this},function(e){e.data.obj.refreshDisplay(!0);const t=this.id.split("_")[2][0];let s=jsu.getCookie("catalog-lastestTypes");s||(s="vlp"),this.checked?-1==s.indexOf(t)&&(s+=t):s=s.replace(new RegExp(t),""),jsu.setCookie("catalog-lastestTypes",s)})),this.$menu},MSBrowserLatest.prototype.getContentJq=function(){const e='<div id="ms_browser_latest" class="ms-browser-content" style="display: none;"><div class="messages"><div class="message info">'+jsu.translateHTML("This list presents all media and channels ordered by add date.")+'</div></div><div class="ms-browser-latest-place"></div>'+this.browser.getMoreButton()+"</div>";return this.$content=$(e),this.$place=$(".ms-browser-latest-place",this.$content),this.$content},MSBrowserLatest.prototype.onShow=function(){if(this.browser.setTitle("latest",jsu.translate("Latest media")),this.initialized)return;if(this.initialized=!0,this.getDisplayableContent().length>1){let e=jsu.getCookie("catalog-lastestTypes");e||(e="cvlp"),$(".ms-browser-latest-types #latest_display_channel",this.$menu).prop("checked",-1!=e.indexOf("c")),$(".ms-browser-latest-types #latest_display_video",this.$menu).prop("checked",-1!=e.indexOf("v")),$(".ms-browser-latest-types #latest_display_live",this.$menu).prop("checked",-1!=e.indexOf("l")),$(".ms-browser-latest-types #latest_display_photos",this.$menu).prop("checked",-1!=e.indexOf("p"))}this.loadLatest(this.browser.displayCount)},MSBrowserLatest.prototype.loadLatest=function(e,t){if(this.latestLoading)return;this.latestLoading=!0;const s=this.getDisplayableContent(),i={};s.length>1?(i.content="",-1!=s.indexOf("c")&&$("#latest_display_channel",this.$menu).is(":checked")&&(i.content+="c"),-1!=s.indexOf("v")&&$("#latest_display_video",this.$menu).is(":checked")&&(i.content+="v"),-1!=s.indexOf("l")&&$("#latest_display_live",this.$menu).is(":checked")&&(i.content+="l"),-1!=s.indexOf("p")&&$("#latest_display_photos",this.$menu).is(":checked")&&(i.content+="p")):s&&(i.content=s),null!==this.browser.filterEditable&&(i.editable=this.browser.filterEditable?"yes":"no"),null!==this.browser.filterValidated&&(i.validated=this.browser.filterValidated?"yes":"no"),null!==this.browser.filterSpeaker&&(i.speaker=this.browser.filterSpeaker),this.browser.filterNoCategories?i.no_categories=!0:this.browser.filterCategories.length>0&&(i.categories=this.browser.filterCategories.join("\n"));let a=0;if(this.startDate&&(i.start=this.startDate,a=parseInt(this.startDate.replace(new RegExp("[-_]","g"),""),10),isNaN(a)&&(a=0)),t){const e=parseInt(t.replace(new RegExp("[-_]","g"),""),10);if(a>0&&!isNaN(e)&&e>=a)return this.latestLoading=!1,void console.log("cancelled");i.end=t}e&&(i.count=e);const n=this;this.browser.displayLoading(),this.browser.msapi.ajaxCall("getLatestContent",i,function(e){e.items&&e.items.length>0&&(n.lastResponse?n.lastResponse.items=n.lastResponse.items.concat(e.items):n.lastResponse=e),n._onAjaxResponse(e),n.latestLoading=!1})},MSBrowserLatest.prototype._onAjaxError=function(e){let t='<div class="messages">';if(this.browser.useOverlay||"403"!=e.errorCode&&"401"!=e.errorCode)t+='<div class="message error">'+jsu.escapeHTML(e.error)+"</div>";else{const s=this.browser.urlLogin+"?next="+window.location.pathname+(window.location.hash?window.location.hash.substring(1):"");t+='<div class="item-description"><div class="message error">'+jsu.escapeHTML(e.error)+"</div><p>"+jsu.translateHTML("Please login to access this page")+'<br /> <a href="'+s+'">'+jsu.translateHTML("Sign in")+"</a></p></div>"}t+="</div>",this.$place.html(t)},MSBrowserLatest.prototype._onAjaxResponse=function(e){if(this.browser.hideLoading(),!e.success)return this._onAjaxError(e);this.startDate=e.max_date,this.more=!0===e.more;for(let t=0;t<e.items.length;t++){const s=e.items[t];if(s.date_label&&s.date_label!=this.dateLabel){this.dateLabel=s.date_label;const e=this.browser.pickMode?"h3":"h2";this.$place.append("<"+e+">"+this.dateLabel+"</"+e+">"),this.$section=$('<ul class="ms-browser-section"></ul>'),this.$place.append(this.$section)}else this.$section||(this.$section=$('<ul class="ms-browser-section"></ul>'),this.$place.append(this.$section),console.log("A browser section is missing in latest tab. This should not happen.",s.date_label,this.dateLabel));let i;i="v"==s.type?"video":"l"==s.type?"live":"p"==s.type?"photos":"channel";const a=-1!=this.browser.selectableContent.indexOf(s.type);this.$section.append(this.browser.getContentEntry(i,s,a,"latest"))}if(null===this.$section){const e=$('<div class="messages"><div class="message info">'+jsu.translate("No contents.")+"</div></div>");this.$place.append(e)}this.more?this.browser.showMoreBtns("latest"):this.browser.hideMoreBtns("latest")},MSBrowserLatest.prototype.displayMore=function(e){this.more&&this.loadLatest(e)},MSBrowserLatest.prototype.refreshDisplay=function(e){e&&(this.lastResponse=null),this.lastResponse?(this.dateLabel="",this.$section=null,this.$place.html(""),this._onAjaxResponse(this.lastResponse)):(this.more=!1,this.startDate="",this.dateLabel="",this.$section=null,this.$place.html(""),this.loadLatest(this.browser.displayCount))},MSBrowserLatest.prototype.remove=function(e){this.browser.removeOidFromTab(this,e)},MSBrowserSearch.prototype.getDisplayableContent=function(){let e=this.browser.displayableContent;return e.length>1&&this.browser.ltiMode&&-1!=e.indexOf("c")&&(e=e.replace(/c/g,"")),e},MSBrowserSearch.prototype.shouldBeDisplayed=function(e,t){if(!t)return!0;for(let s=0;s<e.length;s++)if(-1!=t.indexOf(e[s]))return!0;return!1},MSBrowserSearch.prototype.getMenuJq=function(){const e=this.getDisplayableContent();let t='<div id="ms_browser_search_menu" style="display: none;"><form class="ms-browser-search-form" method="get" action="." onsubmit="javascript: return false;"><label for="ms_browser_search_text"><span class="hidden-below-800">'+jsu.translateHTML("Search:")+'</span></label> <input id="ms_browser_search_text" type="text" value=""> <button type="submit" class="button" id="ms_browser_search_start">'+jsu.translateHTML("Go")+'</button></form><div class="ms-browser-dropdown" id="ms_browser_search_in_dropdown"><button type="button" aria-controls="ms_browser_search_in_dropdown_menu" aria-expanded="false" class="button ms-browser-dropdown-button '+this.browser.btnClass+'">'+jsu.translate("Search in")+' <i class="fa fa-angle-down" aria-hidden="true"></i></button><div class="ms-browser-dropdown-menu ms-browser-search-in" id="ms_browser_search_in_dropdown_menu"> <div><button type="button" class="button" id="ms_browser_search_in_all">'+jsu.translateHTML("all")+'</button> <button type="button" class="button" id="ms_browser_search_in_none">'+jsu.translateHTML("none")+"</button></div>";for(let s=0;s<this.searchInFields.length;s++){const i=this.searchInFields[s];this.shouldBeDisplayed(e,i.items)&&(t+=' <div><input id="ms_browser_search_'+i.name+'" type="checkbox" '+(i.initial?'checked="checked"':"")+">",t+=' <label for="ms_browser_search_'+i.name+'">'+i.label+"</label></div>")}if(t+="</div></div>",e.length>1){t+='<div class="ms-browser-dropdown" id="ms_browser_search_for_dropdown"><button type="button" aria-controls="ms_browser_search_for_dropdown_menu" aria-expanded="false" class="button ms-browser-dropdown-button '+this.browser.btnClass+'">'+jsu.translateHTML("Search for")+' <i class="fa fa-angle-down" aria-hidden="true"></i></button><div class="ms-browser-dropdown-menu ms-browser-search-for" id="ms_browser_search_for_dropdown_menu"> <div><button type="button" class="button" id="ms_browser_search_for_all">'+jsu.translateHTML("all")+'</button> <button type="button" class="button" id="ms_browser_search_for_none">'+jsu.translateHTML("none")+"</button></div>";for(let s=0;s<this.searchForFields.length;s++){const i=this.searchForFields[s];this.shouldBeDisplayed(e,i.items)&&(t+=' <div><input id="ms_browser_search_'+i.name+'" type="checkbox" '+(i.initial?'checked="checked"':"")+">",t+=' <label for="ms_browser_search_'+i.name+'">'+i.label+"</label></div>")}t+="</div></div>"}return t+="</div>",this.$menu=$(t),this.browser.setupDropdown($("#ms_browser_search_in_dropdown",this.$menu)),this.browser.setupDropdown($("#ms_browser_search_for_dropdown",this.$menu)),$("form",this.$menu).submit({obj:this},function(e){e.data.obj.onSearchSubmit()}),$("#ms_browser_search_in_all",this.$menu).click({obj:this},function(e){$(".ms-browser-search-in input[type=checkbox]",e.data.obj.$menu).prop("checked",!0),e.data.obj.onSearchSubmit()}),$("#ms_browser_search_in_none",this.$menu).click({obj:this},function(e){$(".ms-browser-search-in input[type=checkbox]",e.data.obj.$menu).prop("checked",!1),e.data.obj.onSearchSubmit()}),$("#ms_browser_search_for_all",this.$menu).click({obj:this},function(e){$(".ms-browser-search-for input[type=checkbox]",e.data.obj.$menu).prop("checked",!0),e.data.obj.onSearchSubmit()}),$("#ms_browser_search_for_none",this.$menu).click({obj:this},function(e){$(".ms-browser-search-for input[type=checkbox]",e.data.obj.$menu).prop("checked",!1),e.data.obj.onSearchSubmit()}),$("input[type=checkbox]",this.$menu).change({obj:this},function(e){e.data.obj.onSearchSubmit()}),this.$menu},MSBrowserSearch.prototype.getContentJq=function(){const e='<div id="ms_browser_search" class="ms-browser-content" style="display: none;"><div class="ms-browser-search-place"><div class="messages"><div class="message info">'+jsu.translateHTML("Use the input above to search for something.")+"</div></div></div>"+this.browser.getMoreButton()+"</div>";return this.$content=$(e),this.$place=$(".ms-browser-search-place",this.$content),this.$content},MSBrowserSearch.prototype.onShow=function(){this.browser.setTitle(this.currentTitle?this.currentTitle:jsu.translate("Search")),this.initialized||(this.initialized=!0,this.browser.hideMoreBtns("search"),this.onUrlChange(),this.browser.useOverlay||"search"!=this.browser.getActiveTab()||$("#top_search_form form").submit({obj:this},function(e){return $("#ms_browser_search_text",this.$menu).val($("#top_search_input").val()),e.data.obj.onSearchSubmit(),!1}))},MSBrowserSearch.prototype.setOrder=function(e){this.order=e||"default",this.refreshDisplay(!0)},MSBrowserSearch.prototype.onUrlChange=function(){if(!this.initialized)return;const e=this.browser.parseUrl(),t=this.getDisplayableContent();for(let s=0;s<this.searchInFields.length;s++){const i=this.searchInFields[s];if(this.shouldBeDisplayed(t,i.items)){let t;t=e.hasInVals?Boolean(e[i.name]):i.initial,$("#ms_browser_search_"+i.name,this.$menu).prop("checked",t)}}for(let s=0;s<this.searchForFields.length;s++){const i=this.searchForFields[s];if(this.shouldBeDisplayed(t,i.items)){let t;t=e.hasForVals?Boolean(e[i.name]):i.initial,$("#ms_browser_search_"+i.name,this.$menu).prop("checked",t)}}e.text&&($("#ms_browser_search_text",this.$menu).val(e.text),this.onSearchSubmit(!0))},MSBrowserSearch.prototype.toggleSearchLoading=function(){this.loadingSearch=!this.loadingSearch;const e=this.browser.useOverlay?$("#ms_browser_search_text",this.$menu):$("#top_search_input"),t=this.browser.useOverlay?$("#ms_browser_search_start",this.$menu):$("#top_search_btn");this.loadingSearch?(e.prop("disabled",!0),t.prop("disabled",!0)):(e.prop("disabled",!1),t.prop("disabled",!1))},MSBrowserSearch.prototype.onSearchSubmit=function(e){const t=$("#ms_browser_search_text",this.$menu).val();if(!t)return;if(this.loadingSearch)return;this.toggleSearchLoading(),this.browser.displayLoading();const s=this.getDisplayableContent();let i="text="+t,a="";for(let e=0;e<this.searchInFields.length;e++){const t=this.searchInFields[e];if(this.shouldBeDisplayed(s,t.items)){$("#ms_browser_search_"+t.name,this.$menu).is(":checked")&&(a+=t.name.substring(2),i+="&"+t.name)}}a=a?a.substring(1):"metadata";let n="";for(let e=0;e<this.searchForFields.length;e++){const t=this.searchForFields[e];if(this.shouldBeDisplayed(s,t.items)){$("#ms_browser_search_"+t.name,this.$menu).is(":checked")&&(n+=t.name.substring(4,5),i+="&"+t.name)}}n||(n=s);const o={search:t,content:n,order_by:this.order,fields:a};null!==this.browser.filterEditable&&(o.editable=this.browser.filterEditable?"yes":"no"),null!==this.browser.filterValidated&&(o.validated=this.browser.filterValidated?"yes":"no"),null!==this.browser.filterSpeaker&&(o.speaker=this.browser.filterSpeaker),this.browser.filterNoCategories?o.no_categories=!0:this.browser.filterCategories.length>0&&(o.categories=this.browser.filterCategories.join("\n"));const r=jsu.escapeHTML(jsu.translate("Search results for:")+" "+t);if(this.currentTitle=r,this.browser.setTitle(r),!this.browser.pickMode&&!e){let e=this.browser.urlSearch;e.indexOf("?")<0?e+="?"+i:e+="&"+i,this.lastUrl&&this.lastUrl==e||(this.lastUrl=e,window.history.pushState({ms_tab:"search",search:t},r,e))}const l=this;this.browser.msapi.ajaxCall("search",o,function(e){l.toggleSearchLoading(),l._onAjaxResponse(e),window.gaPageview&&window.gaPageview("ajax search","/ajax_search?search="+o.search+"&fields="+o.fields)})},MSBrowserSearch.prototype._onAjaxError=function(e){this.lastResponse=null;let t='<div class="messages">';if(this.browser.useOverlay||"403"!=e.errorCode&&"401"!=e.errorCode)t+='<div class="message error">'+jsu.escapeHTML(e.error)+"</div>";else{const s=this.browser.urlLogin+"?next="+window.location.pathname+(window.location.hash?window.location.hash.substring(1):"");t+='<div class="item-description"><div class="message error">'+jsu.escapeHTML(e.error)+"</div><p>"+jsu.translateHTML("Please login to access this page")+'<br /> <a href="'+s+'">'+jsu.translate("Sign in")+"</a></p></div>"}t+="</div>",this.$place.html(t)},MSBrowserSearch.prototype._onAjaxResponse=function(e){if(this.browser.hideLoading(),this.browser.moreChannels=[],this.browser.moreLiveStreams=[],this.browser.moreVideos=[],this.browser.morePhotosGroups=[],this.browser.hideMoreBtns("search"),!e.success)return this._onAjaxError(e);this.lastResponse=e;const t=e.channels?e.channels.length:0,s=e.videos?e.videos.length:0,i=e.live_streams?e.live_streams.length:0,a=e.photos_groups?e.photos_groups.length:0,n=t>0||s>0||i>0||a>0;if(this.$place.html(""),n){const n=[];t>0&&n.push(t+" "+jsu.translate("channel(s)")),s>0&&n.push(s+" "+jsu.translate("video(s)")),i>0&&n.push(i+" "+jsu.translate("live stream(s)")),a>0&&n.push(a+" "+jsu.translate("photos group(s)"));const o='<div class="ms-browser-search-matching"><b>'+jsu.translateHTML("Matching items:")+"</b> "+jsu.escapeHTML(n.join(", "))+"</div>";this.$place.append(o),this.browser.displayContent(this.$place,e,null,"search")}else this.$place.html('<div class="messages"><div class="message info">'+jsu.translateHTML("No results.")+"</div></div>")},MSBrowserSearch.prototype.refreshDisplay=function(e){e&&this.lastResponse&&(this.lastResponse=null),this.lastResponse?this._onAjaxResponse(this.lastResponse):this.onSearchSubmit(!0)},MSBrowserSearch.prototype.remove=function(e){this.browser.removeOidFromTab(this,e)},MSBrowser.prototype.init=function(){if(this.initialized)return;this.initialized=!0,"thumbnail"==jsu.getCookie("catalog-displayMode")&&(this.displayAsThumbnails=!0,this.useOverlay||$("#container").removeClass("max-width-1200")),"yes"==jsu.getCookie("catalog-displayTypesIcons")&&(this.displayTypesIcons=!0);const e=this.parseUrl();if(!this.useOverlay){this.pickMode=!1;const t=[];if(e.iframe&&(this.iframeMode=!0,this.urlLogin="/login/iframe/",t.push("iframe")),e.login&&t.push("login="+window.encodeURIComponent(e.login)),this.hideHeader&&t.push("header=no"),e.speaker&&(this.filterSpeaker=e.speaker,t.push("speaker="+window.encodeURIComponent(this.filterSpeaker))),e.mine&&(this.filterSpeaker="self",t.push("mine"),this.treeManager=!1),e.lti&&(this.ltiMode=!0,t.push("lti")),e.newtab&&(this.linksTarget=' target="Blank"',t.push("newtab")),e.categories&&(this.filterCategories=e.categories.toString().split(","),t.push("categories="+window.encodeURIComponent(e.categories))),e.pick&&(this.pickMode=!0,e.pick.toString().match(/^[cvlp]+$/)?(this.selectableContent=e.pick,this.displayableContent=e.pick,this.displayableContent.indexOf("c")<0&&(this.displayableContent="c"+this.displayableContent)):(this.selectableContent="vlp",this.displayableContent="cvlp"),t.push("pick="+this.selectableContent),!this.initialOid&&e.initial&&(this.initialOid=e.initial.toString(),t.push("initial="+window.encodeURIComponent(this.initialOid)))),e.return&&(window.parent&&0===e.return.toString().indexOf("postMessageAPI")||0===e.return.toString().indexOf("https://")&&e.return.toString().length>8)){let s;this.pickMode||(this.pickMode=!0,this.selectableContent="vlp",this.displayableContent="cvlp",t.push("pick="+this.selectableContent)),t.push("return="+e.return),s=window.parent&&0===e.return.toString().indexOf("postMessageAPI")?e.return:this.urlPostLink+"?return="+e.return,this.onPick=function(e,t){if(!t)if(0===s.indexOf("postMessageAPI")){const i=window.opener?window.opener.parent:window.parent,a=s.substring("postMessageAPI".length).replace(/^:+|:+$/g,"");console.log("Posting message:",{item:e,initialPick:Boolean(t),target:a}),i.postMessage({item:e,initialPick:Boolean(t),target:a},"*"),window.opener&&window.close()}else window.location=s+"&oid="+e.oid}}t.length>0&&(this.linksUrlParams=t.join("&"),this.urlLogin+="?"+this.linksUrlParams,this.urlChannels+="?"+this.linksUrlParams,this.urlLatest+="?"+this.linksUrlParams,this.urlSearch+="?"+this.linksUrlParams)}this.initOptions.browser=this,this.currentSelection&&this.currentSelection.oid&&(0!==this.currentSelection.oid.indexOf("c")&&isNaN(parseInt(this.currentSelection.oid,10))?this.initOptions.currentChannelOid=this.currentSelection.parent_oid:this.initOptions.currentChannelOid=this.currentSelection.oid),this.channels=new MSBrowserChannels(this.initOptions),this.latest=new MSBrowserLatest(this.initOptions),this.search=new MSBrowserSearch(this.initOptions),this.buildWidget(),this.initialState&&this.initialState.tab?this.changeTab(this.initialState.tab,!0):this.changeTab("channels",!0),this.initialOid&&this.pick(this.initialOid,null,!0);const t=this;this.useOverlay?this.overlay=new OverlayDisplayManager:$(window).bind("hashchange",function(){t.onUrlChange()}),this.loadCategories(),$(window).resize(function(){t.onResize()}),this.onResize()},MSBrowser.prototype.open=function(){this.useOverlay&&(this.init(),this.overlay.show({title:this.title,html:this.$widget}))},MSBrowser.prototype.updateCatalog=function(e,t){if(e&&e.oid)if(this.catalog[e.oid]){let s;for(s in e)this.catalog[e.oid][s]=e[s];t&&(this.catalog[e.oid].is_full=!0)}else t&&(e.is_full=!0),this.catalog[e.oid]=e},MSBrowser.prototype.getInfoForOid=function(e,t,s){const i=e&&("v"==e[0]||"l"==e[0]||"p"==e[0]);return this.getInfo({oid:e},i,t,s)},MSBrowser.prototype.getInfoForSlug=function(e,t,s,i){return this.getInfo({slug:e},t,s,i)},MSBrowser.prototype.getInfo=function(e,t,s,i){if(!e.oid&&!e.slug||!i)return;const a=e.oid?"oid":"slug";let n,o=null;for(n in this.catalog)if((!t&&"c"==n[0]||t&&"c"!=n[0])&&this.catalog[n][a]==e[a]){s?this.catalog[n].is_full&&(o=this.catalog[n]):o=this.catalog[n];break}if(o)return i({success:!0,info:o});this.displayLoading(),s&&(e.full="yes");const r=t?"getMedias":"getChannels",l=this;this.msapi.ajaxCall(r,e,function(e){e.success&&l.updateCatalog(e.info,s),l.hideLoading(),i(e)})},MSBrowser.prototype.pick=function(e,t,s){if(null==e)return void(this.currentSelection&&this.currentSelection.oid&&$(".item-entry-"+this.currentSelection.oid,this.$main).removeClass("selected"));if(this.catalog[e]&&this.catalog[e].is_full)return void this._pick(e,{success:!0,info:this.catalog[e]},t,s);const i=this;this.getInfoForOid(e,!0,function(a){i._pick(e,a,t,s)})},MSBrowser.prototype._pick=function(e,t,s,i){t.success?this.pickMode?(this.currentSelection&&this.currentSelection.oid&&$(".item-entry-"+this.currentSelection.oid,this.$main).removeClass("selected"),this.currentSelection=this.catalog[e],$(".item-entry-"+this.currentSelection.oid,this.$main).addClass("selected"),this.overlay&&!i&&this.overlay.hide(),this.onPick&&this.onPick(this.catalog[e],i),!this.useOverlay&&t.info.parent_slug?window.location.hash="#"+t.info.parent_slug:this.useOverlay&&t.info.parent_oid&&this.channels.displayChannel(t.info.parent_oid)):"delete"==s&&window.deleteFormManager&&window.deleteFormManager.show(e,this.catalog[e].title):console.log("Unable to get info about initial selection:"+t.error)},MSBrowser.prototype.remove=function(e){e&&this.catalog[e]&&(this.channels.remove(e),this.latest.remove(e),this.search.remove(e))},MSBrowser.prototype.getLastPick=function(){return this.currentSelection},MSBrowser.prototype.getSelectedOid=function(){return this.initialized?this.currentSelection?this.currentSelection.oid:null:this.initialOid},MSBrowser.prototype.parseUrl=function(){const e={},t=window.location.search?window.location.search.substring(1):null;if(t){const s=t.split("&");for(let t=0;t<s.length;t++){let i,a;-1!=s[t].indexOf("=")?(i=s[t].substring(0,s[t].indexOf("=")),a="on"==(a=s[t].substring(i.length+1))||"off"!=a&&window.decodeURIComponent(a.replace(/\+/g,"%20"))):(i=s[t],a=!0),"in_"==i.substring(0,3)?e.hasInVals=!0:"for_"==i.substring(0,4)&&(e.hasForVals=!0),e[i]=a}}return e},MSBrowser.prototype.onUrlChange=function(){const e=window.location.pathname+window.location.search;if(0===e.indexOf("/channels/")){let e=window.location.hash;e&&"#"==e[0]&&(e=e.substring(1)),e?this.channels.displayChannelBySlug(e):"self"==this.filterSpeaker?this.channels.displayPersonalChannel():this.channels.displayChannel("0"),this.changeTab("channels",!0)}else 0===e.indexOf("/latest/")?this.changeTab("latest",!0):0===e.indexOf("/search/")&&(this.search.onUrlChange(),this.changeTab("search",!0))},MSBrowser.prototype.onResize=function(){if(this.useOverlay){const e=$(window).width()-70;this.$widget.width(e);const t=$(window).height()-100;this.$widget.height(t)}},MSBrowser.prototype.loadCategories=function(){const e=this;this.msapi.ajaxCall("listCategories",{},function(t){t.data&&(e.siteSettingsCategories=t.data,e.displayCategories())})};