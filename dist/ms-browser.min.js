function MSBrowserChannels(t){this.browser=null,this.displayItunesRss=!1,this.currentChannelOid="0",this.$menu=null,this.$content=null,this.treeManager=null,this.order="default",this.lastResponse=null,jsu.setObjectAttributes(this,t,["browser","displayItunesRss","currentChannelOid"]),this.initOptions=t||{}}function MSBrowserLatest(t){this.browser=null,this.$menu=null,this.$content=null,this.$place=null,this.lastResponse=null,this.more=!1,this.startDate="",this.dateLabel="",this.$section=null,jsu.setObjectAttributes(this,t,["browser"]),this.initOptions=t||{}}function MSBrowserSearch(t){if(this.browser=null,this.$menu=null,this.$content=null,this.order="default",this.lastResponse=null,this.searchInFields=[{name:"in_title",label:jsu.translateHTML("titles"),initial:!0,items:null},{name:"in_description",label:jsu.translateHTML("descriptions"),initial:!1,items:null},{name:"in_keywords",label:jsu.translateHTML("keywords"),initial:!0,items:null},{name:"in_speaker",label:jsu.translateHTML("speakers"),initial:!0,items:"vlp"},{name:"in_license",label:jsu.translateHTML("licenses"),initial:!1,items:"vlp"},{name:"in_company",label:jsu.translateHTML("companies"),initial:!1,items:"vlp"},{name:"in_location",label:jsu.translateHTML("locations"),initial:!1,items:"vlp"},{name:"in_categories",label:jsu.translateHTML("categories"),initial:!1,items:"vlp"},{name:"in_annotations",label:jsu.translateHTML("comments, slides, ..."),initial:!1,items:"vlp"},{name:"in_photos",label:jsu.translateHTML("photos"),initial:!1,items:"p"},{name:"in_extref",label:jsu.translateHTML("external references"),initial:!0,items:null},{name:"in_extdata",label:jsu.translateHTML("external data"),initial:!1,items:null}],t.defaultSearchIn)for(let e=0;e<this.searchInFields.length;e++){const s=this.searchInFields[e].name.replace("in_","");-1!==t.defaultSearchIn.indexOf(s)?this.searchInFields[e].initial=!0:this.searchInFields[e].initial=!1}this.searchForFields=[{name:"for_channels",label:jsu.translateHTML("channels"),initial:!0,items:"c"},{name:"for_videos",label:jsu.translateHTML("videos"),initial:!0,items:"v"},{name:"for_lives",label:jsu.translateHTML("live streams"),initial:!0,items:"l"},{name:"for_photos",label:jsu.translateHTML("photos groups"),initial:!0,items:"p"}],jsu.setObjectAttributes(this,t,["browser"]),this.initOptions=t||{}}function MSBrowser(t){if(this.title="",this.place=null,this.selectableContent="cvlp",this.displayableContent="cvlp",this.filterEditable=null,this.filterValidated=null,this.filterSpeaker=null,this.filterCategories=[],this.filterNoCategories=!1,this.parentSelectionOid=null,this.initialOid=null,this.initialState=null,this.onPick=null,this.hideHeader=!1,this.btnClass="",this.msapi=null,this.treeManager=!0,this.displayTypesIcons=!1,this.displayItunesRss=!0,this.useOverlay=!0,this.pickMode=!0,this.iframeMode=!1,this.ltiMode=!1,this.linksUrlParams="",this.linksTarget="",this.$widget=null,this.$menu=null,this.$main=null,this.overlay=null,this.catalog={},this.displayAsThumbnails=!1,this.displayed="channels",this.currentSelection=null,this.siteSettingsCategories=[],this.catalogFieldsToDisplay=["duration","description","creation_date","views","annotations","storage","rss_links","channel_content","add_date","type","parent"],this.urlLogin="/login/",this.urlChannels="/channels/",this.urlLatest="/latest/",this.urlSearch="/search/",this.urlPostLink="/lti/post-link/",this.defaultSearchIn=[],this.moreChannels=[],this.moreLiveStreams=[],this.moreVideos=[],this.morePhotosGroups=[],this.displayCount=jsu.getCookie("catalog-displayCount")||30,jsu.setObjectAttributes(this,t,["title","place","msapi","selectableContent","displayableContent","filterEditable","filterValidated","filterSpeaker","parentSelectionOid","initialOid","initialState","onPick","hideHeader","btnClass","treeManager","displayTypesIcons","displayItunesRss","defaultSearchIn","catalogFieldsToDisplay"]),this.msapi||(this.msapi=new MSAPIClient(t)),this.initOptions=t||{},this.useOverlay=!this.place,!this.useOverlay){const t=this;$(document).ready(function(){t.init()})}}MSBrowserChannels.prototype.getMenuJq=function(){return this.$menu=$('<div id="ms_browser_channels_menu" style="display: none;"></div>'),this.$menu},MSBrowserChannels.prototype.getContentJq=function(){let t='<div id="ms_browser_channels" class="ms-browser-content" style="display: none;">';return this.browser.treeManager&&(t+='<div class="ms-browser-tree-place ms-channels-tree"><div><i class="fa fa-spinner fa-spin" aria-hidden="true"></i> '+jsu.translateHTML("Loading...")+"</div></div>"),t+='<div class="ms-browser-channels-body"><div class="ms-browser-channels-place"><div class="messages"><div class="message info">'+jsu.translateHTML("Select a channel to display its content.")+"</div></div></div>"+this.browser.getMoreButton()+"</div></div>",this.$content=$(t),this.$place=$(".ms-browser-channels-place",this.$content),this.$content},MSBrowserChannels.prototype.refreshTitle=function(){if("channels"!=this.browser.getActiveTab())return;const t=this.lastResponse?this.lastResponse.info:void 0;if(t&&"0"!=t.oid){let e='<span class="item-entry-preview"><img src="'+jsu.escapeAttribute(t.thumb)+'" alt="'+jsu.escapeHTML(t.title)+'"/></span>';e+='<span class="channel-titles-place">';const s=t.parent_oid&&"0"!=t.parent_oid?t.parent_title:jsu.translate("Root");this.browser.useOverlay||!s||this.browser.hideHeader&&this.browser.initialState&&this.browser.initialState.channelSlug&&this.browser.initialState.channelSlug==t.slug||(e+='<a class="parent-channel-title" href="#'+jsu.escapeAttribute(t.parent_slug?t.parent_slug:"")+'"'+(t.parent_language?'lang="'+jsu.escapeAttribute(t.parent_language)+'"':"")+">"+jsu.escapeHTML(s)+"</a><wbr/>"),e+='<span class="channel-title"'+(t.language?'lang="'+jsu.escapeAttribute(t.language)+'"':"")+">"+jsu.escapeHTML(t.title)+"</span>",e+="</span>",this.browser.currentSelection&&this.browser.currentSelection.oid==t.oid&&(e='<span class="selected">'+e+"</span>"),this.browser.setTitle(t.title,e)}else this.browser.ltiMode?this.browser.setTitle(jsu.translateHTML("My channel")):this.browser.setTitle(jsu.translateHTML("Main channels"))},MSBrowserChannels.prototype.onShow=function(){if(this.refreshTitle(),this.initialized)return;this.initialized=!0,this.defaultLogoSrc=$("#mainlogo .header-logo").attr("src"),this.defaultFavSrc=$("#favicon_link").attr("src");const t=this;if(this.browser.treeManager){const e={$place:$(".ms-browser-tree-place",this.$content),msapi:this.browser.msapi,displayRoot:-1!=this.browser.displayableContent.indexOf("c"),displayPersonal:!0,currentChannelOid:this.currentChannelOid,onDataRetrieved:function(e){t.browser.updateCatalog(e)}};this.browser.pickMode&&(e.onChange=function(e){t.displayChannel(e)}),this.treeManager=new MSTreeManager(e)}this.initOptions.initialState&&this.initOptions.initialState.channelSlug?this.displayChannelBySlug(this.initOptions.initialState.channelSlug):"self"==this.browser.filterSpeaker?this.displayPersonalChannel():this.displayChannel(this.currentChannelOid)},MSBrowserChannels.prototype.setOrder=function(t){this.order=t||"default",this.refreshDisplay(!0)},MSBrowserChannels.prototype.displayPersonalChannel=function(){const t=this;this.personalChannelOid?t.displayChannel(this.personalChannelOid):this.browser.msapi.ajaxCall("getChannelsPersonal",{},function(e){e.success?(t.personalChannelOid=e.oid,t.displayChannel(e.oid)):403==e.errorCode?t._onChannelError({error:jsu.translate("You are not allowed to have a personal channel.")}):t._onChannelError(e)})},MSBrowserChannels.prototype.displayChannelBySlug=function(t){const e=this;this.browser.getInfoForSlug(t,!1,!0,function(t){t.success?e.displayChannel(t.info.oid):e._onChannelError(t)})},MSBrowserChannels.prototype.displayChannel=function(t){if(this.currentChannelOid=t,this.browser.boxHideInfo(),this.initialized)if(this.browser.displayLoading(),this.treeManager&&this.treeManager.setActive(t),"0"!=t){const e=this;this.browser.getInfoForOid(t,!0,function(s){e._onChannelInfo(s,t)})}else this._onChannelInfo(null,t)},MSBrowserChannels.prototype.displayParent=function(){if(!this.currentChannelOid)return;const t=this.currentChannelOid,e=this.browser.catalog[t]&&this.browser.catalog[t].parent_oid?this.browser.catalog[t].parent_oid:"0";this.displayChannel(e)},MSBrowserChannels.prototype._onChannelError=function(t){this.lastResponse=null;let e='<div class="messages">';if(this.browser.useOverlay||"403"!=t.errorCode&&"401"!=t.errorCode)e+='<div class="message error">'+jsu.escapeHTML(t.error)+"</div>";else{const s=this.browser.urlLogin+"?next="+window.location.pathname+(window.location.hash?window.location.hash.substring(1):"");e+='<div class="item-description"><div class="message error">'+jsu.escapeHTML(t.error)+'</div><div style="margin: 0.3em;">'+jsu.translateHTML("Please login to access this channel")+'</div><div><a class="button default" href="'+s+'">'+jsu.translateHTML("Sign in")+"</a></div></div>"}e+="</div>",this.$place.html(e),this.browser.hideMoreBtns("channels")},MSBrowserChannels.prototype._onChannelInfo=function(t,e){if(this.currentChannelOid!=e)return void this.browser.hideLoading();if(t&&!t.success)return this._onChannelError(t);const s={};e&&"0"!=e&&(s.parent_oid=e),this.browser.parentSelectionOid&&(s.parent_selection_oid=this.browser.parentSelectionOid),this.browser.displayableContent&&(s.content=this.browser.displayableContent),null!==this.browser.filterEditable&&(s.editable=this.browser.filterEditable?"yes":"no"),null!==this.browser.filterValidated&&(s.validated=this.browser.filterValidated?"yes":"no"),this.browser.ltiMode||null===this.browser.filterSpeaker||(s.speaker=this.browser.filterSpeaker),this.browser.filterNoCategories?s.no_categories=!0:this.browser.filterCategories.length>0&&(s.categories=this.browser.filterCategories.join("\n")),s.order_by=this.order;const i=this;this.browser.msapi.ajaxCall("getChannelsContent",s,function(s){t&&(t.info&&(s.info=t.info),t.parent_selectable&&(s.parent_selectable=t.parent_selectable),t.selectable&&(s.selectable=t.selectable)),i._onChannelContent(s,e)})},MSBrowserChannels.prototype._onChannelContent=function(t,e){if(this.browser.hideLoading(),this.browser.moreChannels=[],this.browser.moreLiveStreams=[],this.browser.moreVideos=[],this.browser.morePhotosGroups=[],this.browser.hideMoreBtns("channels"),this.currentChannelOid!=e)return;if(!t.success)return this._onChannelError(t);let s;if(this.lastResponse=t,!this.browser.useOverlay&&this.browser.displayAsThumbnails&&this.browser.boxHideInfo(),this.$menu.html(""),"0"!=e){if(!this.browser.ltiMode||e!=this.personalChannelOid){const e={oid:t.info.parent_oid?t.info.parent_oid:"0",title:t.info.parent_title?t.info.parent_title:jsu.translate("Parent channel"),slug:t.info.parent_slug};let s;if(t.info.parent_oid&&t.info.parent_slug&&this.browser.updateCatalog(e),this.browser.useOverlay?(s=$('<button type="button" class="button '+this.browser.btnClass+' back-button"></button>')).click({obj:this,oid:e.oid},function(t){t.data.obj.displayChannel(t.data.oid)}):s=$('<a class="button '+this.browser.btnClass+' back-button" href="'+this.browser.getButtonLink(e,"view")+'"></a>'),!this.browser.useOverlay&&$(".navbar .back.button-text").length>0?(s.html('<i class="fa fa-chevron-circle-up fa-fw fa-2x" aria-hidden="true"></i>'),s.attr("title",jsu.translate("Parent channel")),s.attr("aria-label",jsu.translate("Parent channel")),s.addClass("back").addClass("button-text"),$(".navbar .back.button-text").replaceWith(s)):(s.html('<i class="fa fa-chevron-circle-up" aria-hidden="true"></i> <span class="hidden-below-800">'+jsu.translateHTML("Parent channel")+"</span>"),this.$menu.append(s)),this.browser.pickMode){const e=this.browser.msapi.getAvailableStorageDisplay(t.info);e&&(this.$menu.append(e+" "),window.uwlb||$(".tooltip-button",this.$menu).click(function(){$("span",this).toggle()}))}}const i=-1!=this.browser.selectableContent.indexOf("c")&&(!this.browser.parentSelectionOid||t.selectable);s=this.browser.getEntryLinks(t.info,"current",i)}else t.oid="0",s=this.browser.getEntryLinks(t,"current",!1),!this.browser.useOverlay&&$(".navbar .back.button-text").length>0&&$(".navbar .back.button-text").attr("href","..");if(s&&this.$menu.append(s),this.$place.html(""),this.browser.useOverlay)this.$place.scrollTop(0);else{if("0"!=e){const e=$('<div class="item-description"></div>');let s=!0,i=t.info.can_edit?this.browser.msapi.getStorageDisplay(t.info):"";if(t.info.views||t.info.comments){let a='<div class="'+(t.info.short_description||this.browser.couldDisplay("rss_links")||i?"right":"align-right")+' channel-description-stats">';this.browser.couldDisplay("views")&&t.info.views&&(a+='<span class="inline-block">'+t.info.views+" "+jsu.translate("views"),t.info.views_last_month&&(a+=", "+t.info.views_last_month+" "+jsu.translate("this month")),a+="</span>"),this.browser.couldDisplay("annotations")&&t.info.comments&&(a+=' <span class="inline-block">'+t.info.comments+" "+jsu.translate("annotations"),t.info.comments_last_month&&(a+=", "+t.info.comments_last_month+" "+jsu.translate("this month")),a+="</span>"),a+="</div>",e.append(a),s=!1}if(this.browser.couldDisplay("description")&&t.info.short_description){const i=$('<div class="channel-description-text">'+t.info.short_description+"</div>");t.info.short_description!=t.info.description&&(i.addClass("short-desc"),i.click({description:t.info.description},function(t){$(this).html(t.data.description).unbind("click").removeClass("short-desc")})),e.append(i),s=!1}if(this.browser.couldDisplay("channel_content")&&t.info.items_count){const i=[];t.info.channels_count&&i.push(t.info.channels_count+" "+jsu.translate("channel(s)")),t.info.videos_count&&i.push(t.info.videos_count+" "+jsu.translate("video(s)")),t.info.lives_count&&i.push(t.info.lives_count+" "+jsu.translate("live stream(s)")),t.info.pgroups_count&&i.push(t.info.pgroups_count+" "+jsu.translate("photos group(s)"));let a='<div class="channel-items-count">'+jsu.translate("Channel content:");a+=" <span>"+jsu.escapeHTML(i.join(", "))+"</span>",a+=' <button type="button" class="tooltip-button no-padding no-border no-background" aria-describedby="id_count_help" aria-label="'+jsu.translateAttribute("help")+'"><i class="fa fa-question-circle fa-fw" aria-hidden="true"></i><span role="tooltip" id="id_count_help" class="tooltip-hidden-content">'+jsu.translateHTML("Sub channels items are included in counts.")+"</span></button>",a+="</div>",e.append(a),window.uwlb||$(".channel-items-count .tooltip-button",e).click(function(){$("span",this).toggle()}),s=!1}if(this.browser.couldDisplay("storage")&&i&&(i='<div class="channel-storage-usage">'+jsu.translate("Storage usage:")+" "+i+"</div>",e.append(i),window.uwlb||$(".channel-storage-usage .tooltip-button",e).click(function(){$("span",this).toggle()}),s=!1),this.browser.couldDisplay("rss_links")){let i='<div class="channel-description-rss"> ';this.displayItunesRss?(i+=' <span class="inline-block">'+jsu.translate("Subscribe to channel videos RSS:")+"</span>",i+=' <a class="nowrap" href="/channels/'+t.info.oid+'/rss.xml">',i+='<i class="fa fa-rss" aria-hidden="true"></i> '+jsu.translate("standard")+"</a>",i+=' <a class="nowrap" href="/channels/'+t.info.oid+'/itunes-video.xml">',i+='<i class="fa fa-apple" aria-hidden="true"></i> '+jsu.translate("iTunes")+"</a>",i+=' <a class="nowrap" href="/channels/'+t.info.oid+'/itunes-audio.xml">',i+='<i class="fa fa-apple" aria-hidden="true"></i> '+jsu.translate("iTunes (audio only)")+"</a>"):(i+=' <a class="nowrap" href="/channels/'+t.info.oid+'/rss.xml">',i+='<i class="fa fa-rss" aria-hidden="true"></i> '+jsu.translate("Subscribe to channel videos RSS")+"</a>"),i+="</div>",e.append(i),s=!1}s||this.$place.append(e)}if($("head .csslistlink").remove(),t.info){let e,s="";for(e in t.info.css_list)s+='<link class="csslistlink" rel="stylesheet" type="text/css" href="'+t.info.css_list[e]+'"/>';$("head").append(s)}t.info&&t.info.logo_url?$("#mainlogo .header-logo").attr("src",t.info.logo_url):$("#mainlogo .header-logo").attr("src",this.defaultLogoSrc),t.info&&t.info.favicon_url?$("#faviconLink").attr("href",t.info.favicon_url):$("#faviconLink").attr("href",this.defaultFavSrc)}const i=t.channels?t.channels.length:0,a=t.videos?t.videos.length:0,n=t.live_streams?t.live_streams.length:0,o=t.photos_groups?t.photos_groups.length:0,r=i>0||a>0||n>0||o>0;if(this.refreshTitle(),r)this.browser.displayContent(this.$place,t,e,"channels");else{let t;t=-1==this.browser.selectableContent.indexOf("c")?jsu.translate("This channel contains no media."):this.browser.displayableContent.length>1?jsu.translate("This channel contains no sub channels and no media."):jsu.translate("This channel contains no sub channels."),t+="<br/>"+jsu.translate("Some contents may still exist in this channel but if it is the case your account is not allowed to see them."),this.$place.append('<div class="messages"><div class="message info">'+t+"</div></div>")}},MSBrowserChannels.prototype.refreshDisplay=function(t){t&&this.lastResponse&&(this.lastResponse=null),this.lastResponse?this._onChannelContent(this.lastResponse,this.currentChannelOid):this.browser.ltiMode?this.displayPersonalChannel():this.displayChannel(this.currentChannelOid)},MSBrowserChannels.prototype.remove=function(t){if(this.currentChannelOid==t){const e=this.browser.catalog[t]&&this.browser.catalog[t].parent_oid?this.browser.catalog[t].parent_oid:"0";!this.browser.pickMode&&this.browser.catalog[e]&&this.browser.catalog[e].slug?window.location.hash="#"+this.browser.catalog[e].slug:this.displayChannel(e)}else this.browser.removeOidFromTab(this,t)},MSBrowser.prototype.buildWidget=function(){let t,e,s;this.lastOverlayFocus=document.activeElement,this.previousFocus=null,"self"==this.filterSpeaker?(t=jsu.translate("My channel"),s=jsu.translate("My media"),e=jsu.translate("Search in my media")):(t=jsu.translate("Channels"),s=jsu.translate("Latest content"),e=jsu.translate("Search"));let i,a,n='<div class="ms-browser ms-browser-container'+(this.useOverlay?" in-overlay":"")+(this.treeManager?" has-tree":"")+(this.displayTypesIcons?" show-types-icons":"")+(this.hideHeader?" no-header":"")+'"><div class="ms-browser-header"><div class="ms-browser-menu">';this.useOverlay?n+='<button type="button" id="ms_browser_channels_tab" class="ms-browser-tab button '+this.btnClass+'" title="'+jsu.escapeAttribute(t)+'" aria-label="'+jsu.escapeAttribute(t)+'"><i class="fa fa-folder-open" aria-hidden="true"></i> <span class="hidden-below-800" aria-hidden="true">'+jsu.escapeHTML(t)+'</span></button><button type="button" id="ms_browser_latest_tab" class="ms-browser-tab button '+this.btnClass+'" title="'+jsu.escapeAttribute(s)+'" aria-label="'+jsu.escapeAttribute(s)+'"><i class="fa fa-clock-o" aria-hidden="true"></i> <span class="hidden-below-800" aria-hidden="true">'+jsu.escapeHTML(s)+'</span></button><button type="button" id="ms_browser_search_tab" class="ms-browser-tab button '+this.btnClass+'" title="'+jsu.escapeAttribute(e)+'" aria-label="'+jsu.escapeAttribute(e)+'"><i class="fa fa-search" aria-hidden="true"></i> <span class="hidden-below-800" aria-hidden="true">'+jsu.escapeHTML(e)+"</span></button>":n+='<a id="ms_browser_channels_tab" class="ms-browser-tab button '+this.btnClass+'" href="'+this.urlChannels+'" title="'+jsu.escapeAttribute(t)+'" aria-label="'+jsu.escapeAttribute(t)+'"><i class="fa fa-folder-open" aria-hidden="true"></i> <span class="hidden-below-800" aria-hidden="true">'+jsu.escapeHTML(t)+'</span></a><a id="ms_browser_latest_tab" class="ms-browser-tab button '+this.btnClass+'" href="'+this.urlLatest+'" title="'+jsu.escapeAttribute(s)+'" aria-label="'+jsu.escapeAttribute(s)+'"><i class="fa fa-clock-o" aria-hidden="true"></i> <span class="hidden-below-800" aria-hidden="true">'+jsu.escapeHTML(s)+'</span></a><a id="ms_browser_search_tab" class="ms-browser-tab button '+this.btnClass+'" href="'+this.urlSearch+'" title="'+jsu.escapeAttribute(e)+'" aria-label="'+jsu.escapeAttribute(e)+'"><i class="fa fa-search" aria-hidden="true"></i> <span class="hidden-below-800" aria-hidden="true">'+jsu.escapeHTML(e)+"</span></a>",n+='</div><h2 class="ms-browser-title"></h2></div><div class="ms-browser-bar"></div><div class="ms-browser-main ms-items"><div class="ms-browser-clear"></div><div class="ms-browser-loading"><div><i class="fa fa-spinner fa-spin" aria-hidden="true"></i> '+jsu.translateHTML("Loading...")+'</div></div><div class="ms-browser-message"><div></div></div></div></div>',this.$widget=$(n),!this.useOverlay&&$("nav .buttons-left").length>0?((a=$("nav .buttons-left")).addClass("ms-browser"),this.hideHeader&&a.addClass("no-header"),a.append(this.getTopMenuJq()),(i=$("#commands_place")).addClass("ms-browser"),this.hideHeader&&i.addClass("no-header"),i.addClass("ms-browser-dropdown-right")):((a=$(".ms-browser-header",this.$widget)).addClass("ms-browser-dropdown-right"),a.prepend(this.getTopMenuJq()),(i=$(".ms-browser-bar",this.$widget)).addClass("ms-browser-dropdown-right")),i.append(this.latest.getMenuJq()),i.append(this.channels.getMenuJq()),i.append(this.search.getMenuJq()),this.$main=$(".ms-browser-main",this.$widget),this.$main.append(this.latest.getContentJq()),this.$main.append(this.channels.getContentJq()),this.$main.append(this.search.getContentJq()),this.$main.append('<div class="ms-browser-clear"></div>'),this.$menu=$(".ms-browser-menu",this.$widget),this.place&&$(this.place).html(this.$widget),$("#ms_browser_channels_tab",this.$menu).click({obj:this},function(t){return t.data.obj.changeTab("channels"),!1}),$("#ms_browser_latest_tab",this.$menu).click({obj:this},function(t){return t.data.obj.changeTab("latest"),!1}),$("#ms_browser_search_tab",this.$menu).click({obj:this},function(t){return t.data.obj.changeTab("search"),!1}),$(".ms-browser-more-btn button",this.$widget).click({obj:this},function(t){t.data.obj.displayMore(t.data.obj.displayCount)})},MSBrowser.prototype.getTopMenuJq=function(){const t=[{default:jsu.translate("Use default sorting")},{"creation_date-desc":jsu.translate("Creation date, descending")},{"creation_date-asc":jsu.translate("Creation date, ascending")},{"add_date-desc":jsu.translate("Add date, descending")},{"add_date-asc":jsu.translate("Add date, ascending")},{"title-desc":jsu.translate("Title, descending")},{"title-asc":jsu.translate("Title, ascending")},{"slug-desc":jsu.translate("Slug, descending")},{"slug-asc":jsu.translate("Slug, ascending")},{"views-desc":jsu.translate("Number of views, descending")},{"views-asc":jsu.translate("Number of views, ascending")}];let e,s='<div class="ms-browser-top-buttons"><div class="ms-browser-dropdown" id="ms_browser_display_dropdown"><button aria-controls="ms_browser_display_dropdow_menu" aria-expanded="false" type="button" title="'+jsu.translateAttribute("Display")+'" class="button ms-browser-dropdown-button '+this.btnClass+'"><i class="fa fa-tv" aria-hidden="true"></i> <span class="hidden-below-1280">'+jsu.translateHTML("Display")+' </span><i class="fa fa-angle-down" aria-hidden="true"></i></button><div class="ms-browser-dropdown-menu" id="ms_browser_display_dropdow_menu"><div><h4>'+jsu.translateHTML("Display mode:")+'</h4><button type="button" class="button '+(this.displayAsThumbnails?"":"active")+'" id="ms_browser_display_as_list" title="'+jsu.translateAttribute("list")+(this.displayAsThumbnails?"":" ("+jsu.translateAttribute("selected setting")+")")+'">'+jsu.translateHTML("list")+'</button><button type="button" class="button '+(this.displayAsThumbnails?"active":"")+'" id="ms_browser_display_as_thumbnails" title="'+jsu.translateAttribute("thumbnails")+(this.displayAsThumbnails?" ("+jsu.translateAttribute("selected setting")+")":"")+'">'+jsu.translateHTML("thumbnails")+'</button><br/><label for="ms_browser_number_item">'+jsu.translateHTML("Number of items:")+'</label><select id="ms_browser_number_item">';for(const t of[10,30,100])s+='<option value="'+t+'"'+(t==this.displayCount?' selected="selected"':"")+">"+t+"</option>";for(e in s+='</select><br/><input id="ms_browser_display_types_icons" type="checkbox" '+(this.displayTypesIcons?'checked="checked"':"")+'> <label for="ms_browser_display_types_icons">'+jsu.translateHTML("display items type icons")+'</label></div><div class="ms-browser-channel-order"><h4><label for="ms_browser_order_channel">'+jsu.translate("Sort by:")+'</label></h4> <select id="ms_browser_order_channel">',t)for(const i in t[e])s+='<option value="'+i+'">'+jsu.escapeHTML(t[e][i])+"</option>";s+="</select></div>";const i='<option value="">'+jsu.translateHTML("unspecified")+'</option><option value="yes">'+jsu.translateHTML("yes")+'</option><option value="no">'+jsu.translateHTML("no")+"</option>";s+='<div class="ms-browser-filters"><h4>'+jsu.translateHTML("Filters:")+'</h4> <form id="ms_browser_filters_form"> <label for="ms_browser_filter_editable">'+jsu.translateHTML("Editable:")+'</label> <select id="ms_browser_filter_editable">'+i+"</select>",(this.displayableContent.length>1||"c"!=this.displayableContent)&&(s+=' <br/> <label for="ms_browser_filter_validated">'+jsu.translateHTML("Published:")+'</label> <select id="ms_browser_filter_validated">'+i+"</select>","self"!=this.filterSpeaker&&(s+=' <br/> <label for="ms_browser_filter_speaker">'+jsu.translateHTML("Speaker:")+'</label> <input type="text" id="ms_browser_filter_speaker" value="'+(this.filterSpeaker?this.filterSpeaker:"")+'"/> <button type="submit" class="button">'+jsu.translateHTML("Ok")+"</button>")),s+=" </form></div></div></div>",s+="</div>",this.$topMenu=$(s);const a=$("#ms_browser_display_dropdown",this.$topMenu);this.setupDropdown(a),$("#ms_browser_display_as_list",a).click({obj:this,$dropdown:a},function(t){t.data.obj.setDisplayAsList()}),$("#ms_browser_display_as_thumbnails",a).click({obj:this,$dropdown:a},function(t){t.data.obj.setDisplayAsThumbnails()}),$("#ms_browser_display_types_icons",a).change({obj:this,$dropdown:a},function(t){t.data.obj.setDisplayTypesIcons(this.checked)}),$("#ms_browser_order_channel",a).change({obj:this,$dropdown:a},function(t){t.data.obj.channels.setOrder($(this).val()),t.data.obj.search.setOrder($(this).val())}),$("#ms_browser_filters_form select",a).change({obj:this,$dropdown:a},function(t){$("#ms_browser_filters_form",t.data.$dropdown).submit()}),$("#ms_browser_filters_form",a).submit({obj:this,$dropdown:a},function(t){return t.data.obj.onFiltersSubmit($(this)),!1}),$("#ms_browser_number_item",a).change({obj:this},function(t){const e=parseInt(this.value,10);e>t.data.obj.displayCount&&t.data.obj.displayMore(e-t.data.obj.displayCount),t.data.obj.displayCount=e,$(".ms-browser-more-btn button").text(t.data.obj.moreLabel.replace(/\{count\}/,t.data.obj.displayCount)),jsu.setCookie("catalog-displayCount",e)});try{this.focusWasInDropdown=!1,window.addEventListener("blur",function(){this.checkFocusDropdown()}.bind(this),!0),window.addEventListener("focus",function(){this.checkFocusDropdown()}.bind(this),!0)}catch(t){console.error("Failed to listen to focus changes: "+t)}return this.$topMenu},MSBrowser.prototype.getMoreButton=function(){return this.moreLabel||(this.moreLabel=jsu.translate("Display {count} more items")),'<div class="ms-browser-more-btn"><button type="button" class="button">'+this.moreLabel.replace(/\{count\}/,this.displayCount)+"</button></div>"},MSBrowser.prototype.setTitle=function(t,e){if(e||(e=t),!this.useOverlay&&$("#global .main-title h1").length>0?($("#global .main-title h1").html(e),$("#global .main-title h1").attr("tabindex","-1"),$("#global .main-title h1").focus()):$(".ms-browser-title",this.$widget).html(e),!this.useOverlay&&document.title){if(!this.documentTilteSuffix){const t=document.title.indexOf(" - ");this.documentTilteSuffix=-1!=t?document.title.substring(t):" - Nudgis"}document.title=t+this.documentTilteSuffix}},MSBrowser.prototype.setupDropdown=function(t){$(".ms-browser-dropdown-button",t).click({$dropdown:t},function(t){const e=$(".ms-browser-dropdown-button",t.data.$dropdown),s=$(".ms-browser-dropdown-menu",t.data.$dropdown);s.attr("tabindex","-1"),e.hasClass("active")?(e.removeClass("active"),e.attr("aria-expanded",!1),s.removeClass("active")):(e.addClass("active"),e.attr("aria-expanded",!0),s.addClass("active"))}),$(document).click({$dropdown:t},function(t){const e=$(".ms-browser-dropdown-button",t.data.$dropdown),s=$(".ms-browser-dropdown-menu",t.data.$dropdown);!e.hasClass("active")||s.is(t.target)||0!==s.has(t.target).length||e.is(t.target)||0!==e.has(t.target).length||(e.removeClass("active"),e.attr("aria-expanded",!1),s.removeClass("active"))})},MSBrowser.prototype.closeDropdown=function(t){const e=$(".ms-browser-dropdown-button",t),s=$(".ms-browser-dropdown-menu",t);e.hasClass("active")&&(e.removeClass("active"),e.attr("aria-expanded",!1),s.removeClass("active"))},MSBrowser.prototype.checkFocusDropdown=function(){if(!document.activeElement||document.activeElement==document.body)return;let t=!1,e=document.activeElement;for(;e;){if(e.className&&-1!=e.className.indexOf("ms-browser-dropdown-menu")){t=!0,this.focusWasInDropdown=!0;break}e=e.parentNode}!t&&this.focusWasInDropdown&&(this.focusWasInDropdown=!1,$(".ms-browser-dropdown-button.active").removeClass("active").attr("aria-expanded",!1),$(".ms-browser-dropdown-menu.active").removeClass("active"))},MSBrowser.prototype.onFiltersSubmit=function(t){const e=[{type:"choice",id:"ms_browser_filter_editable",name:"filterEditable"},{type:"choice",id:"ms_browser_filter_validated",name:"filterValidated"}];"self"!=this.filterSpeaker&&e.push({type:"text",id:"ms_browser_filter_speaker",name:"filterSpeaker"});let s=!1;for(let i=0;i<e.length;i++){const a=$("#"+e[i].id,t);if(a.length>0){let t=a.val();if("choice"==e[i].type)switch(t){case"yes":t=!0;break;case"no":t=!1;break;default:t=null}else t||(t=null);this[e[i].name]!==t&&(this[e[i].name]=t,s=!0)}}s&&(this.channels.refreshDisplay(!0),this.latest.refreshDisplay(!0),this.search.refreshDisplay(!0))},MSBrowser.prototype.setDisplayAsList=function(){const t=$("#ms_browser_display_as_thumbnails",this.$topMenu),e=$("#ms_browser_display_as_list",this.$topMenu);e.hasClass("active")||(this.displayAsThumbnails=!1,t.removeClass("active").attr("title",t.text()),e.addClass("active").attr("title",e.text()+" ("+jsu.translate("selected setting")+")"),this.useOverlay||$("#global").addClass("max-width-1200"),jsu.setCookie("catalog-displayMode","list"),this.channels.refreshDisplay(),this.latest.refreshDisplay(),this.search.refreshDisplay())},MSBrowser.prototype.setDisplayAsThumbnails=function(){const t=$("#ms_browser_display_as_thumbnails",this.$topMenu),e=$("#ms_browser_display_as_list",this.$topMenu);t.hasClass("active")||(this.displayAsThumbnails=!0,e.removeClass("active").attr("title",e.text()),t.addClass("active").attr("title",t.text()+" ("+jsu.translate("selected setting")+")"),this.useOverlay||$("#global").removeClass("max-width-1200"),jsu.setCookie("catalog-displayMode","thumbnail"),this.channels.refreshDisplay(),this.latest.refreshDisplay(),this.search.refreshDisplay())},MSBrowser.prototype.setDisplayTypesIcons=function(t){this.displayTypesIcons=t,t?this.$widget.addClass("show-types-icons"):this.$widget.removeClass("show-types-icons"),jsu.setCookie("catalog-displayTypesIcons",t?"yes":"no")},MSBrowser.prototype.getActiveTab=function(){const t=$(".ms-browser-tab.active",this.$menu);let e=t.length>0?t.attr("id").replace(/_tab/g,"").replace(/ms_browser_/g,""):null;return e||this.pickMode||($(".ms-browser").hasClass("channels")?e="channels":$(".ms-browser").hasClass("latest")?e="latest":$(".ms-browser").hasClass("search")&&(e="search")),e},MSBrowser.prototype.changeTab=function(t,e){const s=this.getActiveTab();if(s!=t&&(s&&this[s]&&($(".ms-browser").removeClass(s),$("#ms_browser_"+s+"_tab",this.$menu).removeClass("active").attr("title",$("#ms_browser_"+s+"_tab",this.$menu).text()),this[s].$menu.css("display","none"),this[s].$content.css("display","none")),$(".ms-browser").addClass(t),$("#ms_browser_"+t+"_tab",this.$menu).addClass("active").attr("title",$("#ms_browser_"+t+"_tab",this.$menu).text()+" ("+jsu.translate("selected tab")+")"),this[t]&&(this[t].$menu.css("display",""),this[t].$content.css("display",""),this[t].onShow()),"latest"!=t?$(".ms-browser-channel-order",this.$topMenu).css("display",""):$(".ms-browser-channel-order",this.$topMenu).css("display","none"),!this.useOverlay&&!e)){let e;e="search"==t?this.urlSearch:"latest"==t?this.urlLatest:this.urlChannels+window.location.hash,window.history.pushState({ms_tab:t},t,e)}},MSBrowser.prototype.displayLoading=function(){if(isNaN(this.loadingCount)?this.loadingCount=1:this.loadingCount++,this.loadingTimeout)return;const t=this;this.loadingTimeout=setTimeout(function(){$(".ms-browser-loading",t.$widget).css("display","block"),t.loadingTimeout=null},500)},MSBrowser.prototype.hideLoading=function(){this.loadingCount&&this.loadingCount--,isNaN(this.loadingCount)||this.loadingCount>0||(this.loadingTimeout&&(clearTimeout(this.loadingTimeout),this.loadingTimeout=null),$(".ms-browser-loading",this.$widget).css("display",""))},MSBrowser.prototype.displayContent=function(t,e,s,i,a){if(a||(a=this.displayCount),e.channels&&e.channels.length>0){let n=[];a>0?(n=e.channels.slice(0,a),this.moreChannels=e.channels.slice(a),a-=n.length):this.moreChannels=e.channels,n.length>0&&this.displayItems(t,n,"channel",i,s)}if(e.live_streams&&e.live_streams.length>0){let s=[];a>0?(s=e.live_streams.slice(0,a),this.moreLiveStreams=e.live_streams.slice(a),a-=s.length):this.moreLiveStreams=e.live_streams,s.length>0&&this.displayItems(t,s,"live",i)}if(e.videos&&e.videos.length>0){let s=[];a>0?(s=e.videos.slice(0,a),this.moreVideos=e.videos.slice(a),a-=s.length):this.moreVideos=e.videos,s.length>0&&this.displayItems(t,s,"video",i)}if(e.photos_groups&&e.photos_groups.length>0){let s=[];a>0?(s=e.photos_groups.slice(0,a),this.morePhotosGroups=e.photos_groups.slice(a),a-=s.length):this.morePhotosGroups=e.photos_groups,s.length>0&&this.displayItems(t,s,"photos",i)}this.moreChannels.length+this.moreLiveStreams.length+this.moreVideos.length+this.morePhotosGroups.length>0?this.showMoreBtns(i):this.hideMoreBtns(i)},MSBrowser.prototype.displayItems=function(t,e,s,i,a){const n=this.pickMode?"h3":"h2",o=-1!=this.selectableContent.indexOf(s[0]);let r="";switch(s){case"channel":r=jsu.translate("Channels"),a&&"0"!=a&&(r=jsu.translate("Sub channels"));break;case"live":r=jsu.translate("Live streams");break;case"video":r=jsu.translate("Videos");break;case"photos":r=jsu.translate("Photos groups")}$("#header_type_"+s,t).length||t.append("<"+n+' id="header_type_'+s+'">'+r+"</"+n+">");let l=$("#section_type_"+s,t);l.length||(l=$('<ul id="section_type_'+s+'" class="ms-browser-section"></ul>'));for(let t=0;t<e.length;t++)"channels"==s&&void 0===e[t].parent_oid&&a&&(e[t].parent_oid=a),l.append(this.getContentEntry(s,e[t],o,i));t.append(l)},MSBrowser.prototype.showMoreBtns=function(t){$("#ms_browser_"+t+" .ms-browser-more-btn",this.place).css("display","block")},MSBrowser.prototype.hideMoreBtns=function(t){$("#ms_browser_"+t+" .ms-browser-more-btn",this.place).css("display","none")},MSBrowser.prototype.displayMore=function(t){const e=this.getActiveTab(),s={channels:this.moreChannels,live_streams:this.moreLiveStreams,videos:this.moreVideos,photos_groups:this.morePhotosGroups};"latest"===e?this.latest.displayMore(t):"channels"===e?this.displayContent(this.channels.$place,s,null,"channels",t):"search"===e&&this.displayContent(this.search.$content,s,null,"search",t)},MSBrowser.prototype.getContentEntry=function(t,e,s,i){this.updateCatalog(e);const a=e.oid,n=s&&(!this.parentSelectionOid||e.selectable),o=this.pickMode&&(n||"channel"==t);let r=null;(r=$('<li class="item-entry item-type-'+t+" item-entry-"+a+'"></li>')).attr("id","item_entry_"+a+"_"+i),r.addClass(this.displayAsThumbnails?"thumbnail":"list"),this.currentSelection&&this.currentSelection.oid==a&&(r.addClass("selected"),r.attr("title",e.title+" "+jsu.translate("selected"))),n&&r.addClass("selectable"),o&&r.addClass("clickable"),e.extra_class&&r.addClass(e.extra_class);let l=this._getEntryBlockHtml(e,t,o,i);this.displayAsThumbnails&&!this.pickMode&&(l+='<div class="item-entry-buttons">',l+='<button type="button" class="item-entry-info" title="'+jsu.translateAttribute("Open information panel")+'"><i class="fa fa-info" aria-hidden="true"></i></button>',e.can_edit&&(l+='<a title="'+jsu.translateAttribute("Edit")+'" href="'+this.getButtonLink(e,"edit")+'"'+this.linksTarget+'><i class="fa fa-pencil" aria-hidden="true"></i></a>'),l+='<div class="overlay-info ms-items" id="item_entry_'+a+"_"+i+'_info" style="display: none;" role="dialog" tabindex="-1" aria-labelledby="item_entry_'+e.oid+"_"+i+'_info_title" aria-modal="true"></div>',l+="</div>");const h=$(l);if(this._setOnClickEntryBlock(h,a,t,e,n),r.append(h),this.displayAsThumbnails)this._setThumbnailInfoBoxHtml(t,n,a,r,e,i);else{const s=this.getEntryLinks(e,t,n);s&&r.append(s)}return $(".item-entry-link",r).focus(function(){$(".item-entry").removeClass("focus"),$(this).parent().addClass("focus")}),r},MSBrowser.prototype.couldDisplay=function(t){return-1!==this.catalogFieldsToDisplay.indexOf(t)},MSBrowser.prototype._cleanSpeakers=function(t){const e=[];for(let s of t.split(","))(s=s.trim())&&e.push(s);return e.join(", ")},MSBrowser.prototype._getEntryBlockHtml=function(t,e,s,i){let a="span",n="",o=' tabindex="0" role="button"';this.useOverlay||!t.slug||this.pickMode&&"channel"!=e||(a="a",o="",n=' href="'+this.getButtonLink(t,"view")+'"',"channel"!=e&&(n+=this.linksTarget));let r="<"+a+n+o+' class="item-entry-link"'+(s&&"channel"!=e?' title="'+jsu.translateAttribute("Click to select this media")+'"':"")+">",l='<span class="item-entry-preview">';l+='<span class="item-entry-preview-aligner"></span>',t.thumb&&(l+='<img src="'+jsu.escapeAttribute(t.thumb)+'" alt=""'+(t.language?' lang="'+jsu.escapeAttribute(t.language)+'"':"")+"/>"),this.pickMode||"channel"==e||(l+='<b class="item-entry-preview-play"><i class="fa fa-play fa-4x" aria-hidden="true"></i></b>'),r+=l+="</span>";let h='<span class="item-entry-content">',c='<span class="item-entry-top-bar">';if("channel"==e)c+='<span class="item-entry-layout layout-channel" title="'+jsu.translateAttribute("This item is a channel")+'"></span>';else if("photos"==e)c+='<span class="item-entry-layout layout-pgroup" title="'+jsu.translateAttribute("This item is a photos group")+'"></span>';else{c+='<span class="item-entry-layout ',t.layout?c+="layout-"+jsu.escapeAttribute(t.layout):c+="layout-video",c+='" title="';let s="live"==e?jsu.translateHTML("This item is a live stream"):jsu.translateHTML("This item is a video");t.layout&&("composition"==t.layout?s+=" ("+jsu.translateHTML("dynamic Rich Media")+")":"webinar"==t.layout?s+=" ("+jsu.translateHTML("classic Rich Media")+")":s+=" ("+jsu.escapeHTML(t.layout.replace(/_/," "))+")"),c+=s,c+='"><span class="sr-only">'+s+"</span></span>"}if(t.can_edit&&("channel"==e?t.unlisted&&(c+='<span class="item-entry-unlisted" title="'+jsu.translateAttribute("This channel is unlisted")+'"><span class="sr-only">'+jsu.translateHTML("This channel is unlisted")+"</span></span>"):(t.validated?t.unlisted?c+='<span class="item-entry-unlisted" title="'+jsu.translateAttribute("This media is published and unlisted")+'"><span class="sr-only">'+jsu.translateHTML("This media is published and unlisted")+"</span></span>":c+='<span class="item-entry-published" title="'+jsu.translateAttribute("This media is published")+'"><span class="sr-only">'+jsu.translateHTML("This media is published")+"</span></span>":c+='<span class="item-entry-notpublished" title="'+jsu.translateAttribute("This media is not published")+'"><span class="sr-only">'+jsu.translateHTML("This media is not published")+"</span></span>","video"!=e||t.ready||(c+='<span class="item-entry-notready" title="'+jsu.translateAttribute("This video is not ready")+'"><span class="sr-only">'+jsu.translateHTML("This video is not ready")+"</span></span>"),"live"==e&&"ongoing"==t.status&&(c+='<span class="item-entry-live-running" title="'+jsu.translateAttribute("This live is running")+'"><span class="sr-only">'+jsu.translateHTML("This live is running")+"</span></span>"))),this.couldDisplay("duration")&&t.duration&&(c+='<span class="item-entry-duration">'+jsu.escapeHTML(t.duration)+"</span>"),this.couldDisplay("language")&&t.language){c+='<span class="item-entry-language">'+this.getLangHTML(t)+"</span>"}this.displayAsThumbnails||(c+='<span class="item-entry-title"'+(t.language?' lang="'+jsu.escapeAttribute(t.language)+'"':"")+">"+jsu.escapeHTML(t.title)+"</span>"),h+=c+="</span>";let d='<span class="item-entry-bottom-bar">';if(this.displayAsThumbnails)d+='<span class="item-entry-title"'+(t.language?' lang="'+jsu.escapeAttribute(t.language)+'"':"")+">"+jsu.escapeHTML(t.title)+"</span>";else{if(this.couldDisplay("creation_date")&&t.creation&&(d+='<span class="item-entry-date">'+jsu.translateHTML("Created on")+" "+jsu.getDateDisplay(t.creation)+"</span>"),this.couldDisplay("description")&&t.short_description&&(d+='<span class="item-entry-description">'+jsu.escapeHTML($("<span>"+t.short_description+"</span>").text())+"</span>"),this.couldDisplay("license")&&t.license&&(d+='<span class="item-entry-license">'+jsu.translateHTML("License:")+" "+jsu.escapeHTML(t.license)+"</span>"),this.couldDisplay("speaker")&&t.speaker&&(d+='<span class="item-entry-speaker">'+jsu.translateHTML("Speaker:")+" "+jsu.escapeHTML(this._cleanSpeakers(t.speaker))+"</span>"),this.couldDisplay("company")&&t.company&&(d+='<span class="item-entry-company">'+jsu.translateHTML("Company:")+" "+jsu.escapeHTML(t.company)+"</span>"),this.couldDisplay("views")&&t.views&&(d+='<span class="item-entry-views">'+t.views+" "+jsu.translate("views"),t.views_last_month&&(d+=", "+t.views_last_month+" "+jsu.translate("this month")),d+="</span>"),this.couldDisplay("storage")&&t.can_edit&&null!==t.storage_used&&void 0!==t.storage_used){const e=this.msapi.getStorageMinimalDisplay(t);e&&(d+='<span class="item-entry-storage">'+jsu.translate("Storage usage:")+" "+e+"</span>")}"latest"==i&&(this.couldDisplay("type")&&(d+='<span class="item-entry-type">'+jsu.translateHTML("Type:")+" "+jsu.translateHTML(e)+"</span>"),this.couldDisplay("add_date")&&t.add_date&&(d+='<span class="item-entry-date">'+jsu.translateHTML("Added on")+" "+jsu.getDateDisplay(t.add_date)+"</span>"),this.couldDisplay("parent")&&t.parent_title&&(d+='<span class="item-entry-parent">'+jsu.translateHTML("Parent channel:")+" "+jsu.escapeHTML(t.parent_title)+"</span>"))}if(h+=d+="</span>",r+=h+="</span>",r+="</"+a+">",!this.displayAsThumbnails&&!this.pickMode&&"search"==i&&(t.annotations||t.photos)){let e;if(r+='<span class="item-entry-extra">',t.annotations){for(r+="<span>"+jsu.translateHTML("Matching annotations:")+"</span><ul>",e=0;e<t.annotations.length;e++){const s=t.annotations[e];r+='<li><a href="'+this.getButtonLink(t,"view")+"#start="+s.time+'&autoplay"'+this.linksTarget+">",s.title&&(r+=jsu.escapeHTML(s.title)),r+=" ("+jsu.escapeHTML(s.time_display)+") ",r+="</a></li>"}r+="</ul>"}if(t.photos){for(r+="<span>"+jsu.translateHTML("Matching photos:")+"</span><ul>",e=0;e<t.photos.length;e++){const s=t.photos[e];r+='<li><a href="'+this.getButtonLink(t,"view")+"#"+s.index+'"'+this.linksTarget+">",s.title&&(r+=jsu.escapeHTML(s.title)),r+=" (#"+s.index+") ",r+="</a></li>"}r+="</ul>"}r+="</span>"}return r},MSBrowser.prototype.getLangHTML=function(t){if(t.language)return t.icon_lang?'<i aria-hidden="true" class="icon-lang '+t.icon_lang+'"></i>':'<i class="text-lang" aria-hidden="true">['+t.language+"]</i>"},MSBrowser.prototype._setOnClickEntryBlock=function(t,e,s,i,a){this.pickMode?("channel"==s||"parent"==s?t.click({obj:this,oid:e},function(t){t.data.obj.channels.displayChannel(t.data.oid),t.data.obj.changeTab("channels"),jsu.focusFirstDescendant($("#ms_browser_channels .ms-browser-channels-place")[0])}):a&&t.click({obj:this,oid:e},function(t){t.data.obj.pick(t.data.oid)}),t.keydown(function(t){"32"!=t.which&&"13"!=t.which||(t.preventDefault(),t.stopPropagation(),$(this).trigger("click"))})):i.can_delete&&$(".item-entry-pick-delete-media",t).click({obj:this,oid:e},function(t){t.data.obj.pick(t.data.oid,"delete")})},MSBrowser.prototype.getEntryLinks=function(t,e,s){let i="";if(this.pickMode){if(s){const s=this.currentSelection&&this.currentSelection.oid==t.oid,a=s?"fa-check-circle":"fa-check";let n;n="channel"==e||"current"==e?s?jsu.translate("This channel is selected"):jsu.translate("Select this channel"):s?jsu.translate("This media is selected"):jsu.translate("Select this media"),i+='<button type="button" class="'+this.btnClass+' button main item-entry-pick"><i class="fa '+a+'" aria-hidden="true"></i> <span class="hidden-below-800">'+jsu.escapeHTML(n)+"</span></button>"}}else if("current"==e){if(t.can_see_stats&&(i+='<button type="button" title="'+jsu.translateAttribute("Statistics")+'" class="'+this.btnClass+' button default item-entry-pick-stats-media"><i class="fa fa-bar-chart" aria-hidden="true"></i> <span class="hidden-below-1280">'+jsu.translateHTML("Statistics")+"</span></button>"),t.can_edit&&(i+='<a title="'+jsu.translateAttribute("Edit")+'" class="'+this.btnClass+' button default item-entry-pick item-entry-pick-edit-media" href="'+this.getButtonLink(t,"edit")+'"'+this.linksTarget+'><i class="fa fa-pencil" aria-hidden="true"></i> <span class="hidden-below-800">'+jsu.translateHTML("Edit")+"</span></a>",t.can_delete&&(i+='<button type="button" title="'+jsu.translateAttribute("Delete")+'" class="'+this.btnClass+' button danger item-entry-pick-delete-media"><i class="fa fa-trash" aria-hidden="true"></i> <span class="hidden-below-800">'+jsu.translateHTML("Delete")+"</span></button>")),t.can_add_channel){const e='<i class="fa fa-folder" aria-hidden="true"></i> <i class="fa fa-plus color-green" aria-hidden="true"></i>';i+='<a title="'+jsu.translateAttribute("Add a sub channel")+'" class="'+this.btnClass+' button item-entry-pick item-entry-pick-add-channel" href="'+this.getButtonLink(t,"addChannel")+'"'+this.linksTarget+">"+e+' <span class="hidden-below-800">'+jsu.translateHTML("Add a sub channel")+"</span></a>"}if("0"!=t.oid&&t.can_add_video){const e='<i class="fa fa-film" aria-hidden="true"></i> <i class="fa fa-plus color-green" aria-hidden="true"></i>';i+='<a title="'+jsu.translateAttribute("Add a video")+'" class="'+this.btnClass+' button item-entry-pick item-entry-pick-add-video" href="'+this.getButtonLink(t,"addVideo")+'"'+this.linksTarget+">"+e+' <span class="hidden-below-800">'+jsu.translateHTML("Add a video")+"</span></a>"}}else"channel"!=e&&this.ltiMode&&(i+='<button type="button" class="'+this.btnClass+' button default item-entry-copy" data-link="'+this.getButtonLink(t,"lti",!0)+'"><i class="fa fa-chain" aria-hidden="true"></i> <span class="hidden-below-440">'+jsu.translateHTML("Copy LTI link")+"</span></button>"),("channel"!=e&&this.ltiMode||t.can_edit||t.can_delete)&&(i+='<a class="'+this.btnClass+' button default item-entry-pick-view-media" href="'+this.getButtonLink(t,"view")+'"'+this.linksTarget+'><i class="fa fa-eye" aria-hidden="true"></i> <span class="hidden-below-440">'+jsu.translateHTML("See")+"</span></a>"),t.can_edit&&(i+='<a class="'+this.btnClass+' button item-entry-pick-edit-media default" href="'+this.getButtonLink(t,"edit")+'"'+this.linksTarget+'><i class="fa fa-pencil" aria-hidden="true"></i> <span class="hidden-below-440">'+jsu.translateHTML("Edit")+"</span></a>"),t.can_delete&&(i+='<button type="button" class="'+this.btnClass+' button item-entry-pick-delete-media danger"><i class="fa fa-trash" aria-hidden="true"></i> <span class="hidden-below-440">'+jsu.translateHTML("Delete")+"</span></button>");if(!i)return null;i='<span class="item-entry-links"><span class="item-entry-links-container">'+i+"</span></span>";const a=$(i);return"channel"!=e&&"parent"!=e||$(".item-entry-display",a).click({obj:this,item:t},function(t){t.data.obj.pickMode&&t.data.obj.channels.displayChannel(t.data.item.oid)}),s&&$(".item-entry-pick",a).click({obj:this,item:t},function(t){t.data.obj.pick(t.data.item.oid)}),!this.pickMode&&"current"==e&&t.can_see_stats&&$(".item-entry-pick-stats-media",a).click({obj:this,item:t},function(t){t.data.obj.openStatistics(t.data.item.oid)}),!this.pickMode&&t.can_delete&&$(".item-entry-pick-delete-media",a).click({obj:this,item:t},function(t){t.data.obj.pick(t.data.item.oid,"delete")}),$(".item-entry-copy",a).length>0&&$(".item-entry-copy",a).click(function(){const t=$(this),e=t.attr("data-link"),s=$('<input type="text" style="position: absolute; left: -10000px; top: 0;"/>').val(e);let i,a;$("body").append(s),s.select();try{a=(i=document.execCommand("copy"))?jsu.translate("copied"):jsu.translate("cannot copy")}catch(t){i=!1,a=jsu.translate("failed to copy"),console.error("Failed to copy to clipboard: "+t)}a='<i class="fa '+(i?"fa-check":"fa-warning")+'" aria-hidden="true"></i> '+jsu.escapeHTML(a),t.append('<span class="copy-msg">'+a+"</span>"),t.addClass("copied"),setTimeout(function(){t.removeClass("copied"),$(".copy-msg",t).remove()},1e3),s.remove()}),a},MSBrowser.prototype.getButtonLink=function(t,e,s){let i="",a="",n="";if(t&&t.oid&&(n=t.oid[0]),e||n&&""!==n&&"0"!==n||t&&"0"!=t.oid)if("view"==e)t.slug||"0"==t.oid||this.getInfoForOid(t.oid,!1,function(e){t=e.info}),"0"==n?(i="/channels/",a="#"):"c"==n?(i="/channels/",a="#"+t.slug):("l"==n?i="/lives/"+t.slug+"/":"v"==n?i="/videos/"+t.slug+"/":"p"==n&&(i="/photos/"+t.slug+"/"),i&&this.iframeMode&&(i+="iframe/"));else if("lti"==e)i="/lti/"+t.oid+"/";else if("edit"==e)i=this.iframeMode?"/edit/iframe/"+t.oid+"/":"/edit/"+t.oid+"/";else if("addChannel"==e)i="/add-content/channel/?in="+(t&&"0"!=t.oid?t.oid:"root");else{if("addVideo"!=e)return console.error("Unrecognized action specified in MSBrowser.prototype.getButtonLink call:",t,e,s),"";i="/add-content/",a="#add_media_by_upload",t&&"0"!=t.oid&&(i+="?in="+t.oid)}else i="/channels/",a="#";return s&&(i=window.location.protocol+"//"+window.location.host+i),this.linksUrlParams&&"lti"!=e&&(i+=(i.indexOf("?")<0?"?":"&")+this.linksUrlParams),i+a},MSBrowser.prototype._getThumbnailInfoBoxHtml=function(t,e,s,i){let a='<div><div tabindex="0"></div>';if(a+='<div class="trap-focus">',a+='<div class="overlay-info-title" id="item_entry_'+t.oid+"_"+i+'_info_title" >',a+='<button type="button" class="overlay-info-close button default '+this.btnClass+'" title="'+jsu.translateAttribute("Hide this window")+'" aria-label="'+jsu.translateAttribute("Hide this window")+'"><i class="fa fa-close" aria-hidden="true"></i></button>',a+='<h1><a href="'+this.getButtonLink(t,"view")+'"'+this.linksTarget+">"+jsu.escapeHTML(t.title)+"</a></h1>",a+="</div>",a+='<div class="overlay-info-content">',!this.pickMode&&"search"==i&&(t.annotations||t.photos)){if(t.annotations){a+="<div><b>"+jsu.translateHTML("Matching annotations:")+"</b></div>",a+="<ul>";for(let e=0;e<t.annotations.length;e++){const s=t.annotations[e];a+='<li><a href="'+this.getButtonLink(t,"view")+"#start="+s.time+'&autoplay"'+this.linksTarget+">",s.title&&(a+=jsu.escapeHTML(s.title)),a+=" ("+jsu.escapeHTML(s.time_display)+") ",a+="</a></li>"}a+="</ul>"}if(t.photos){a+="<div><b>"+jsu.translate("Matching photos:")+"</b></div>",a+="<ul>";for(let e=0;e<t.photos.length;e++){const s=t.photos[e];a+='<li><a href="'+this.getButtonLink(t,"view")+"#"+s.index+'"'+this.linksTarget+">",s.title&&(a+=jsu.escapeHTML(s.title)),a+=" (#"+s.index+") ",a+="</a></li>"}a+="</ul>"}a+="<hr/>"}if(a+='<table class="overlay-info-table">',a+='<caption class="sr-only">'+jsu.translateHTML("Media information")+"</caption>",this.couldDisplay("creation_date")&&t.creation&&"video"==e&&(a+="<tr>",a+='<th scope="row" class="overlay-info-label">'+jsu.translateHTML("Recording date")+" :</th>",a+="<td>"+jsu.getDateDisplay(t.creation)+"</td>",a+="</tr>"),this.couldDisplay("add_date")&&t.add_date&&(a+="<tr>",a+='<th scope="row" class="overlay-info-label">'+jsu.translateHTML("Publishing date")+" :</th>",a+="<td>"+jsu.getDateDisplay(t.add_date)+"</td>",a+="</tr>"),this.couldDisplay("duration")&&t.duration&&(a+="<tr>",a+='<th scope="row" class="overlay-info-label">'+jsu.translateHTML("Duration")+" :</th>",a+="<td>"+jsu.escapeHTML(t.duration)+"</td>",a+="</tr>"),this.couldDisplay("views")&&t.views_last_month&&(a+='<tr><th scope="row" class="overlay-info-label">'+jsu.translateHTML("Views last month")+" :</th><td>"+t.views_last_month+"</td></tr>"),this.couldDisplay("views")&&t.views&&(a+='<tr><th scope="row" class="overlay-info-label">'+jsu.translateHTML("Views")+" :</th><td>"+t.views+"</td></tr>"),this.couldDisplay("annotations")&&t.comments_last_month&&(a+='<tr><th scope="row" class="overlay-info-label">'+jsu.translateHTML("Annotations last month")+" :</th><td>"+t.comments_last_month+"</td></tr>"),this.couldDisplay("annotations")&&t.comments&&(a+='<tr><th scope="row" class="overlay-info-label">'+jsu.translateHTML("Annotations")+" :</th><td>"+t.comments+"</td></tr>"),this.couldDisplay("storage")&&t.can_edit&&null!==t.storage_used&&void 0!==t.storage_used){const e=this.msapi.getStorageMinimalDisplay(t);e&&(a+='<tr><th scope="row" class="overlay-info-label">'+jsu.translateHTML("Storage usage")+" :</th><td>"+e+"</td></tr>")}this.couldDisplay("license")&&t.license&&(a+='<tr><th scope="row" class="overlay-info-label">'+jsu.translateHTML("License")+" :</th><td>"+jsu.escapeHTML(t.license)+"</td></tr>"),this.couldDisplay("speaker")&&t.speaker&&(a+='<tr><th scope="row" class="overlay-info-label">'+jsu.translateHTML("Speaker")+" :</th><td>"+jsu.escapeHTML(t.speaker)+"</td></tr>"),this.couldDisplay("company")&&t.company&&(a+='<tr><th scope="row" class="overlay-info-label">'+jsu.translateHTML("Company")+" :</th><td>"+jsu.escapeHTML(t.company)+"</td></tr>"),a+="</table>",this.couldDisplay("description")&&t.short_description&&(a+="<hr/>",a+="<p>"+jsu.escapeHTML($("<span>"+t.short_description+"</span>").text())+"</p>"),a+="</div>",a+="</div>",a+='<div tabindex="0"></div></div>';const n=$(a),o=this.getEntryLinks(t,e,s);return o&&$(".overlay-info-content",n).append(o),$(".overlay-info-close",n).click({obj:this},function(t){t.data.obj.boxHideInfo()}),$(document).keydown({obj:this},function(e){$("#item_entry_"+t.oid+"_"+i+"_info").length&&27==e.keyCode&&(e.stopImmediatePropagation(),e.data.obj.boxHideInfo())}),n},MSBrowser.prototype._setThumbnailInfoBoxHtml=function(t,e,s,i,a,n){$(".item-entry-info",i).click({obj:this,$entry:i},function(o){const r="#"+i.attr("id")+"_info";if(o.data.obj.previousFocus=this,""===$(r,o.data.$entry).html())if("search"==n){const s=o.data.obj._getThumbnailInfoBoxHtml(a,t,e,n);$(r,o.data.$entry).append(s),o.data.obj.boxOpenInfo(i)}else o.data.obj.getInfoForOid(s,!0,function(s){const a=s.info;o.data.obj.updateCatalog(s.info);const l=o.data.obj._getThumbnailInfoBoxHtml(a,t,e,n);$(r,o.data.$entry).append(l),o.data.obj.boxOpenInfo(i)});else o.data.obj.boxOpenInfo(i)})},MSBrowser.prototype.trapFocus=function(t,e){jsu.ignoreUntilFocusChanges||(t.contains(e.target)?this.lastOverlayFocus=e.target:(jsu.focusFirstDescendant(t),this.lastOverlayFocus==document.activeElement&&jsu.focusLastDescendant(t),this.lastOverlayFocus=document.activeElement))},MSBrowser.prototype.boxOpenInfo=function(t){this.boxHideInfo();const e="#"+t.attr("id")+"_info",s=$(e);if(s.hasClass("moved")||s.addClass("moved").detach().appendTo("body"),!s.is(":visible")){const i=$(".item-entry-preview",t),a=parseInt(i.offset().top,10)-1;let n=parseInt(i.offset().left,10)+i.width(),o="auto";$(window).width()/2-n<0&&(n="auto",o=$(window).width()-parseInt(i.offset().left,10)),s.css("left",n+"px"),s.css("right",o+"px"),s.css("top",a+"px"),$(".item-entry-info",t).addClass("info-displayed"),s.fadeIn("fast"),this.lastOverlayFocus=document.activeElement,s.focusin(this.trapFocus.bind(this,$(".trap-focus",s)[0])),jsu.focusFirstDescendant($(".trap-focus",s)[0]),this.boxClickHandler&&$(document).unbind("click",this.boxClickHandler);const r=this;this.boxClickHandler=function(t){$(t.target).closest(e).length||$(t.target).closest(".item-entry-info").length||!$(e).is(":visible")||r.boxHideInfo()},$(document).click(this.boxClickHandler)}},MSBrowser.prototype.boxHideInfo=function(){$(".overlay-info:visible").length&&($(".overlay-info:visible").off("focusin"),this.lastOverlayFocus=document.activeElement,$(".overlay-info:visible").fadeOut("fast"),$(".item-entry-info.info-displayed").removeClass("info-displayed"),this.previousFocus&&this.previousFocus.focus())},MSBrowser.prototype.displayCategories=function(){const t=this;if(this.siteSettingsCategories.length>0){let e=' <button type="button" id="open_hidden_categories" class="button">'+jsu.translate("Categories")+' <i class="fa fa-angle-down" aria-hidden="true"></i></button>';e+=' <div id="hidden_categories" class="hidden-visibility">',e+=' <label for="filter_no_categories"><input id="filter_no_categories" type="checkbox"/><span>'+jsu.translateHTML("Unspecified")+"</span></label><br />";for(let t=0;t<this.siteSettingsCategories.length;t++){const s=jsu.escapeAttribute(this.siteSettingsCategories[t][0]),i=jsu.escapeHTML(this.siteSettingsCategories[t][1]),a=this.filterCategories.indexOf(s)<0?"":' checked="checked"';e+=' <label for="'+s+'"><input class="checkbox" id="'+jsu.escapeAttribute(s)+'" type="checkbox" value="'+jsu.escapeAttribute(s)+'"'+a+"/><span>"+jsu.escapeHTML(i)+"</span></label>"}e+=" </div>",$(".ms-browser-filters",this.$topMenu).append(e),$("#open_hidden_categories",this.$topMenu).click(function(){$("#hidden_categories").hasClass("hidden-visibility")?($(".fa",this).removeClass("fa-angle-down").addClass("fa-angle-up"),$("#hidden_categories").removeClass("hidden-visibility")):($("#hidden_categories").addClass("hidden-visibility"),$(".fa",this).removeClass("fa-angle-up").addClass("fa-angle-down"))}),$("#hidden_categories .checkbox",this.$topMenu).click(function(){const e=this.checked;t.filterNoCategories=!1,$("#filter_no_categories",t.$topMenu).prop("checked",!1),e?t.filterCategories.push(this.value):t.filterCategories.splice(t.filterCategories.indexOf(this.value),1),t.channels.refreshDisplay(!0),t.latest.refreshDisplay(!0),t.search.refreshDisplay(!0)}),$("#filter_no_categories",this.$topMenu).click(function(){this.checked?(t.filterCategories=[],$("#hidden_categories .checkbox",t.$topMenu).prop("checked",!1),t.filterNoCategories=!0,t.channels.refreshDisplay(!0),t.latest.refreshDisplay(!0),t.search.refreshDisplay(!0)):(t.filterNoCategories=!1,t.channels.refreshDisplay(!0),t.latest.refreshDisplay(!0),t.search.refreshDisplay(!0))})}},MSBrowser.prototype.removeOidFromTab=function(t,e){if($(".item-entry-"+e,t.$content).remove(),t.lastResponse){const s=["items","channels","live_streams","videos","photos_groups"];for(let i=0;i<s.length;i++){let a=-1;if(t.lastResponse[s[i]])for(let n=0;n<t.lastResponse[s[i]].length;n++)if(t.lastResponse[s[i]][n].oid==e){a=n;break}if(-1!=a){t.lastResponse[s[i]].splice(a,1);break}}}},MSBrowser.prototype.openStatistics=function(t){this.overlayStats||(this.overlayStats=new OverlayDisplayManager),this.overlayStats.show({title:jsu.translate("See statistics on this channel"),iframe:"/statistics/iframe/"+t+"/?period=last_year"})},MSBrowserLatest.prototype.getDisplayableContent=function(){let t=this.browser.displayableContent;return t.length>1&&this.browser.ltiMode&&-1!=t.indexOf("c")&&(t=t.replace(/c/g,"")),t},MSBrowserLatest.prototype.getMenuJq=function(){const t=this.getDisplayableContent();let e="";return e+='<div id="ms_browser_latest_menu" style="display: none;">',t.length>1&&(e+='<div class="ms-browser-dropdown" id="ms_browser_latest_types_dropdown">',e+='<button type="button" aria-controls="ms_browser_latest_types_dropdown_menu" aria-expanded="false" class="button ms-browser-dropdown-button '+this.browser.btnClass+'">'+jsu.translateHTML("Content types")+' <i class="fa fa-angle-down" aria-hidden="true"></i></button>',e+='<div class="ms-browser-dropdown-menu ms-browser-latest-types" id="ms_browser_latest_types_dropdown_menu">',e+="<h4>"+jsu.translateHTML("Content types to display:")+"</h4>",-1!=t.indexOf("c")&&(e+='<p><input id="latest_display_channel" type="checkbox">',e+=' <label for="latest_display_channel">'+jsu.translateHTML("channels")+"</label></p>"),-1!=t.indexOf("v")&&(e+='<p><input id="latest_display_video" type="checkbox">',e+=' <label for="latest_display_video">'+jsu.translateHTML("videos")+"</label></p>"),-1!=t.indexOf("l")&&(e+='<p><input id="latest_display_live" type="checkbox">',e+=' <label for="latest_display_live">'+jsu.translateHTML("live streams")+"</label></p>"),-1!=t.indexOf("p")&&(e+='<p><input id="latest_display_photos" type="checkbox">',e+=' <label for="latest_display_photos">'+jsu.translateHTML("photos")+"</label></p>"),e+="</div>",e+="</div>"),e+="</div>",this.$menu=$(e),t.length>1&&(this.browser.setupDropdown($("#ms_browser_latest_types_dropdown",this.$menu)),$(".ms-browser-latest-types input",this.$menu).change({obj:this},function(t){t.data.obj.refreshDisplay(!0);const e=this.id.split("_")[2][0];let s=jsu.getCookie("catalog-lastestTypes");s||(s="vlp"),this.checked?-1==s.indexOf(e)&&(s+=e):s=s.replace(new RegExp(e),""),jsu.setCookie("catalog-lastestTypes",s)})),this.$menu},MSBrowserLatest.prototype.getContentJq=function(){const t='<div id="ms_browser_latest" class="ms-browser-content" style="display: none;"><div class="messages"><div class="message info">'+jsu.translateHTML("This list presents all media and channels ordered by add date.")+'</div></div><div class="ms-browser-latest-place"></div>'+this.browser.getMoreButton()+"</div>";return this.$content=$(t),this.$place=$(".ms-browser-latest-place",this.$content),this.$content},MSBrowserLatest.prototype.onShow=function(){if(this.browser.setTitle("latest",jsu.translate("Latest media")),this.initialized)return;if(this.initialized=!0,this.getDisplayableContent().length>1){let t=jsu.getCookie("catalog-lastestTypes");t||(t="vlp"),$(".ms-browser-latest-types #latest_display_channel",this.$menu).prop("checked",-1!=t.indexOf("c")),$(".ms-browser-latest-types #latest_display_video",this.$menu).prop("checked",-1!=t.indexOf("v")),$(".ms-browser-latest-types #latest_display_live",this.$menu).prop("checked",-1!=t.indexOf("l")),$(".ms-browser-latest-types #latest_display_photos",this.$menu).prop("checked",-1!=t.indexOf("p"))}this.loadLatest(this.browser.displayCount)},MSBrowserLatest.prototype.loadLatest=function(t,e){if(this.latestLoading)return;this.latestLoading=!0;const s=this.getDisplayableContent(),i={};s.length>1?(i.content="",-1!=s.indexOf("c")&&$("#latest_display_channel",this.$menu).is(":checked")&&(i.content+="c"),-1!=s.indexOf("v")&&$("#latest_display_video",this.$menu).is(":checked")&&(i.content+="v"),-1!=s.indexOf("l")&&$("#latest_display_live",this.$menu).is(":checked")&&(i.content+="l"),-1!=s.indexOf("p")&&$("#latest_display_photos",this.$menu).is(":checked")&&(i.content+="p")):s&&(i.content=s),null!==this.browser.filterEditable&&(i.editable=this.browser.filterEditable?"yes":"no"),null!==this.browser.filterValidated&&(i.validated=this.browser.filterValidated?"yes":"no"),null!==this.browser.filterSpeaker&&(i.speaker=this.browser.filterSpeaker),this.browser.filterNoCategories?i.no_categories=!0:this.browser.filterCategories.length>0&&(i.categories=this.browser.filterCategories.join("\n"));let a=0;if(this.startDate&&(i.start=this.startDate,a=parseInt(this.startDate.replace(new RegExp("[-_]","g"),""),10),isNaN(a)&&(a=0)),e){const t=parseInt(e.replace(new RegExp("[-_]","g"),""),10);if(a>0&&!isNaN(t)&&t>=a)return this.latestLoading=!1,void console.log("cancelled");i.end=e}t&&(i.count=t);const n=this;this.browser.displayLoading(),this.browser.msapi.ajaxCall("getLatestContent",i,function(t){t.items&&t.items.length>0&&(n.lastResponse?n.lastResponse.items=n.lastResponse.items.concat(t.items):n.lastResponse=t),n._onAjaxResponse(t),n.latestLoading=!1})},MSBrowserLatest.prototype._onAjaxError=function(t){let e='<div class="messages">';if(this.browser.useOverlay||"403"!=t.errorCode&&"401"!=t.errorCode)e+='<div class="message error">'+jsu.escapeHTML(t.error)+"</div>";else{const s=this.browser.urlLogin+"?next="+window.location.pathname+(window.location.hash?window.location.hash.substring(1):"");e+='<div class="item-description"><div class="message error">'+jsu.escapeHTML(t.error)+"</div><p>"+jsu.translateHTML("Please login to access this page")+'<br /> <a href="'+s+'">'+jsu.translateHTML("Sign in")+"</a></p></div>"}e+="</div>",this.$place.html(e)},MSBrowserLatest.prototype._onAjaxResponse=function(t){if(this.browser.hideLoading(),!t.success)return this._onAjaxError(t);this.startDate=t.max_date,this.more=!0===t.more;for(let e=0;e<t.items.length;e++){const s=t.items[e];if(s.date_label&&s.date_label!=this.dateLabel){this.dateLabel=s.date_label;const t=this.browser.pickMode?"h3":"h2";this.$place.append("<"+t+">"+this.dateLabel+"</"+t+">"),this.$section=$('<ul class="ms-browser-section"></ul>'),this.$place.append(this.$section)}else this.$section||(this.$section=$('<ul class="ms-browser-section"></ul>'),this.$place.append(this.$section),console.log("A browser section is missing in latest tab. This should not happen.",s.date_label,this.dateLabel));let i;i="v"==s.type?"video":"l"==s.type?"live":"p"==s.type?"photos":"channel";const a=-1!=this.browser.selectableContent.indexOf(s.type);this.$section.append(this.browser.getContentEntry(i,s,a,"latest"))}if(null===this.$section){const t=$('<div class="messages"><div class="message info">'+jsu.translate("No contents.")+"</div></div>");this.$place.append(t)}this.more?this.browser.showMoreBtns("latest"):this.browser.hideMoreBtns("latest")},MSBrowserLatest.prototype.displayMore=function(t){this.more&&this.loadLatest(t)},MSBrowserLatest.prototype.refreshDisplay=function(t){t&&(this.lastResponse=null),this.lastResponse?(this.dateLabel="",this.$section=null,this.$place.html(""),this._onAjaxResponse(this.lastResponse)):(this.more=!1,this.startDate="",this.dateLabel="",this.$section=null,this.$place.html(""),this.loadLatest(this.browser.displayCount))},MSBrowserLatest.prototype.remove=function(t){this.browser.removeOidFromTab(this,t)},MSBrowserSearch.prototype.getDisplayableContent=function(){let t=this.browser.displayableContent;return t.length>1&&this.browser.ltiMode&&-1!=t.indexOf("c")&&(t=t.replace(/c/g,"")),t},MSBrowserSearch.prototype.shouldBeDisplayed=function(t,e){if(!e)return!0;for(let s=0;s<t.length;s++)if(-1!=e.indexOf(t[s]))return!0;return!1},MSBrowserSearch.prototype.getMenuJq=function(){const t=this.getDisplayableContent();let e='<div id="ms_browser_search_menu" style="display: none;"><form class="ms-browser-search-form" method="get" action="." onsubmit="javascript: return false;"><label for="ms_browser_search_text"><span class="hidden-below-800">'+jsu.translateHTML("Search:")+'</span></label> <input id="ms_browser_search_text" type="text" value=""> <button type="submit" class="button" id="ms_browser_search_start">'+jsu.translateHTML("Go")+'</button></form><div class="ms-browser-dropdown" id="ms_browser_search_in_dropdown"><button type="button" aria-controls="ms_browser_search_in_dropdown_menu" aria-expanded="false" class="button ms-browser-dropdown-button '+this.browser.btnClass+'">'+jsu.translate("Search in")+' <i class="fa fa-angle-down" aria-hidden="true"></i></button><div class="ms-browser-dropdown-menu ms-browser-search-in" id="ms_browser_search_in_dropdown_menu"> <div><button type="button" class="button" id="ms_browser_search_in_all">'+jsu.translateHTML("all")+'</button> <button type="button" class="button" id="ms_browser_search_in_none">'+jsu.translateHTML("none")+"</button></div>";for(let s=0;s<this.searchInFields.length;s++){const i=this.searchInFields[s];this.shouldBeDisplayed(t,i.items)&&(e+=' <div><input id="ms_browser_search_'+i.name+'" type="checkbox" '+(i.initial?'checked="checked"':"")+">",e+=' <label for="ms_browser_search_'+i.name+'">'+i.label+"</label></div>")}if(e+="</div></div>",t.length>1){e+='<div class="ms-browser-dropdown" id="ms_browser_search_for_dropdown"><button type="button" aria-controls="ms_browser_search_for_dropdown_menu" aria-expanded="false" class="button ms-browser-dropdown-button '+this.browser.btnClass+'">'+jsu.translateHTML("Search for")+' <i class="fa fa-angle-down" aria-hidden="true"></i></button><div class="ms-browser-dropdown-menu ms-browser-search-for" id="ms_browser_search_for_dropdown_menu"> <div><button type="button" class="button" id="ms_browser_search_for_all">'+jsu.translateHTML("all")+'</button> <button type="button" class="button" id="ms_browser_search_for_none">'+jsu.translateHTML("none")+"</button></div>";for(let s=0;s<this.searchForFields.length;s++){const i=this.searchForFields[s];this.shouldBeDisplayed(t,i.items)&&(e+=' <div><input id="ms_browser_search_'+i.name+'" type="checkbox" '+(i.initial?'checked="checked"':"")+">",e+=' <label for="ms_browser_search_'+i.name+'">'+i.label+"</label></div>")}e+="</div></div>"}return e+="</div>",this.$menu=$(e),this.browser.setupDropdown($("#ms_browser_search_in_dropdown",this.$menu)),this.browser.setupDropdown($("#ms_browser_search_for_dropdown",this.$menu)),$("form",this.$menu).submit({obj:this},function(t){t.data.obj.onSearchSubmit()}),$("#ms_browser_search_in_all",this.$menu).click({obj:this},function(t){$(".ms-browser-search-in input[type=checkbox]",t.data.obj.$menu).prop("checked",!0),t.data.obj.onSearchSubmit()}),$("#ms_browser_search_in_none",this.$menu).click({obj:this},function(t){$(".ms-browser-search-in input[type=checkbox]",t.data.obj.$menu).prop("checked",!1),t.data.obj.onSearchSubmit()}),$("#ms_browser_search_for_all",this.$menu).click({obj:this},function(t){$(".ms-browser-search-for input[type=checkbox]",t.data.obj.$menu).prop("checked",!0),t.data.obj.onSearchSubmit()}),$("#ms_browser_search_for_none",this.$menu).click({obj:this},function(t){$(".ms-browser-search-for input[type=checkbox]",t.data.obj.$menu).prop("checked",!1),t.data.obj.onSearchSubmit()}),$("input[type=checkbox]",this.$menu).change({obj:this},function(t){t.data.obj.onSearchSubmit()}),this.$menu},MSBrowserSearch.prototype.getContentJq=function(){const t='<div id="ms_browser_search" class="ms-browser-content" style="display: none;"><div class="ms-browser-search-place"><div class="messages"><div class="message info">'+jsu.translateHTML("Use the input above to search for something.")+"</div></div></div>"+this.browser.getMoreButton()+"</div>";return this.$content=$(t),this.$place=$(".ms-browser-search-place",this.$content),this.$content},MSBrowserSearch.prototype.onShow=function(){this.browser.setTitle(this.currentTitle?this.currentTitle:jsu.translate("Search")),this.initialized||(this.initialized=!0,this.browser.hideMoreBtns("search"),this.onUrlChange(),this.browser.useOverlay||"search"!=this.browser.getActiveTab()||$("#top_search_form form").submit({obj:this},function(t){return $("#ms_browser_search_text").val($("#top_search_input").val()),t.data.obj.onSearchSubmit(),!1}))},MSBrowserSearch.prototype.setOrder=function(t){this.order=t||"default",this.refreshDisplay(!0)},MSBrowserSearch.prototype.onUrlChange=function(){if(!this.initialized)return;const t=this.browser.parseUrl(),e=this.getDisplayableContent();for(let s=0;s<this.searchInFields.length;s++){const i=this.searchInFields[s];if(this.shouldBeDisplayed(e,i.items)){let e;e=t.hasInVals?Boolean(t[i.name]):i.initial,$("#ms_browser_search_"+i.name,this.$menu).prop("checked",e)}}for(let s=0;s<this.searchForFields.length;s++){const i=this.searchForFields[s];if(this.shouldBeDisplayed(e,i.items)){let e;e=t.hasForVals?Boolean(t[i.name]):i.initial,$("#ms_browser_search_"+i.name,this.$menu).prop("checked",e)}}t.text&&($("#ms_browser_search_text",this.$menu).val(t.text),this.onSearchSubmit(!0))},MSBrowserSearch.prototype.onSearchSubmit=function(t){const e=$("#ms_browser_search_text",this.$menu).val();if(!e)return;this.browser.displayLoading();const s=this.getDisplayableContent();let i="text="+e,a="";for(let t=0;t<this.searchInFields.length;t++){const e=this.searchInFields[t];if(this.shouldBeDisplayed(s,e.items)){$("#ms_browser_search_"+e.name,this.$menu).is(":checked")&&(a+=e.name.substring(2),i+="&"+e.name)}}a=a?a.substring(1):"metadata";let n="";for(let t=0;t<this.searchForFields.length;t++){const e=this.searchForFields[t];if(this.shouldBeDisplayed(s,e.items)){$("#ms_browser_search_"+e.name,this.$menu).is(":checked")&&(n+=e.name.substring(4,5),i+="&"+e.name)}}n||(n=s);const o={search:e,content:n,order_by:this.order,fields:a};null!==this.browser.filterEditable&&(o.editable=this.browser.filterEditable?"yes":"no"),null!==this.browser.filterValidated&&(o.validated=this.browser.filterValidated?"yes":"no"),null!==this.browser.filterSpeaker&&(o.speaker=this.browser.filterSpeaker),this.browser.filterNoCategories?o.no_categories=!0:this.browser.filterCategories.length>0&&(o.categories=this.browser.filterCategories.join("\n"));const r=jsu.escapeHTML(jsu.translate("Search results for:")+" "+e);if(this.currentTitle=r,this.browser.setTitle(r),!this.browser.pickMode&&!t){let t=this.browser.urlSearch;t.indexOf("?")<0?t+="?"+i:t+="&"+i,this.lastUrl&&this.lastUrl==t||(this.lastUrl=t,window.history.pushState({ms_tab:"search",search:e},r,t))}const l=this;this.browser.msapi.ajaxCall("search",o,function(t){l._onAjaxResponse(t),window.gaPageview&&window.gaPageview("ajax search","/ajax_search?search="+o.search+"&fields="+o.fields)})},MSBrowserSearch.prototype._onAjaxError=function(t){this.lastResponse=null;let e='<div class="messages">';if(this.browser.useOverlay||"403"!=t.errorCode&&"401"!=t.errorCode)e+='<div class="message error">'+jsu.escapeHTML(t.error)+"</div>";else{const s=this.browser.urlLogin+"?next="+window.location.pathname+(window.location.hash?window.location.hash.substring(1):"");e+='<div class="item-description"><div class="message error">'+jsu.escapeHTML(t.error)+"</div><p>"+jsu.translateHTML("Please login to access this page")+'<br /> <a href="'+s+'">'+jsu.translate("Sign in")+"</a></p></div>"}e+="</div>",this.$place.html(e)},MSBrowserSearch.prototype._onAjaxResponse=function(t){if(this.browser.hideLoading(),this.browser.moreChannels=[],this.browser.moreLiveStreams=[],this.browser.moreVideos=[],this.browser.morePhotosGroups=[],this.browser.hideMoreBtns("search"),!t.success)return this._onAjaxError(t);this.lastResponse=t;const e=t.channels?t.channels.length:0,s=t.videos?t.videos.length:0,i=t.live_streams?t.live_streams.length:0,a=t.photos_groups?t.photos_groups.length:0,n=e>0||s>0||i>0||a>0;if(this.$place.html(""),n){const n=[];e>0&&n.push(e+" "+jsu.translate("channel(s)")),s>0&&n.push(s+" "+jsu.translate("video(s)")),i>0&&n.push(i+" "+jsu.translate("live stream(s)")),a>0&&n.push(a+" "+jsu.translate("photos group(s)"));const o='<div class="ms-browser-search-matching"><b>'+jsu.translateHTML("Matching items:")+"</b> "+jsu.escapeHTML(n.join(", "))+"</div>";this.$place.append(o),this.browser.displayContent(this.$place,t,null,"search")}else this.$place.html('<div class="messages"><div class="message info">'+jsu.translateHTML("No results.")+"</div></div>")},MSBrowserSearch.prototype.refreshDisplay=function(t){t&&this.lastResponse&&(this.lastResponse=null),this.lastResponse?this._onAjaxResponse(this.lastResponse):this.onSearchSubmit(!0)},MSBrowserSearch.prototype.remove=function(t){this.browser.removeOidFromTab(this,t)},MSBrowser.prototype.init=function(){if(this.initialized)return;this.initialized=!0,"thumbnail"==jsu.getCookie("catalog-displayMode")&&(this.displayAsThumbnails=!0,this.useOverlay||$("#container").removeClass("max-width-1200")),"yes"==jsu.getCookie("catalog-displayTypesIcons")&&(this.displayTypesIcons=!0);const t=this.parseUrl();if(!this.useOverlay){this.pickMode=!1;const e=[];if(t.iframe&&(this.iframeMode=!0,this.urlLogin="/login/iframe/",e.push("iframe")),t.login&&e.push("login="+window.encodeURIComponent(t.login)),this.hideHeader&&e.push("header=no"),t.speaker&&(this.filterSpeaker=t.speaker,e.push("speaker="+window.encodeURIComponent(this.filterSpeaker))),t.mine&&(this.filterSpeaker="self",e.push("mine"),this.treeManager=!1),t.lti&&(this.ltiMode=!0,e.push("lti")),t.newtab&&(this.linksTarget=' target="Blank"',e.push("newtab")),t.categories&&(this.filterCategories=t.categories.toString().split(","),e.push("categories="+window.encodeURIComponent(t.categories))),t.pick&&(this.pickMode=!0,t.pick.toString().match(/^[cvlp]+$/)?(this.selectableContent=t.pick,this.displayableContent=t.pick,this.displayableContent.indexOf("c")<0&&(this.displayableContent="c"+this.displayableContent)):(this.selectableContent="vlp",this.displayableContent="cvlp"),e.push("pick="+this.selectableContent),!this.initialOid&&t.initial&&(this.initialOid=t.initial.toString(),e.push("initial="+window.encodeURIComponent(this.initialOid)))),t.return&&(window.parent&&0===t.return.toString().indexOf("postMessageAPI")||0===t.return.toString().indexOf("https://")&&t.return.toString().length>8)){let s;this.pickMode||(this.pickMode=!0,this.selectableContent="vlp",this.displayableContent="cvlp",e.push("pick="+this.selectableContent)),e.push("return="+t.return),s=window.parent&&0===t.return.toString().indexOf("postMessageAPI")?t.return:this.urlPostLink+"?return="+t.return,this.onPick=function(t,e){if(!e)if(0===s.indexOf("postMessageAPI")){const i=window.opener?window.opener.parent:window.parent,a=s.substring("postMessageAPI".length).replace(/^:+|:+$/g,"");console.log("Posting message:",{item:t,initialPick:Boolean(e),target:a}),i.postMessage({item:t,initialPick:Boolean(e),target:a},"*"),window.opener&&window.close()}else window.location=s+"&oid="+t.oid}}e.length>0&&(this.linksUrlParams=e.join("&"),this.urlLogin+="?"+this.linksUrlParams,this.urlChannels+="?"+this.linksUrlParams,this.urlLatest+="?"+this.linksUrlParams,this.urlSearch+="?"+this.linksUrlParams)}this.initOptions.browser=this,this.currentSelection&&this.currentSelection.oid&&(0!==this.currentSelection.oid.indexOf("c")&&isNaN(parseInt(this.currentSelection.oid,10))?this.initOptions.currentChannelOid=this.currentSelection.parent_oid:this.initOptions.currentChannelOid=this.currentSelection.oid),this.channels=new MSBrowserChannels(this.initOptions),this.latest=new MSBrowserLatest(this.initOptions),this.search=new MSBrowserSearch(this.initOptions),this.buildWidget(),this.initialState&&this.initialState.tab?this.changeTab(this.initialState.tab,!0):this.changeTab("channels",!0),this.initialOid&&this.pick(this.initialOid,null,!0);const e=this;this.useOverlay?this.overlay=new OverlayDisplayManager:$(window).bind("hashchange",function(){e.onUrlChange()}),this.loadCategories(),$(window).resize(function(){e.onResize()}),this.onResize()},MSBrowser.prototype.open=function(){this.useOverlay&&(this.init(),this.overlay.show({title:this.title,html:this.$widget}))},MSBrowser.prototype.updateCatalog=function(t,e){if(t&&t.oid)if(this.catalog[t.oid]){let s;for(s in t)this.catalog[t.oid][s]=t[s];e&&(this.catalog[t.oid].is_full=!0)}else e&&(t.is_full=!0),this.catalog[t.oid]=t},MSBrowser.prototype.getInfoForOid=function(t,e,s){const i=t&&("v"==t[0]||"l"==t[0]||"p"==t[0]);return this.getInfo({oid:t},i,e,s)},MSBrowser.prototype.getInfoForSlug=function(t,e,s,i){return this.getInfo({slug:t},e,s,i)},MSBrowser.prototype.getInfo=function(t,e,s,i){if(!t.oid&&!t.slug||!i)return;const a=t.oid?"oid":"slug";let n,o=null;for(n in this.catalog)if((!e&&"c"==n[0]||e&&"c"!=n[0])&&this.catalog[n][a]==t[a]){s?this.catalog[n].is_full&&(o=this.catalog[n]):o=this.catalog[n];break}if(o)return i({success:!0,info:o});this.displayLoading(),s&&(t.full="yes");const r=e?"getMedias":"getChannels",l=this;this.msapi.ajaxCall(r,t,function(t){t.success&&l.updateCatalog(t.info,s),l.hideLoading(),i(t)})},MSBrowser.prototype.pick=function(t,e,s){if(null==t)return void(this.currentSelection&&this.currentSelection.oid&&$(".item-entry-"+this.currentSelection.oid,this.$main).removeClass("selected"));if(this.catalog[t]&&this.catalog[t].is_full)return void this._pick(t,{success:!0,info:this.catalog[t]},e,s);const i=this;this.getInfoForOid(t,!0,function(a){i._pick(t,a,e,s)})},MSBrowser.prototype._pick=function(t,e,s,i){e.success?this.pickMode?(this.currentSelection&&this.currentSelection.oid&&$(".item-entry-"+this.currentSelection.oid,this.$main).removeClass("selected"),this.currentSelection=this.catalog[t],$(".item-entry-"+this.currentSelection.oid,this.$main).addClass("selected"),this.overlay&&!i&&this.overlay.hide(),this.onPick&&this.onPick(this.catalog[t],i),!this.useOverlay&&e.info.parent_slug&&(window.location.hash="#"+e.info.parent_slug),!this.channels||i&&this.initialState&&this.initialState.channelSlug||(0!==t.indexOf("c")&&isNaN(parseInt(t,10))?this.channels.displayChannel(e.info.parent_oid):this.channels.displayChannel(t))):"delete"==s&&window.deleteFormManager&&window.deleteFormManager.show(t,this.catalog[t].title):console.log("Unable to get info about initial selection:"+e.error)},MSBrowser.prototype.remove=function(t){t&&this.catalog[t]&&(this.channels.remove(t),this.latest.remove(t),this.search.remove(t))},MSBrowser.prototype.getLastPick=function(){return this.currentSelection},MSBrowser.prototype.getSelectedOid=function(){return this.initialized?this.currentSelection?this.currentSelection.oid:null:this.initialOid},MSBrowser.prototype.parseUrl=function(){const t={},e=window.location.search?window.location.search.substring(1):null;if(e){const s=e.split("&");for(let e=0;e<s.length;e++){let i,a;-1!=s[e].indexOf("=")?(i=s[e].substring(0,s[e].indexOf("=")),a="on"==(a=s[e].substring(i.length+1))||"off"!=a&&window.decodeURIComponent(a.replace(/\+/g,"%20"))):(i=s[e],a=!0),"in_"==i.substring(0,3)?t.hasInVals=!0:"for_"==i.substring(0,4)&&(t.hasForVals=!0),t[i]=a}}return t},MSBrowser.prototype.onUrlChange=function(){const t=window.location.pathname+window.location.search;if(0===t.indexOf("/channels/")){let t=window.location.hash;t&&"#"==t[0]&&(t=t.substring(1)),t?this.channels.displayChannelBySlug(t):"self"==this.filterSpeaker?this.channels.displayPersonalChannel():this.channels.displayChannel("0"),this.changeTab("channels",!0)}else 0===t.indexOf("/latest/")?this.changeTab("latest",!0):0===t.indexOf("/search/")&&(this.search.onUrlChange(),this.changeTab("search",!0))},MSBrowser.prototype.onResize=function(){if(this.useOverlay){const t=$(window).width()-70;this.$widget.width(t);const e=$(window).height()-100;this.$widget.height(e)}},MSBrowser.prototype.loadCategories=function(){const t=this;this.msapi.ajaxCall("listCategories",{},function(e){e.data&&(t.siteSettingsCategories=e.data,t.displayCategories())})};